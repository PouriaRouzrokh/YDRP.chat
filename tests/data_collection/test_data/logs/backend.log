2025-04-14 01:22:10,605 - ydrpolicy.backend.mcp - INFO - Attempting to start MCP server on 0.0.0.0:8001 via http transport...
2025-04-14 01:22:10,606 - ydrpolicy.backend.mcp.server - INFO - Attempting to start MCP server using http transport...
2025-04-14 01:22:10,606 - ydrpolicy.backend.mcp.server - INFO - Running MCP server with http/sse transport via uvicorn on 0.0.0.0:8001.
2025-04-14 01:22:23,424 - ydrpolicy.backend.agent - INFO - Executing agent command...
2025-04-14 01:22:23,424 - ydrpolicy.backend.agent - INFO - Agent requested mode: Terminal
2025-04-14 01:22:23,424 - ydrpolicy.backend.agent - INFO - MCP Tool Connection: Enabled
2025-04-14 01:22:23,425 - ydrpolicy.backend.agent - INFO - Starting agent in terminal mode (using session history, not persistent)...
2025-04-14 01:22:23,427 - ydrpolicy.backend.agent.policy_agent - INFO - Creating Policy Agent (MCP Enabled: True)...
2025-04-14 01:22:23,428 - ydrpolicy.backend.agent.mcp_connection - WARNING - MCP Host 0.0.0.0 detected, using 'localhost' for client connection.
2025-04-14 01:22:23,428 - ydrpolicy.backend.agent.mcp_connection - INFO - Initializing MCP Server connection to: http://localhost:8001/sse
2025-04-14 01:22:23,428 - ydrpolicy.backend.agent.mcp_connection - INFO - MCPServerSse instance created.
2025-04-14 01:22:23,428 - ydrpolicy.backend.agent.policy_agent - INFO - MCP server configured for the agent.
2025-04-14 01:22:23,429 - ydrpolicy.backend.agent.policy_agent - INFO - SUCCESS: Policy Agent instance created successfully.
2025-04-14 01:22:31,880 - ydrpolicy.backend.agent.terminal - ERROR - Agent run error: Server not initialized. Make sure you call `connect()` first.
Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/main.py", line 505, in terminal_chat
    async for event in result_stream.stream_events():
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/.venv/lib/python3.12/site-packages/agents/result.py", line 186, in stream_events
    raise self._stored_exception
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/.venv/lib/python3.12/site-packages/agents/run.py", line 518, in _run_streamed_impl
    all_tools = await cls._get_all_tools(current_agent)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/.venv/lib/python3.12/site-packages/agents/run.py", line 931, in _get_all_tools
    return await agent.get_all_tools()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/.venv/lib/python3.12/site-packages/agents/agent.py", line 231, in get_all_tools
    mcp_tools = await self.get_mcp_tools()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/.venv/lib/python3.12/site-packages/agents/agent.py", line 227, in get_mcp_tools
    return await MCPUtil.get_all_function_tools(self.mcp_servers)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/.venv/lib/python3.12/site-packages/agents/mcp/util.py", line 27, in get_all_function_tools
    server_tools = await cls.get_function_tools(server)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/.venv/lib/python3.12/site-packages/agents/mcp/util.py", line 44, in get_function_tools
    tools = await server.list_tools()
            ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/.venv/lib/python3.12/site-packages/agents/mcp/server.py", line 115, in list_tools
    raise UserError("Server not initialized. Make sure you call `connect()` first.")
agents.exceptions.UserError: Server not initialized. Make sure you call `connect()` first.
2025-04-14 01:22:31,984 - ydrpolicy.backend.agent.terminal - WARNING - Keeping previous history list due to agent run failure.
2025-04-14 01:22:44,895 - ydrpolicy.backend.mcp.server - INFO - MCP server process finished.
2025-04-14 01:22:44,897 - ydrpolicy.backend.mcp - INFO - MCP server process finished.
2025-04-14 01:22:50,204 - ydrpolicy.backend.mcp - INFO - Attempting to start MCP server on 0.0.0.0:8001 via http transport...
2025-04-14 01:22:50,204 - ydrpolicy.backend.mcp.server - INFO - Attempting to start MCP server using http transport...
2025-04-14 01:22:50,204 - ydrpolicy.backend.mcp.server - INFO - Running MCP server with http/sse transport via uvicorn on 0.0.0.0:8001.
2025-04-14 01:22:54,867 - ydrpolicy.backend.agent.mcp_connection - INFO - Closing MCP server connection...
2025-04-14 01:22:54,869 - ydrpolicy.backend.agent.mcp_connection - INFO - MCP server connection closed.
2025-04-14 01:22:54,870 - ydrpolicy.backend.agent.terminal - INFO - Terminal chat session ended.
2025-04-14 01:22:54,871 - ydrpolicy.backend.agent - INFO - Terminal agent process finished.
2025-04-14 01:22:57,857 - ydrpolicy.backend.agent - INFO - Executing agent command...
2025-04-14 01:22:57,857 - ydrpolicy.backend.agent - INFO - Agent requested mode: Terminal
2025-04-14 01:22:57,857 - ydrpolicy.backend.agent - INFO - MCP Tool Connection: Enabled
2025-04-14 01:22:57,857 - ydrpolicy.backend.agent - INFO - Starting agent in terminal mode (using session history, not persistent)...
2025-04-14 01:22:57,858 - ydrpolicy.backend.agent.policy_agent - INFO - Creating Policy Agent (MCP Enabled: True)...
2025-04-14 01:22:57,858 - ydrpolicy.backend.agent.mcp_connection - WARNING - MCP Host 0.0.0.0 detected, using 'localhost' for client connection.
2025-04-14 01:22:57,858 - ydrpolicy.backend.agent.mcp_connection - INFO - Initializing MCP Server connection to: http://localhost:8001/sse
2025-04-14 01:22:57,859 - ydrpolicy.backend.agent.mcp_connection - INFO - MCPServerSse instance created.
2025-04-14 01:22:57,859 - ydrpolicy.backend.agent.policy_agent - INFO - MCP server configured for the agent.
2025-04-14 01:22:57,859 - ydrpolicy.backend.agent.policy_agent - INFO - SUCCESS: Policy Agent instance created successfully.
2025-04-14 01:23:00,124 - ydrpolicy.backend.agent.terminal - ERROR - Agent run error: Server not initialized. Make sure you call `connect()` first.
Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/main.py", line 505, in terminal_chat
    async for event in result_stream.stream_events():
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/.venv/lib/python3.12/site-packages/agents/result.py", line 186, in stream_events
    raise self._stored_exception
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/.venv/lib/python3.12/site-packages/agents/run.py", line 518, in _run_streamed_impl
    all_tools = await cls._get_all_tools(current_agent)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/.venv/lib/python3.12/site-packages/agents/run.py", line 931, in _get_all_tools
    return await agent.get_all_tools()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/.venv/lib/python3.12/site-packages/agents/agent.py", line 231, in get_all_tools
    mcp_tools = await self.get_mcp_tools()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/.venv/lib/python3.12/site-packages/agents/agent.py", line 227, in get_mcp_tools
    return await MCPUtil.get_all_function_tools(self.mcp_servers)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/.venv/lib/python3.12/site-packages/agents/mcp/util.py", line 27, in get_all_function_tools
    server_tools = await cls.get_function_tools(server)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/.venv/lib/python3.12/site-packages/agents/mcp/util.py", line 44, in get_function_tools
    tools = await server.list_tools()
            ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/.venv/lib/python3.12/site-packages/agents/mcp/server.py", line 115, in list_tools
    raise UserError("Server not initialized. Make sure you call `connect()` first.")
agents.exceptions.UserError: Server not initialized. Make sure you call `connect()` first.
2025-04-14 01:23:00,226 - ydrpolicy.backend.agent.terminal - WARNING - Keeping previous history list due to agent run failure.
2025-04-14 01:25:42,196 - ydrpolicy.backend.mcp.server - INFO - MCP server process finished.
2025-04-14 01:25:42,198 - ydrpolicy.backend.mcp - INFO - MCP server process finished.
2025-04-14 01:25:45,355 - ydrpolicy.backend.mcp - INFO - Attempting to start MCP server on 0.0.0.0:8001 via http transport...
2025-04-14 01:25:45,356 - ydrpolicy.backend.mcp.server - INFO - Attempting to start MCP server using http transport...
2025-04-14 01:25:45,356 - ydrpolicy.backend.mcp.server - INFO - Running MCP server with http/sse transport via uvicorn on 0.0.0.0:8001.
2025-04-14 01:25:52,533 - ydrpolicy.backend.agent.mcp_connection - INFO - Closing MCP server connection...
2025-04-14 01:25:52,535 - ydrpolicy.backend.agent.mcp_connection - INFO - MCP server connection closed.
2025-04-14 01:25:52,535 - ydrpolicy.backend.agent.terminal - INFO - Terminal chat session ended.
2025-04-14 01:25:52,536 - ydrpolicy.backend.agent - INFO - Terminal agent process finished.
2025-04-14 01:25:55,475 - ydrpolicy.backend.agent - INFO - Executing agent command...
2025-04-14 01:25:55,476 - ydrpolicy.backend.agent - INFO - Agent requested mode: Terminal
2025-04-14 01:25:55,476 - ydrpolicy.backend.agent - INFO - MCP Tool Connection: Enabled
2025-04-14 01:25:55,476 - ydrpolicy.backend.agent - INFO - Starting agent in terminal mode (using session history, not persistent)...
2025-04-14 01:25:55,477 - ydrpolicy.backend.agent.policy_agent - INFO - Creating Policy Agent (MCP Enabled: True)...
2025-04-14 01:25:55,477 - ydrpolicy.backend.agent.mcp_connection - WARNING - MCP Host 0.0.0.0 detected, using 'localhost' for client connection.
2025-04-14 01:25:55,477 - ydrpolicy.backend.agent.mcp_connection - INFO - Initializing MCP Server connection to: http://localhost:8001/sse
2025-04-14 01:25:55,478 - ydrpolicy.backend.agent.mcp_connection - INFO - MCPServerSse instance created.
2025-04-14 01:25:55,478 - ydrpolicy.backend.agent.policy_agent - INFO - MCP server configured for the agent.
2025-04-14 01:25:55,478 - ydrpolicy.backend.agent.policy_agent - INFO - SUCCESS: Policy Agent instance created successfully.
2025-04-14 01:25:58,644 - ydrpolicy.backend.agent.terminal - ERROR - Agent run error: Server not initialized. Make sure you call `connect()` first.
Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/main.py", line 505, in terminal_chat
    async for event in result_stream.stream_events():
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/.venv/lib/python3.12/site-packages/agents/result.py", line 186, in stream_events
    raise self._stored_exception
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/.venv/lib/python3.12/site-packages/agents/run.py", line 518, in _run_streamed_impl
    all_tools = await cls._get_all_tools(current_agent)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/.venv/lib/python3.12/site-packages/agents/run.py", line 931, in _get_all_tools
    return await agent.get_all_tools()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/.venv/lib/python3.12/site-packages/agents/agent.py", line 231, in get_all_tools
    mcp_tools = await self.get_mcp_tools()
                ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/.venv/lib/python3.12/site-packages/agents/agent.py", line 227, in get_mcp_tools
    return await MCPUtil.get_all_function_tools(self.mcp_servers)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/.venv/lib/python3.12/site-packages/agents/mcp/util.py", line 27, in get_all_function_tools
    server_tools = await cls.get_function_tools(server)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/.venv/lib/python3.12/site-packages/agents/mcp/util.py", line 44, in get_function_tools
    tools = await server.list_tools()
            ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/.venv/lib/python3.12/site-packages/agents/mcp/server.py", line 115, in list_tools
    raise UserError("Server not initialized. Make sure you call `connect()` first.")
agents.exceptions.UserError: Server not initialized. Make sure you call `connect()` first.
2025-04-14 01:25:58,745 - ydrpolicy.backend.agent.terminal - WARNING - Keeping previous history list due to agent run failure.
2025-04-14 01:28:04,909 - ydrpolicy.backend.mcp.server - INFO - MCP server process finished.
2025-04-14 01:28:04,911 - ydrpolicy.backend.mcp - INFO - MCP server process finished.
2025-04-14 01:28:07,546 - ydrpolicy.backend.mcp - INFO - Attempting to start MCP server on 0.0.0.0:8001 via http transport...
2025-04-14 01:28:07,546 - ydrpolicy.backend.mcp.server - INFO - Attempting to start MCP server using http transport...
2025-04-14 01:28:07,547 - ydrpolicy.backend.mcp.server - INFO - Running MCP server with http/sse transport via uvicorn on 0.0.0.0:8001.
2025-04-14 01:28:12,401 - ydrpolicy.backend.agent.mcp_connection - INFO - Closing MCP server connection...
2025-04-14 01:28:12,402 - ydrpolicy.backend.agent.mcp_connection - INFO - MCP server connection closed.
2025-04-14 01:28:12,403 - ydrpolicy.backend.agent.terminal - INFO - Terminal chat session ended.
2025-04-14 01:28:15,130 - ydrpolicy.backend.agent - INFO - Executing agent command...
2025-04-14 01:28:15,130 - ydrpolicy.backend.agent - INFO - Agent requested mode: Terminal
2025-04-14 01:28:15,130 - ydrpolicy.backend.agent - INFO - MCP Tool Connection: Enabled
2025-04-14 01:28:15,130 - ydrpolicy.backend.agent - INFO - Starting agent in terminal mode (using session history, not persistent)...
2025-04-14 01:28:15,132 - ydrpolicy.backend.agent.policy_agent - INFO - Creating Policy Agent (MCP Enabled: True)...
2025-04-14 01:28:15,132 - ydrpolicy.backend.agent.mcp_connection - WARNING - MCP Host 0.0.0.0 detected, using 'localhost' for client connection.
2025-04-14 01:28:15,133 - ydrpolicy.backend.agent.mcp_connection - INFO - Initializing MCP Server connection to: http://localhost:8001/sse
2025-04-14 01:28:15,133 - ydrpolicy.backend.agent.mcp_connection - INFO - MCPServerSse instance created.
2025-04-14 01:28:15,133 - ydrpolicy.backend.agent.policy_agent - INFO - MCP server configured for the agent.
2025-04-14 01:28:15,133 - ydrpolicy.backend.agent.policy_agent - INFO - SUCCESS: Policy Agent instance created successfully.
2025-04-14 01:29:48,916 - ydrpolicy.backend.mcp.server - INFO - MCP server process finished.
2025-04-14 01:29:48,918 - ydrpolicy.backend.mcp - INFO - MCP server process finished.
2025-04-14 01:29:52,310 - ydrpolicy.backend.mcp - INFO - Attempting to start MCP server on 0.0.0.0:8001 via http transport...
2025-04-14 01:29:52,310 - ydrpolicy.backend.mcp.server - INFO - Attempting to start MCP server using http transport...
2025-04-14 01:29:52,310 - ydrpolicy.backend.mcp.server - INFO - Running MCP server with http/sse transport via uvicorn on 0.0.0.0:8001.
2025-04-14 01:29:55,422 - ydrpolicy.backend.agent.terminal - INFO - Terminal chat session ended.
2025-04-14 01:29:57,738 - ydrpolicy.backend.agent - INFO - Executing agent command...
2025-04-14 01:29:57,738 - ydrpolicy.backend.agent - INFO - Agent requested mode: Terminal
2025-04-14 01:29:57,738 - ydrpolicy.backend.agent - INFO - MCP Tool Connection: Enabled
2025-04-14 01:29:57,739 - ydrpolicy.backend.agent - INFO - Starting agent in terminal mode (using session history, not persistent)...
2025-04-14 01:29:57,739 - ydrpolicy.backend.agent.policy_agent - INFO - Creating Policy Agent (MCP Enabled: True)...
2025-04-14 01:29:57,739 - ydrpolicy.backend.agent.mcp_connection - WARNING - MCP Host 0.0.0.0 detected, using 'localhost' for client connection.
2025-04-14 01:29:57,740 - ydrpolicy.backend.agent.mcp_connection - INFO - Initializing MCP Server connection to: http://localhost:8001/sse
2025-04-14 01:29:57,740 - ydrpolicy.backend.agent.mcp_connection - INFO - MCPServerSse instance created.
2025-04-14 01:29:57,740 - ydrpolicy.backend.agent.policy_agent - INFO - MCP server configured for the agent.
2025-04-14 01:29:57,741 - ydrpolicy.backend.agent.policy_agent - INFO - SUCCESS: Policy Agent instance created successfully.
2025-04-14 01:29:57,762 - ydrpolicy.backend.agent.terminal - INFO - Terminal Mode: MCP connected.
2025-04-14 01:30:28,265 - ydrpolicy.backend.mcp.server - INFO - Received find_similar_chunks request: query='MRI contrasts policy...', k=5, threshold=None
2025-04-14 01:30:28,821 - ydrpolicy.backend.database.engine - INFO - Creating new database engine
2025-04-14 01:30:28,851 - ydrpolicy.backend.database.engine - INFO - Database engine created successfully
2025-04-14 01:30:28,852 - ydrpolicy.backend.database.repository.policies - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-14 01:30:28,904 - ydrpolicy.backend.mcp.server - INFO - Found 5 similar chunks.
2025-04-14 01:30:28,910 - ydrpolicy.backend.agent.terminal - ERROR - Stream processing error: 'ToolCallItem' object has no attribute 'tool_call'
Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/main.py", line 410, in terminal_chat
    f"\n[Calling tool: {event.item.tool_call.function.name}...]",
                        ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'ToolCallItem' object has no attribute 'tool_call'
2025-04-14 01:30:28,947 - ydrpolicy.backend.agent.terminal - WARNING - Keeping previous history list due to agent run failure.
2025-04-14 01:53:44,342 - ydrpolicy.backend.agent.terminal - ERROR - Terminal Mode: MCP close error: 'MCPServerSse' object has no attribute 'close'
Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/main.py", line 477, in terminal_chat
AttributeError: 'MCPServerSse' object has no attribute 'close'
2025-04-14 01:53:44,381 - ydrpolicy.backend.agent.terminal - INFO - Terminal chat session ended.
2025-04-14 01:53:44,442 - ydrpolicy.backend.agent - INFO - Terminal agent process finished.
2025-04-14 01:57:39,030 - ydrpolicy.backend.agent - INFO - Executing agent command...
2025-04-14 01:57:39,030 - ydrpolicy.backend.agent - INFO - Agent requested mode: Terminal
2025-04-14 01:57:39,030 - ydrpolicy.backend.agent - INFO - MCP Tool Connection: Enabled
2025-04-14 01:57:39,031 - ydrpolicy.backend.agent - INFO - Starting agent in terminal mode (using session history, not persistent)...
2025-04-14 01:57:39,032 - ydrpolicy.backend.agent.policy_agent - INFO - Creating Policy Agent (MCP Enabled: True)...
2025-04-14 01:57:39,032 - ydrpolicy.backend.agent.mcp_connection - WARNING - MCP Host 0.0.0.0 detected, using 'localhost' for client connection.
2025-04-14 01:57:39,032 - ydrpolicy.backend.agent.mcp_connection - INFO - Initializing MCP Server connection to: http://localhost:8001/sse
2025-04-14 01:57:39,033 - ydrpolicy.backend.agent.mcp_connection - INFO - MCPServerSse instance created.
2025-04-14 01:57:39,033 - ydrpolicy.backend.agent.policy_agent - INFO - MCP server configured for the agent.
2025-04-14 01:57:39,033 - ydrpolicy.backend.agent.policy_agent - INFO - SUCCESS: Policy Agent instance created successfully.
2025-04-14 01:57:39,054 - ydrpolicy.backend.agent.terminal - INFO - Terminal Mode: MCP connected.
2025-04-14 01:58:34,262 - ydrpolicy.backend.mcp.server - INFO - Received find_similar_chunks request: query='contrast coverage...', k=5, threshold=None
2025-04-14 01:58:34,891 - ydrpolicy.backend.database.repository.policies - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-14 01:58:34,900 - ydrpolicy.backend.mcp.server - INFO - Found 5 similar chunks.
2025-04-14 01:58:34,910 - ydrpolicy.backend.agent.terminal - WARNING - Could not find name via item.raw_item.function.name in tool_call_item.
2025-04-14 01:58:47,057 - ydrpolicy.backend.mcp.server - INFO - Received find_similar_chunks request: query='contrast agent coverage radiology...', k=5, threshold=None
2025-04-14 01:58:47,591 - ydrpolicy.backend.database.repository.policies - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-14 01:58:47,600 - ydrpolicy.backend.mcp.server - INFO - Found 5 similar chunks.
2025-04-14 01:58:47,607 - ydrpolicy.backend.agent.terminal - WARNING - Could not find name via item.raw_item.function.name in tool_call_item.
2025-04-14 01:58:55,082 - ydrpolicy.backend.mcp.server - INFO - Received find_similar_chunks request: query='contrast agent coverage Yale Diagnostic Radiology...', k=5, threshold=None
2025-04-14 01:58:55,577 - ydrpolicy.backend.database.repository.policies - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-14 01:58:55,586 - ydrpolicy.backend.mcp.server - INFO - Found 5 similar chunks.
2025-04-14 01:58:55,596 - ydrpolicy.backend.agent.terminal - WARNING - Could not find name via item.raw_item.function.name in tool_call_item.
2025-04-14 01:59:04,727 - ydrpolicy.backend.mcp.server - INFO - Received find_similar_chunks request: query='contrast agent coverage radiology guidelines...', k=5, threshold=None
2025-04-14 01:59:05,203 - ydrpolicy.backend.database.repository.policies - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-14 01:59:05,211 - ydrpolicy.backend.mcp.server - INFO - Found 5 similar chunks.
2025-04-14 01:59:05,220 - ydrpolicy.backend.agent.terminal - WARNING - Could not find name via item.raw_item.function.name in tool_call_item.
2025-04-14 01:59:05,901 - ydrpolicy.backend.agent.terminal - ERROR - Terminal Mode: MCP close error: 'MCPServerSse' object has no attribute 'close'
Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/main.py", line 365, in terminal_chat
    user_input = input("You: ")
                 ^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 157, in _on_sigint
    raise KeyboardInterrupt()
KeyboardInterrupt

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/main.py", line 464, in terminal_chat
    term_logger.info("Interrupt received")
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 1539, in info
    self._log(INFO, msg, args, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 1682, in _log
    record = self.makeRecord(self.name, level, fn, lno, msg, args,
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 1651, in makeRecord
    rv = _logRecordFactory(name, level, fn, lno, msg, args, exc_info, func,
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 328, in __init__
    self.levelname = getLevelName(level)
                     ^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 148, in getLevelName
    result = _levelToName.get(level)
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 157, in _on_sigint
    raise KeyboardInterrupt()
KeyboardInterrupt

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/main.py", line 479, in terminal_chat
    await mcp_server_instance.close() # Close explicitly
          ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'MCPServerSse' object has no attribute 'close'
2025-04-14 01:59:06,084 - ydrpolicy.backend.agent.terminal - INFO - Terminal chat session ended.
2025-04-14 02:02:47,235 - ydrpolicy.backend.agent - INFO - Executing agent command...
2025-04-14 02:02:47,235 - ydrpolicy.backend.agent - INFO - Agent requested mode: Terminal
2025-04-14 02:02:47,235 - ydrpolicy.backend.agent - INFO - MCP Tool Connection: Enabled
2025-04-14 02:02:47,236 - ydrpolicy.backend.agent - INFO - Starting agent in terminal mode (using session history, not persistent)...
2025-04-14 02:02:47,237 - ydrpolicy.backend.agent.policy_agent - INFO - Creating Policy Agent (MCP Enabled: True)...
2025-04-14 02:02:47,237 - ydrpolicy.backend.agent.mcp_connection - WARNING - MCP Host 0.0.0.0 detected, using 'localhost' for client connection.
2025-04-14 02:02:47,237 - ydrpolicy.backend.agent.mcp_connection - INFO - Initializing MCP Server connection to: http://localhost:8001/sse
2025-04-14 02:02:47,238 - ydrpolicy.backend.agent.mcp_connection - INFO - MCPServerSse instance created.
2025-04-14 02:02:47,238 - ydrpolicy.backend.agent.policy_agent - INFO - MCP server configured for the agent.
2025-04-14 02:02:47,238 - ydrpolicy.backend.agent.policy_agent - INFO - SUCCESS: Policy Agent instance created successfully.
2025-04-14 02:02:47,259 - ydrpolicy.backend.agent.terminal - INFO - Terminal Mode: MCP connected.
2025-04-14 02:03:00,933 - ydrpolicy.backend.mcp.server - INFO - Received find_similar_chunks request: query='What is the Yale policy on contrast coverage?...', k=5, threshold=None
2025-04-14 02:03:01,542 - ydrpolicy.backend.database.repository.policies - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-14 02:03:01,587 - ydrpolicy.backend.mcp.server - INFO - Found 5 similar chunks.
2025-04-14 02:03:01,598 - ydrpolicy.backend.agent.terminal - WARNING - Could not find name via item.raw_item.function.name in tool_call_item.
2025-04-14 02:03:08,613 - ydrpolicy.backend.mcp.server - INFO - Received find_similar_chunks request: query='contrast coverage Yale Radiology policy...', k=5, threshold=None
2025-04-14 02:03:09,428 - ydrpolicy.backend.database.repository.policies - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-14 02:03:09,439 - ydrpolicy.backend.mcp.server - INFO - Found 5 similar chunks.
2025-04-14 02:03:09,447 - ydrpolicy.backend.agent.terminal - WARNING - Could not find name via item.raw_item.function.name in tool_call_item.
2025-04-14 02:03:14,967 - ydrpolicy.backend.mcp.server - INFO - Received find_similar_chunks request: query='contrast coverage radiology policy Yale...', k=5, threshold=None
2025-04-14 02:03:15,528 - ydrpolicy.backend.database.repository.policies - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-14 02:03:15,540 - ydrpolicy.backend.mcp.server - INFO - Found 5 similar chunks.
2025-04-14 02:03:15,549 - ydrpolicy.backend.agent.terminal - WARNING - Could not find name via item.raw_item.function.name in tool_call_item.
2025-04-14 02:03:20,396 - ydrpolicy.backend.mcp.server - INFO - Received find_similar_chunks request: query='contrast coverage diagnostic radiology policy Yale...', k=5, threshold=None
2025-04-14 02:03:20,884 - ydrpolicy.backend.database.repository.policies - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-14 02:03:20,894 - ydrpolicy.backend.mcp.server - INFO - Found 5 similar chunks.
2025-04-14 02:03:20,903 - ydrpolicy.backend.agent.terminal - WARNING - Could not find name via item.raw_item.function.name in tool_call_item.
2025-04-14 02:05:31,305 - ydrpolicy.backend.agent.terminal - ERROR - Terminal Mode: MCP close error: 'MCPServerSse' object has no attribute 'close'
Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/main.py", line 479, in terminal_chat
    await mcp_server_instance.close() # Close explicitly
          ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'MCPServerSse' object has no attribute 'close'
2025-04-14 02:05:31,361 - ydrpolicy.backend.agent.terminal - INFO - Terminal chat session ended.
2025-04-14 02:05:31,415 - ydrpolicy.backend.agent - INFO - Terminal agent process finished.
2025-04-14 02:05:42,689 - ydrpolicy.backend.agent - INFO - Executing agent command...
2025-04-14 02:05:42,689 - ydrpolicy.backend.agent - INFO - Agent requested mode: Terminal
2025-04-14 02:05:42,690 - ydrpolicy.backend.agent - INFO - MCP Tool Connection: Enabled
2025-04-14 02:05:42,690 - ydrpolicy.backend.agent - INFO - Starting agent in terminal mode (using session history, not persistent)...
2025-04-14 02:05:42,690 - ydrpolicy.backend.agent.policy_agent - INFO - Creating Policy Agent (MCP Enabled: True)...
2025-04-14 02:05:42,691 - ydrpolicy.backend.agent.mcp_connection - WARNING - MCP Host 0.0.0.0 detected, using 'localhost' for client connection.
2025-04-14 02:05:42,691 - ydrpolicy.backend.agent.mcp_connection - INFO - Initializing MCP Server connection to: http://localhost:8001/sse
2025-04-14 02:05:42,691 - ydrpolicy.backend.agent.mcp_connection - INFO - MCPServerSse instance created.
2025-04-14 02:05:42,692 - ydrpolicy.backend.agent.policy_agent - INFO - MCP server configured for the agent.
2025-04-14 02:05:42,692 - ydrpolicy.backend.agent.policy_agent - INFO - SUCCESS: Policy Agent instance created successfully.
2025-04-14 02:05:42,711 - ydrpolicy.backend.agent.terminal - INFO - Terminal Mode: MCP connected.
2025-04-14 02:06:05,586 - ydrpolicy.backend.mcp.server - INFO - Received find_similar_chunks request: query='resident shifts on high volume hours Yale policy...', k=5, threshold=None
2025-04-14 02:06:05,981 - ydrpolicy.backend.database.repository.policies - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-14 02:06:05,991 - ydrpolicy.backend.mcp.server - INFO - Found 5 similar chunks.
2025-04-14 02:06:06,001 - ydrpolicy.backend.agent.terminal - WARNING - Could not find name via item.raw_item.function.name in tool_call_item.
2025-04-14 02:06:09,567 - ydrpolicy.backend.mcp.server - INFO - Received get_policy_from_ID request for policy_id: 2
2025-04-14 02:06:09,598 - ydrpolicy.backend.agent.terminal - WARNING - Could not find name via item.raw_item.function.name in tool_call_item.
2025-04-14 02:09:28,910 - ydrpolicy.backend.agent.terminal - ERROR - Terminal Mode: MCP close error: 'MCPServerSse' object has no attribute 'close'
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 678, in run_until_complete
    self.run_forever()
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 645, in run_forever
    self._run_once()
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 1961, in _run_once
    event_list = self._selector.select(timeout)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/selectors.py", line 566, in select
    kev_list = self._selector.control(None, max_ev, timeout)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 157, in _on_sigint
    raise KeyboardInterrupt()
KeyboardInterrupt

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    future.remove_done_callback(_run_until_complete_cb)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/asyncio/runners.py", line 157, in _on_sigint
    raise KeyboardInterrupt()
KeyboardInterrupt

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/main.py", line 307, in terminal_chat
    log_disabled = ctx.meta["log_disabled"]
                                     ^^^^^^^
KeyboardInterrupt

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/main.py", line 409, in terminal_chat
    # ******************** FINAL CORRECTED ACCESS ********************
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 1539, in info
    self._log(INFO, msg, args, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 1682, in _log
    record = self.makeRecord(self.name, level, fn, lno, msg, args,
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 1651, in makeRecord
    rv = _logRecordFactory(name, level, fn, lno, msg, args, exc_info, func,
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/logging/__init__.py", line 333, in __init__
    self.module = os.path.splitext(self.filename)[0]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen posixpath>", line 125, in splitext
  File "<frozen genericpath>", line 133, in _splitext
KeyboardInterrupt

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/main.py", line 423, in terminal_chat
AttributeError: 'MCPServerSse' object has no attribute 'close'
2025-04-14 02:09:32,278 - ydrpolicy.backend.agent - INFO - Executing agent command...
2025-04-14 02:09:32,278 - ydrpolicy.backend.agent - INFO - Agent requested mode: Terminal
2025-04-14 02:09:32,278 - ydrpolicy.backend.agent - INFO - MCP Tool Connection: Enabled
2025-04-14 02:09:32,279 - ydrpolicy.backend.agent - INFO - Starting agent in terminal mode (using session history, not persistent)...
2025-04-14 02:09:32,279 - ydrpolicy.backend.agent.policy_agent - INFO - Creating Policy Agent (MCP Enabled: True)...
2025-04-14 02:09:32,279 - ydrpolicy.backend.agent.mcp_connection - WARNING - MCP Host 0.0.0.0 detected, using 'localhost' for client connection.
2025-04-14 02:09:32,280 - ydrpolicy.backend.agent.mcp_connection - INFO - Initializing MCP Server connection to: http://localhost:8001/sse
2025-04-14 02:09:32,280 - ydrpolicy.backend.agent.mcp_connection - INFO - MCPServerSse instance created.
2025-04-14 02:09:32,280 - ydrpolicy.backend.agent.policy_agent - INFO - MCP server configured for the agent.
2025-04-14 02:09:32,280 - ydrpolicy.backend.agent.policy_agent - INFO - SUCCESS: Policy Agent instance created successfully.
2025-04-14 02:09:32,301 - ydrpolicy.backend.agent.terminal - INFO - Terminal Mode: MCP connected.
2025-04-14 02:09:36,721 - ydrpolicy.backend.mcp.server - INFO - Received find_similar_chunks request: query='Yale policy on resident shifts on high volume hour...', k=5, threshold=None
2025-04-14 02:09:37,333 - ydrpolicy.backend.database.repository.policies - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-14 02:09:37,343 - ydrpolicy.backend.mcp.server - INFO - Found 5 similar chunks.
2025-04-14 02:09:41,022 - ydrpolicy.backend.mcp.server - INFO - Received get_policy_from_ID request for policy_id: 2
2025-04-14 02:09:49,275 - ydrpolicy.backend.agent.terminal - ERROR - Terminal Mode: MCP close error: 'MCPServerSse' object has no attribute 'close'
Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/main.py", line 481, in terminal_chat
    await mcp_server_instance.close() # Close explicitly
          ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'MCPServerSse' object has no attribute 'close'
2025-04-14 02:09:49,329 - ydrpolicy.backend.agent.terminal - INFO - Terminal chat session ended.
2025-04-14 02:09:49,385 - ydrpolicy.backend.agent - INFO - Terminal agent process finished.
2025-04-14 02:12:22,970 - ydrpolicy.backend.agent - INFO - Executing agent command...
2025-04-14 02:12:22,970 - ydrpolicy.backend.agent - INFO - Agent requested mode: Terminal
2025-04-14 02:12:22,970 - ydrpolicy.backend.agent - INFO - MCP Tool Connection: Enabled
2025-04-14 02:12:22,971 - ydrpolicy.backend.agent - INFO - Starting agent in terminal mode (using session history, not persistent)...
2025-04-14 02:12:22,971 - ydrpolicy.backend.agent.policy_agent - INFO - Creating Policy Agent (MCP Enabled: True)...
2025-04-14 02:12:22,971 - ydrpolicy.backend.agent.mcp_connection - WARNING - MCP Host 0.0.0.0 detected, using 'localhost' for client connection.
2025-04-14 02:12:22,972 - ydrpolicy.backend.agent.mcp_connection - INFO - Initializing MCP Server connection to: http://localhost:8001/sse
2025-04-14 02:12:22,972 - ydrpolicy.backend.agent.mcp_connection - INFO - MCPServerSse instance created.
2025-04-14 02:12:22,972 - ydrpolicy.backend.agent.policy_agent - INFO - MCP server configured for the agent.
2025-04-14 02:12:22,973 - ydrpolicy.backend.agent.policy_agent - INFO - SUCCESS: Policy Agent instance created successfully.
2025-04-14 02:12:22,994 - ydrpolicy.backend.agent.terminal - INFO - Terminal Mode: MCP connection established via async context.
2025-04-14 02:12:25,069 - ydrpolicy.backend.agent.terminal - INFO - Terminal chat session ended.
2025-04-14 02:12:25,071 - ydrpolicy.backend.agent - INFO - Terminal agent process finished.
2025-04-14 02:12:28,757 - ydrpolicy.backend.agent - INFO - Executing agent command...
2025-04-14 02:12:28,758 - ydrpolicy.backend.agent - INFO - Agent requested mode: Terminal
2025-04-14 02:12:28,758 - ydrpolicy.backend.agent - INFO - MCP Tool Connection: Enabled
2025-04-14 02:12:28,758 - ydrpolicy.backend.agent - INFO - Starting agent in terminal mode (using session history, not persistent)...
2025-04-14 02:12:28,759 - ydrpolicy.backend.agent.policy_agent - INFO - Creating Policy Agent (MCP Enabled: True)...
2025-04-14 02:12:28,759 - ydrpolicy.backend.agent.mcp_connection - WARNING - MCP Host 0.0.0.0 detected, using 'localhost' for client connection.
2025-04-14 02:12:28,759 - ydrpolicy.backend.agent.mcp_connection - INFO - Initializing MCP Server connection to: http://localhost:8001/sse
2025-04-14 02:12:28,759 - ydrpolicy.backend.agent.mcp_connection - INFO - MCPServerSse instance created.
2025-04-14 02:12:28,760 - ydrpolicy.backend.agent.policy_agent - INFO - MCP server configured for the agent.
2025-04-14 02:12:28,760 - ydrpolicy.backend.agent.policy_agent - INFO - SUCCESS: Policy Agent instance created successfully.
2025-04-14 02:12:28,780 - ydrpolicy.backend.agent.terminal - INFO - Terminal Mode: MCP connection established via async context.
2025-04-14 02:12:45,576 - ydrpolicy.backend.mcp.server - INFO - Received find_similar_chunks request: query='Yale policy on resident shifts on high volume hour...', k=5, threshold=None
2025-04-14 02:12:45,950 - ydrpolicy.backend.database.repository.policies - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-14 02:12:45,959 - ydrpolicy.backend.mcp.server - INFO - Found 5 similar chunks.
2025-04-14 02:12:53,562 - ydrpolicy.backend.mcp.server - INFO - Received get_policy_from_ID request for policy_id: 2
2025-04-14 02:13:00,398 - ydrpolicy.backend.agent.terminal - INFO - Terminal chat session ended.
2025-04-14 02:13:00,401 - ydrpolicy.backend.agent - INFO - Terminal agent process finished.
2025-04-14 02:13:09,270 - ydrpolicy.backend.agent - INFO - Executing agent command...
2025-04-14 02:13:09,271 - ydrpolicy.backend.agent - INFO - Agent requested mode: Terminal
2025-04-14 02:13:09,271 - ydrpolicy.backend.agent - INFO - MCP Tool Connection: Disabled
2025-04-14 02:13:09,271 - ydrpolicy.backend.agent - INFO - Starting agent in terminal mode (using session history, not persistent)...
2025-04-14 02:13:09,272 - ydrpolicy.backend.agent.policy_agent - INFO - Creating Policy Agent (MCP Enabled: False)...
2025-04-14 02:13:09,272 - ydrpolicy.backend.agent.policy_agent - INFO - SUCCESS: Policy Agent instance created successfully.
2025-04-14 02:13:09,273 - ydrpolicy.backend.agent.terminal - CRITICAL - Terminal agent start failed: 'coroutine' object does not support the asynchronous context manager protocol
Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/main.py", line 351, in terminal_chat
    async with mcp_server_instance if mcp_server_instance and isinstance(mcp_server_instance, MCPServerSse) else asyncio.sleep(0) as active_mcp_connection: # type: ignore
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: 'coroutine' object does not support the asynchronous context manager protocol
2025-04-14 02:13:09,297 - ydrpolicy.backend.agent.terminal - INFO - Terminal chat session ended.
2025-04-14 02:13:09,297 - ydrpolicy.backend.agent - INFO - Terminal agent process finished.
2025-04-14 02:15:24,600 - ydrpolicy.backend.agent - INFO - Executing agent command...
2025-04-14 02:15:24,600 - ydrpolicy.backend.agent - INFO - Agent requested mode: Terminal
2025-04-14 02:15:24,600 - ydrpolicy.backend.agent - INFO - MCP Tool Connection: Disabled
2025-04-14 02:15:24,601 - ydrpolicy.backend.agent - INFO - Starting agent in terminal mode (using session history, not persistent)...
2025-04-14 02:15:24,601 - ydrpolicy.backend.agent.policy_agent - INFO - Creating Policy Agent (MCP Enabled: False)...
2025-04-14 02:15:24,601 - ydrpolicy.backend.agent.policy_agent - INFO - SUCCESS: Policy Agent instance created successfully.
2025-04-14 02:15:33,170 - ydrpolicy.backend.agent.terminal - INFO - Terminal chat session ended.
2025-04-14 02:15:33,172 - ydrpolicy.backend.agent - INFO - Terminal agent process finished.
2025-04-14 02:15:38,514 - ydrpolicy.backend.agent - INFO - Executing agent command...
2025-04-14 02:15:38,515 - ydrpolicy.backend.agent - INFO - Agent requested mode: Terminal
2025-04-14 02:15:38,515 - ydrpolicy.backend.agent - INFO - MCP Tool Connection: Enabled
2025-04-14 02:15:38,515 - ydrpolicy.backend.agent - INFO - Starting agent in terminal mode (using session history, not persistent)...
2025-04-14 02:15:38,516 - ydrpolicy.backend.agent.policy_agent - INFO - Creating Policy Agent (MCP Enabled: True)...
2025-04-14 02:15:38,516 - ydrpolicy.backend.agent.mcp_connection - WARNING - MCP Host 0.0.0.0 detected, using 'localhost' for client connection.
2025-04-14 02:15:38,516 - ydrpolicy.backend.agent.mcp_connection - INFO - Initializing MCP Server connection to: http://localhost:8001/sse
2025-04-14 02:15:38,517 - ydrpolicy.backend.agent.mcp_connection - INFO - MCPServerSse instance created.
2025-04-14 02:15:38,517 - ydrpolicy.backend.agent.policy_agent - INFO - MCP server configured for the agent.
2025-04-14 02:15:38,517 - ydrpolicy.backend.agent.policy_agent - INFO - SUCCESS: Policy Agent instance created successfully.
2025-04-14 02:15:38,537 - ydrpolicy.backend.agent.terminal - INFO - Terminal Mode: MCP connection established via async context.
2025-04-14 02:15:56,320 - ydrpolicy.backend.mcp.server - INFO - Received find_similar_chunks request: query='resident shift during high volume hours policy...', k=5, threshold=None
2025-04-14 02:15:56,554 - ydrpolicy.backend.database.repository.policies - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-14 02:15:56,566 - ydrpolicy.backend.mcp.server - INFO - Found 5 similar chunks.
2025-04-14 02:15:59,842 - ydrpolicy.backend.mcp.server - INFO - Received find_similar_chunks request: query='resident shift high volume hours diagnostic radiol...', k=5, threshold=None
2025-04-14 02:16:00,451 - ydrpolicy.backend.database.repository.policies - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-14 02:16:00,460 - ydrpolicy.backend.mcp.server - INFO - Found 5 similar chunks.
2025-04-14 02:16:08,313 - ydrpolicy.backend.mcp.server - INFO - Received get_policy_from_ID request for policy_id: 2
2025-04-14 02:16:19,725 - ydrpolicy.backend.agent.terminal - INFO - Terminal chat session ended.
2025-04-14 02:16:19,727 - ydrpolicy.backend.agent - INFO - Terminal agent process finished.
2025-04-14 02:16:24,086 - ydrpolicy.backend.mcp.server - INFO - MCP server process finished.
2025-04-14 02:16:24,087 - ydrpolicy.backend.mcp - INFO - MCP server process finished.
2025-04-14 02:16:27,599 - ydrpolicy.backend.mcp - INFO - Attempting to start MCP server on 0.0.0.0:8001 via http transport...
2025-04-14 02:16:27,599 - ydrpolicy.backend.mcp.server - INFO - Attempting to start MCP server using http transport...
2025-04-14 02:16:27,600 - ydrpolicy.backend.mcp.server - INFO - Running MCP server with http/sse transport via uvicorn on 0.0.0.0:8001.
2025-04-14 02:16:28,530 - ydrpolicy.backend.mcp.server - INFO - MCP server process finished.
2025-04-14 02:16:28,533 - ydrpolicy.backend.mcp - INFO - MCP server process finished.
2025-04-14 02:16:33,671 - ydrpolicy.backend.mcp - WARNING - Running MCP in stdio mode with console logging potentially enabled (if --no-log not used). Attempting to disable console handler dynamically.
2025-04-14 02:16:33,672 - ydrpolicy.backend.mcp - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio transport...
2025-04-14 02:16:33,672 - ydrpolicy.backend.mcp.server - INFO - Attempting to start MCP server using stdio transport...
2025-04-14 02:16:33,672 - ydrpolicy.backend.mcp.server - INFO - Configuring logger for stdio mode (disabling console handler)...
2025-04-14 02:16:33,673 - ydrpolicy.backend.mcp.server - INFO - Removed RichHandler: <RichHandler (INFO)>
2025-04-14 02:16:33,673 - ydrpolicy.backend.mcp.server - INFO - Console logging disabled for stdio mode.
2025-04-14 02:16:33,673 - ydrpolicy.backend.mcp.server - INFO - Running MCP server with stdio transport.
2025-04-14 02:16:34,981 - ydrpolicy.backend.mcp - INFO - MCP server startup interrupted by user.
2025-04-14 02:16:34,982 - ydrpolicy.backend.mcp - INFO - MCP server process finished.
