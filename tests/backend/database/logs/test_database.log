2025-04-09 21:33:21,170 - TestDBConnection - INFO - Backend logging initialized. Log file: /Users/pouria/Documents/Coding/YDR Policy Scraping/tests/backend/database/logs/test_database.log
2025-04-09 21:33:21,171 - TestDBConnection - INFO - Connecting to admin database to drop ydrpolicy_test
2025-04-09 21:33:21,192 - TestDBConnection - INFO - Database ydrpolicy_test does not exist
2025-04-09 21:33:21,195 - TestDBConnection - INFO - Connecting to admin database to create ydrpolicy_test
2025-04-09 21:33:21,263 - TestDBConnection - INFO - Created database ydrpolicy_test
2025-04-09 21:33:21,265 - TestDBConnection - INFO - Setting up database at postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test
2025-04-09 21:33:21,273 - TestDBConnection - INFO - Connection test result: 1
2025-04-09 21:33:21,281 - TestDBConnection - INFO - Vector extension created or exists
2025-04-09 21:33:21,312 - TestDBConnection - INFO - Tables created
2025-04-09 21:33:21,315 - TestDBConnection - INFO - Search vector triggers created
2025-04-09 21:33:21,320 - TestDBConnection - INFO - Verifying database tables
2025-04-09 21:33:21,327 - TestDBConnection - INFO - Found tables: ['policies', 'policy_chunks', 'images', 'users', 'chats', 'policy_updates', 'messages', 'tool_usage']
2025-04-09 21:33:21,327 - TestDBConnection - INFO - All expected tables found
2025-04-09 21:33:21,329 - TestDBConnection - INFO - Testing User Repository operations
2025-04-09 21:33:21,364 - TestDBConnection - INFO - Created user: 1 - test@example.com
2025-04-09 21:33:21,368 - TestDBConnection - INFO - Successfully fetched user by ID: test@example.com
2025-04-09 21:33:21,372 - TestDBConnection - INFO - Successfully fetched user by email: test@example.com
2025-04-09 21:33:21,383 - TestDBConnection - INFO - Successfully updated user: Updated User
2025-04-09 21:33:21,389 - TestDBConnection - INFO - Successfully deleted user
2025-04-09 21:33:21,394 - TestDBConnection - INFO - User Repository tests passed!
2025-04-09 21:33:21,398 - TestDBConnection - INFO - Testing Policy Repository operations
2025-04-09 21:33:21,418 - TestDBConnection - INFO - Created policy: 1 - Test Policy
2025-04-09 21:33:21,419 - TestDBConnection - INFO - Search vector trigger worked correctly
2025-04-09 21:33:21,421 - TestDBConnection - INFO - Successfully fetched policy by ID: Test Policy
2025-04-09 21:33:21,423 - TestDBConnection - INFO - Successfully fetched policy by title: Test Policy
2025-04-09 21:33:21,426 - TestDBConnection - INFO - Successfully fetched policy by URL: Test Policy
2025-04-09 21:33:21,442 - TestDBConnection - INFO - Created policy chunk: 1
2025-04-09 21:33:21,443 - TestDBConnection - INFO - Full text search successful: 1 results
2025-04-09 21:33:21,445 - TestDBConnection - INFO - Successfully updated policy: Updated Policy Title
2025-04-09 21:33:21,450 - TestDBConnection - INFO - Logged policy update: 1
2025-04-09 21:33:21,452 - TestDBConnection - INFO - Policy update history retrieved: 1 entries
2025-04-09 21:33:21,458 - TestDBConnection - INFO - Successfully deleted policy
2025-04-09 21:33:21,459 - TestDBConnection - INFO - Policy Repository tests passed!
2025-04-09 21:33:21,463 - TestDBConnection - INFO - Testing additional tables (images, chats, messages, tool usage)
2025-04-09 21:33:21,471 - TestDBConnection - INFO - Created user for chat test: 3
2025-04-09 21:33:21,477 - TestDBConnection - INFO - Created policy for image test: 2
2025-04-09 21:33:21,479 - TestDBConnection - INFO - Created image: 1 for policy 2
2025-04-09 21:33:21,481 - TestDBConnection - INFO - Created chat: 1 for user 3
2025-04-09 21:33:21,482 - TestDBConnection - INFO - Created user message: 1
2025-04-09 21:33:21,483 - TestDBConnection - INFO - Created assistant message: 2
2025-04-09 21:33:21,484 - TestDBConnection - INFO - Created tool usage: 1
2025-04-09 21:33:21,485 - TestDBConnection - INFO - Additional tables test complete - all test data committed
2025-04-09 21:33:21,489 - TestDBConnection - INFO - Testing policy chunking and embedding functionality
2025-04-09 21:33:21,501 - TestDBConnection - INFO - Created policy for chunking test: 3
2025-04-09 21:33:21,512 - TestDBConnection - INFO - Created chunk 0: 2 with embedding
2025-04-09 21:33:21,515 - TestDBConnection - INFO - Created chunk 1: 3 with embedding
2025-04-09 21:33:21,517 - TestDBConnection - INFO - Created chunk 2: 4 with embedding
2025-04-09 21:33:21,519 - TestDBConnection - INFO - Successfully retrieved 3 chunks for policy
2025-04-09 21:33:21,521 - TestDBConnection - INFO - Found previous chunk(s): 2
2025-04-09 21:33:21,522 - TestDBConnection - INFO - Found next chunk(s): 4
2025-04-09 21:33:21,522 - TestDBConnection - INFO - Successfully retrieved chunk neighbors
2025-04-09 21:33:21,524 - TestDBConnection - INFO - Vector search returned 2 results
2025-04-09 21:33:21,524 - TestDBConnection - INFO - Keeping policy chunks in database for inspection
2025-04-09 21:33:21,528 - TestDBConnection - INFO - All database tests passed successfully!
2025-04-09 21:33:21,528 - TestDBConnection - INFO - Connecting to admin database to drop ydrpolicy_test
2025-04-09 21:33:21,536 - TestDBConnection - INFO - Terminating all connections to ydrpolicy_test
2025-04-09 21:33:22,039 - TestDBConnection - INFO - Dropping database ydrpolicy_test
2025-04-09 21:33:22,069 - TestDBConnection - INFO - Dropped database ydrpolicy_test
2025-04-09 22:22:22,273 - TestDBConnection - INFO - Backend logging initialized. Log file: /Users/pouria/Documents/Coding/YDR Policy Scraping/tests/backend/database/logs/test_database.log
2025-04-09 22:22:22,273 - TestDBConnection - INFO - Connecting to admin database to drop ydrpolicy_test
2025-04-09 22:22:22,295 - TestDBConnection - INFO - Database ydrpolicy_test does not exist
2025-04-09 22:22:22,299 - TestDBConnection - INFO - Connecting to admin database to create ydrpolicy_test
2025-04-09 22:22:22,371 - TestDBConnection - INFO - Created database ydrpolicy_test
2025-04-09 22:22:22,374 - TestDBConnection - INFO - Setting up database at postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test
2025-04-09 22:22:22,381 - TestDBConnection - INFO - Connection test result: 1
2025-04-09 22:22:22,391 - TestDBConnection - INFO - Vector extension created or exists
2025-04-09 22:22:22,423 - TestDBConnection - INFO - Tables created
2025-04-09 22:22:22,427 - TestDBConnection - INFO - Search vector triggers created
2025-04-09 22:22:22,432 - TestDBConnection - INFO - Verifying database tables
2025-04-09 22:22:22,439 - TestDBConnection - INFO - Found tables: ['policies', 'policy_chunks', 'images', 'users', 'chats', 'policy_updates', 'messages', 'tool_usage']
2025-04-09 22:22:22,440 - TestDBConnection - INFO - All expected tables found
2025-04-09 22:22:22,441 - TestDBConnection - INFO - Testing User Repository operations
2025-04-09 22:22:22,455 - TestDBConnection - INFO - Created user: 1 - test@example.com
2025-04-09 22:22:22,456 - TestDBConnection - INFO - Successfully fetched user by ID: test@example.com
2025-04-09 22:22:22,457 - TestDBConnection - INFO - Successfully fetched user by email: test@example.com
2025-04-09 22:22:22,459 - TestDBConnection - INFO - Successfully updated user: Updated User
2025-04-09 22:22:22,460 - TestDBConnection - INFO - Successfully deleted user
2025-04-09 22:22:22,460 - TestDBConnection - INFO - User Repository tests passed!
2025-04-09 22:22:22,462 - TestDBConnection - INFO - Testing Policy Repository operations
2025-04-09 22:22:22,472 - TestDBConnection - INFO - Created policy: 1 - Test Policy
2025-04-09 22:22:22,472 - TestDBConnection - INFO - Search vector trigger worked correctly
2025-04-09 22:22:22,473 - TestDBConnection - INFO - Successfully fetched policy by ID: Test Policy
2025-04-09 22:22:22,474 - TestDBConnection - INFO - Successfully fetched policy by title: Test Policy
2025-04-09 22:22:22,475 - TestDBConnection - INFO - Successfully fetched policy by URL: Test Policy
2025-04-09 22:22:22,481 - TestDBConnection - INFO - Created policy chunk: 1
2025-04-09 22:22:22,482 - TestDBConnection - INFO - Full text search successful: 1 results
2025-04-09 22:22:22,483 - TestDBConnection - INFO - Successfully updated policy: Updated Policy Title
2025-04-09 22:22:22,487 - TestDBConnection - INFO - Logged policy update: 1
2025-04-09 22:22:22,489 - TestDBConnection - INFO - Policy update history retrieved: 1 entries
2025-04-09 22:22:22,495 - TestDBConnection - INFO - Successfully deleted policy
2025-04-09 22:22:22,495 - TestDBConnection - INFO - Policy Repository tests passed!
2025-04-09 22:22:22,498 - TestDBConnection - INFO - Testing additional tables (images, chats, messages, tool usage)
2025-04-09 22:22:22,504 - TestDBConnection - INFO - Created user for chat test: 3
2025-04-09 22:22:22,507 - TestDBConnection - INFO - Created policy for image test: 2
2025-04-09 22:22:22,509 - TestDBConnection - INFO - Created image: 1 for policy 2
2025-04-09 22:22:22,510 - TestDBConnection - INFO - Created chat: 1 for user 3
2025-04-09 22:22:22,511 - TestDBConnection - INFO - Created user message: 1
2025-04-09 22:22:22,512 - TestDBConnection - INFO - Created assistant message: 2
2025-04-09 22:22:22,513 - TestDBConnection - INFO - Created tool usage: 1
2025-04-09 22:22:22,514 - TestDBConnection - INFO - Additional tables test complete - all test data committed
2025-04-09 22:22:22,516 - TestDBConnection - INFO - Testing policy chunking and embedding functionality
2025-04-09 22:22:22,524 - TestDBConnection - INFO - Created policy for chunking test: 3
2025-04-09 22:22:22,531 - TestDBConnection - INFO - Created chunk 0: 2 with embedding
2025-04-09 22:22:22,533 - TestDBConnection - INFO - Created chunk 1: 3 with embedding
2025-04-09 22:22:22,534 - TestDBConnection - INFO - Created chunk 2: 4 with embedding
2025-04-09 22:22:22,535 - TestDBConnection - INFO - Successfully retrieved 3 chunks for policy
2025-04-09 22:22:22,537 - TestDBConnection - INFO - Found previous chunk(s): 2
2025-04-09 22:22:22,537 - TestDBConnection - INFO - Found next chunk(s): 4
2025-04-09 22:22:22,537 - TestDBConnection - INFO - Successfully retrieved chunk neighbors
2025-04-09 22:22:22,539 - TestDBConnection - INFO - Vector search returned 2 results
2025-04-09 22:22:22,539 - TestDBConnection - INFO - Keeping policy chunks in database for inspection
2025-04-09 22:22:22,541 - TestDBConnection - INFO - All database tests passed successfully!
2025-04-09 22:22:22,542 - TestDBConnection - INFO - Connecting to admin database to drop ydrpolicy_test
2025-04-09 22:22:22,547 - TestDBConnection - INFO - Terminating all connections to ydrpolicy_test
2025-04-09 22:22:23,050 - TestDBConnection - INFO - Dropping database ydrpolicy_test
2025-04-09 22:22:23,090 - TestDBConnection - INFO - Dropped database ydrpolicy_test
2025-04-09 23:16:33,723 - TestDBConnection - INFO - Backend logging initialized. Log file: /Users/pouria/Documents/Coding/YDRP-RAG/tests/backend/database/logs/test_database.log
2025-04-09 23:16:33,724 - TestDBConnection - INFO - Connecting to admin database to drop ydrpolicy_test
2025-04-09 23:16:33,744 - TestDBConnection - INFO - Database ydrpolicy_test does not exist
2025-04-09 23:16:33,749 - TestDBConnection - INFO - Connecting to admin database to create ydrpolicy_test
2025-04-09 23:16:33,814 - TestDBConnection - INFO - Created database ydrpolicy_test
2025-04-09 23:16:33,816 - TestDBConnection - INFO - Setting up database at postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test
2025-04-09 23:16:33,823 - TestDBConnection - INFO - Connection test result: 1
2025-04-09 23:16:33,832 - TestDBConnection - INFO - Vector extension created or exists
2025-04-09 23:16:33,861 - TestDBConnection - INFO - Tables created
2025-04-09 23:16:33,865 - TestDBConnection - INFO - Search vector triggers created
2025-04-09 23:16:33,869 - TestDBConnection - INFO - Verifying database tables
2025-04-09 23:16:33,876 - TestDBConnection - INFO - Found tables: ['policies', 'policy_chunks', 'images', 'users', 'chats', 'policy_updates', 'messages', 'tool_usage']
2025-04-09 23:16:33,876 - TestDBConnection - INFO - All expected tables found
2025-04-09 23:16:33,878 - TestDBConnection - INFO - Testing User Repository operations
2025-04-09 23:16:33,891 - TestDBConnection - INFO - Created user: 1 - test@example.com
2025-04-09 23:16:33,892 - TestDBConnection - INFO - Successfully fetched user by ID: test@example.com
2025-04-09 23:16:33,893 - TestDBConnection - INFO - Successfully fetched user by email: test@example.com
2025-04-09 23:16:33,895 - TestDBConnection - INFO - Successfully updated user: Updated User
2025-04-09 23:16:33,896 - TestDBConnection - INFO - Successfully deleted user
2025-04-09 23:16:33,896 - TestDBConnection - INFO - User Repository tests passed!
2025-04-09 23:16:33,898 - TestDBConnection - INFO - Testing Policy Repository operations
2025-04-09 23:16:33,908 - TestDBConnection - INFO - Created policy: 1 - Test Policy
2025-04-09 23:16:33,908 - TestDBConnection - INFO - Search vector trigger worked correctly
2025-04-09 23:16:33,909 - TestDBConnection - INFO - Successfully fetched policy by ID: Test Policy
2025-04-09 23:16:33,910 - TestDBConnection - INFO - Successfully fetched policy by title: Test Policy
2025-04-09 23:16:33,911 - TestDBConnection - INFO - Successfully fetched policy by URL: Test Policy
2025-04-09 23:16:33,917 - TestDBConnection - INFO - Created policy chunk: 1
2025-04-09 23:16:33,918 - TestDBConnection - INFO - Full text search successful: 1 results
2025-04-09 23:16:33,919 - TestDBConnection - INFO - Successfully updated policy: Updated Policy Title
2025-04-09 23:16:33,923 - TestDBConnection - INFO - Logged policy update: 1
2025-04-09 23:16:33,925 - TestDBConnection - INFO - Policy update history retrieved: 1 entries
2025-04-09 23:16:33,931 - TestDBConnection - INFO - Successfully deleted policy
2025-04-09 23:16:33,931 - TestDBConnection - INFO - Policy Repository tests passed!
2025-04-09 23:16:33,934 - TestDBConnection - INFO - Testing additional tables (images, chats, messages, tool usage)
2025-04-09 23:16:33,941 - TestDBConnection - INFO - Created user for chat test: 3
2025-04-09 23:16:33,944 - TestDBConnection - INFO - Created policy for image test: 2
2025-04-09 23:16:33,945 - TestDBConnection - INFO - Created image: 1 for policy 2
2025-04-09 23:16:33,947 - TestDBConnection - INFO - Created chat: 1 for user 3
2025-04-09 23:16:33,948 - TestDBConnection - INFO - Created user message: 1
2025-04-09 23:16:33,948 - TestDBConnection - INFO - Created assistant message: 2
2025-04-09 23:16:33,949 - TestDBConnection - INFO - Created tool usage: 1
2025-04-09 23:16:33,950 - TestDBConnection - INFO - Additional tables test complete - all test data committed
2025-04-09 23:16:33,952 - TestDBConnection - INFO - Testing policy chunking and embedding functionality
2025-04-09 23:16:33,960 - TestDBConnection - INFO - Created policy for chunking test: 3
2025-04-09 23:16:33,967 - TestDBConnection - INFO - Created chunk 0: 2 with embedding
2025-04-09 23:16:33,969 - TestDBConnection - INFO - Created chunk 1: 3 with embedding
2025-04-09 23:16:33,970 - TestDBConnection - INFO - Created chunk 2: 4 with embedding
2025-04-09 23:16:33,972 - TestDBConnection - INFO - Successfully retrieved 3 chunks for policy
2025-04-09 23:16:33,974 - TestDBConnection - INFO - Found previous chunk(s): 2
2025-04-09 23:16:33,974 - TestDBConnection - INFO - Found next chunk(s): 4
2025-04-09 23:16:33,975 - TestDBConnection - INFO - Successfully retrieved chunk neighbors
2025-04-09 23:16:33,976 - TestDBConnection - INFO - Vector search returned 2 results
2025-04-09 23:16:33,976 - TestDBConnection - INFO - Keeping policy chunks in database for inspection
2025-04-09 23:16:33,979 - TestDBConnection - INFO - All database tests passed successfully!
2025-04-09 23:16:33,979 - TestDBConnection - INFO - Connecting to admin database to drop ydrpolicy_test
2025-04-09 23:16:33,984 - TestDBConnection - INFO - Terminating all connections to ydrpolicy_test
2025-04-09 23:16:34,487 - TestDBConnection - INFO - Dropping database ydrpolicy_test
2025-04-09 23:16:34,524 - TestDBConnection - INFO - Dropped database ydrpolicy_test
