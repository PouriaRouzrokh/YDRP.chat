2025-03-30 09:01:41,738 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 18:08:20,405 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 18:08:20,409 - BackendLogger - WARNING - Attempted to embed empty text
2025-04-09 18:08:20,409 - BackendLogger - WARNING - Attempted to embed empty text
2025-04-09 18:08:20,410 - BackendLogger - ERROR - Error generating embedding: Simulated API Error
2025-04-09 18:08:20,411 - BackendLogger - INFO - Generating embeddings for 2 texts
2025-04-09 18:08:20,411 - BackendLogger - INFO - Successfully generated 2 embeddings
2025-04-09 18:08:20,412 - BackendLogger - WARNING - Empty text at index 1 will receive a zero vector
2025-04-09 18:08:20,413 - BackendLogger - WARNING - Empty text at index 2 will receive a zero vector
2025-04-09 18:08:20,414 - BackendLogger - WARNING - Empty text at index 4 will receive a zero vector
2025-04-09 18:08:20,414 - BackendLogger - INFO - Generating embeddings for 2 texts
2025-04-09 18:08:20,414 - BackendLogger - INFO - Successfully generated 2 embeddings
2025-04-09 18:08:20,415 - BackendLogger - WARNING - Empty text at index 0 will receive a zero vector
2025-04-09 18:08:20,415 - BackendLogger - WARNING - Empty text at index 1 will receive a zero vector
2025-04-09 18:08:20,415 - BackendLogger - WARNING - Empty text at index 2 will receive a zero vector
2025-04-09 18:08:20,416 - BackendLogger - INFO - Generating embeddings for 2 texts
2025-04-09 18:08:20,417 - BackendLogger - ERROR - Error generating embeddings: Simulated API Error Batch
2025-04-09 18:12:38,897 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 18:15:39,225 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 18:15:39,792 - PytestDB - INFO - Backend logging initialized. Log file: /Users/pouria/Documents/Coding/YDR Policy Scraping/data/logs/backend.log
2025-04-09 18:15:39,792 - PytestDB - INFO - Using Test Database URL: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test
2025-04-09 18:15:39,802 - PytestDB - INFO - Setting up test database (session scope)...
2025-04-09 18:15:39,803 - PytestDB - WARNING - Attempting to drop test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test' if it exists...
2025-04-09 18:15:39,803 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test'... THIS WILL DELETE ALL DATA!
2025-04-09 18:15:39,803 - BackendLogger - ERROR - Error parsing database URL 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test' for dropping: pytest: reading from stdin while output is captured!  Consider using `-s`.
2025-04-09 18:15:39,804 - PytestDB - INFO - Attempting to create test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test'...
2025-04-09 18:15:39,804 - BackendLogger - INFO - Checking if database 'ydrpolicy_test' exists...
2025-04-09 18:15:39,813 - BackendLogger - INFO - Creating database 'ydrpolicy_test'...
2025-04-09 18:15:39,907 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' created.
2025-04-09 18:15:39,909 - PytestDB - INFO - Test database created or already exists.
2025-04-09 18:15:39,909 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 18:15:39,910 - BackendLogger - ERROR - Error creating extension 'vector': 'async_generator' object has no attribute 'begin'
2025-04-09 18:15:39,910 - PytestDB - INFO - Creating tables in test database...
2025-04-09 18:16:21,309 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 18:16:21,538 - PytestDB - INFO - Backend logging initialized. Log file: /Users/pouria/Documents/Coding/YDR Policy Scraping/data/logs/backend.log
2025-04-09 18:16:21,538 - PytestDB - INFO - Using Test Database URL: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test
2025-04-09 18:16:21,547 - PytestDB - INFO - Setting up test database (session scope)...
2025-04-09 18:16:21,547 - PytestDB - WARNING - Attempting to drop test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test' if it exists...
2025-04-09 18:16:21,548 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test'... THIS WILL DELETE ALL DATA!
2025-04-09 18:21:57,444 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 18:21:57,758 - PytestDB - INFO - Backend logging initialized. Log file: /Users/pouria/Documents/Coding/YDR Policy Scraping/data/logs/backend.log
2025-04-09 18:21:57,759 - PytestDB - INFO - Using Test Database URL: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test
2025-04-09 18:21:57,769 - PytestDB - INFO - Setting up test database (session scope)...
2025-04-09 18:21:57,769 - PytestDB - WARNING - Attempting to drop test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test' if it exists...
2025-04-09 18:21:57,770 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test'... THIS WILL DELETE ALL DATA!
2025-04-09 18:21:57,781 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy_test'...
2025-04-09 18:21:57,787 - BackendLogger - INFO - Connections terminated.
2025-04-09 18:21:57,787 - BackendLogger - INFO - Dropping database 'ydrpolicy_test'...
2025-04-09 18:21:57,816 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' dropped successfully.
2025-04-09 18:21:57,818 - PytestDB - INFO - Attempting to create test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test'...
2025-04-09 18:21:57,819 - BackendLogger - INFO - Checking if database 'ydrpolicy_test' exists...
2025-04-09 18:21:57,824 - BackendLogger - INFO - Creating database 'ydrpolicy_test'...
2025-04-09 18:21:57,867 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' created.
2025-04-09 18:21:57,869 - PytestDB - INFO - Test database created or already exists.
2025-04-09 18:21:57,869 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 18:21:57,869 - BackendLogger - ERROR - Error creating extension 'vector': 'async_generator' object has no attribute 'begin'
2025-04-09 18:21:57,870 - PytestDB - INFO - Creating tables in test database...
2025-04-09 18:22:28,399 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 18:22:28,634 - PytestDB - INFO - Backend logging initialized. Log file: /Users/pouria/Documents/Coding/YDR Policy Scraping/data/logs/backend.log
2025-04-09 18:22:28,635 - PytestDB - INFO - Using Test Database URL: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test
2025-04-09 18:22:28,645 - PytestDB - INFO - Setting up test database (session scope)...
2025-04-09 18:22:28,645 - PytestDB - WARNING - Attempting to drop test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test' if it exists...
2025-04-09 18:22:28,645 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test'... THIS WILL DELETE ALL DATA!
2025-04-09 18:22:28,651 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy_test'...
2025-04-09 18:22:28,654 - BackendLogger - INFO - Connections terminated.
2025-04-09 18:22:28,655 - BackendLogger - INFO - Dropping database 'ydrpolicy_test'...
2025-04-09 18:22:28,687 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' dropped successfully.
2025-04-09 18:22:28,688 - PytestDB - INFO - Attempting to create test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test'...
2025-04-09 18:22:28,688 - BackendLogger - INFO - Checking if database 'ydrpolicy_test' exists...
2025-04-09 18:22:28,691 - BackendLogger - INFO - Creating database 'ydrpolicy_test'...
2025-04-09 18:22:28,727 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' created.
2025-04-09 18:22:28,729 - PytestDB - INFO - Test database created or already exists.
2025-04-09 18:22:28,729 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 18:22:28,729 - BackendLogger - ERROR - Error creating extension 'vector': the greenlet library is required to use this function. No module named 'greenlet'
2025-04-09 18:22:28,730 - PytestDB - INFO - Creating tables in test database...
2025-04-09 18:22:28,730 - PytestDB - ERROR - CRITICAL: Unexpected error during database setup/teardown: the greenlet library is required to use this function. No module named 'greenlet'
2025-04-09 18:22:28,730 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test'... THIS WILL DELETE ALL DATA!
2025-04-09 18:22:43,259 - BackendLogger - INFO - Database drop cancelled.
2025-04-09 18:26:03,216 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 18:26:03,511 - PytestDB - INFO - Backend logging initialized. Log file: /Users/pouria/Documents/Coding/YDR Policy Scraping/data/logs/backend.log
2025-04-09 18:26:03,511 - PytestDB - INFO - Using Test Database URL: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test
2025-04-09 18:26:03,521 - PytestDB - INFO - Setting up test database (session scope)...
2025-04-09 18:26:03,522 - PytestDB - WARNING - Attempting to drop test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test' if it exists...
2025-04-09 18:26:03,522 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test'... THIS WILL DELETE ALL DATA!
2025-04-09 18:26:03,531 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy_test'...
2025-04-09 18:26:03,534 - BackendLogger - INFO - Connections terminated.
2025-04-09 18:26:03,535 - BackendLogger - INFO - Dropping database 'ydrpolicy_test'...
2025-04-09 18:26:03,564 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' dropped successfully.
2025-04-09 18:26:03,566 - PytestDB - INFO - Attempting to create test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test'...
2025-04-09 18:26:03,566 - BackendLogger - INFO - Checking if database 'ydrpolicy_test' exists...
2025-04-09 18:26:03,569 - BackendLogger - INFO - Creating database 'ydrpolicy_test'...
2025-04-09 18:26:03,607 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' created.
2025-04-09 18:26:03,608 - PytestDB - INFO - Test database created or already exists.
2025-04-09 18:26:03,609 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 18:26:03,609 - BackendLogger - ERROR - Error creating extension 'vector': the greenlet library is required to use this function. No module named 'greenlet'
2025-04-09 18:26:03,609 - PytestDB - INFO - Creating tables in test database...
2025-04-09 18:26:03,610 - PytestDB - ERROR - CRITICAL: Unexpected error during database setup/teardown: the greenlet library is required to use this function. No module named 'greenlet'
2025-04-09 18:26:03,610 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test'... THIS WILL DELETE ALL DATA!
2025-04-09 18:27:06,815 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy_test'...
2025-04-09 18:27:06,819 - BackendLogger - INFO - Connections terminated.
2025-04-09 18:27:06,819 - BackendLogger - INFO - Dropping database 'ydrpolicy_test'...
2025-04-09 18:27:06,848 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' dropped successfully.
2025-04-09 18:28:31,099 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 18:28:31,328 - PytestDB - INFO - Backend logging initialized. Log file: /Users/pouria/Documents/Coding/YDR Policy Scraping/data/logs/backend.log
2025-04-09 18:28:31,329 - PytestDB - INFO - Using Test Database URL: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test
2025-04-09 18:28:31,338 - PytestDB - INFO - Setting up test database (session scope)...
2025-04-09 18:28:31,339 - PytestDB - WARNING - Attempting to drop test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test' if it exists...
2025-04-09 18:28:31,339 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test'... THIS WILL DELETE ALL DATA!
2025-04-09 18:28:31,345 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy_test'...
2025-04-09 18:28:31,348 - BackendLogger - INFO - Connections terminated.
2025-04-09 18:28:31,349 - BackendLogger - INFO - Dropping database 'ydrpolicy_test'...
2025-04-09 18:28:31,349 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' dropped successfully.
2025-04-09 18:28:31,352 - PytestDB - INFO - Attempting to create test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test'...
2025-04-09 18:28:31,352 - BackendLogger - INFO - Checking if database 'ydrpolicy_test' exists...
2025-04-09 18:28:31,358 - BackendLogger - INFO - Creating database 'ydrpolicy_test'...
2025-04-09 18:28:31,416 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' created.
2025-04-09 18:28:31,418 - PytestDB - INFO - Test database created or already exists.
2025-04-09 18:28:31,418 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 18:28:31,419 - BackendLogger - ERROR - Error creating extension 'vector': the greenlet library is required to use this function. No module named 'greenlet'
2025-04-09 18:28:31,419 - PytestDB - INFO - Creating tables in test database...
2025-04-09 18:28:31,419 - PytestDB - ERROR - CRITICAL: Unexpected error during database setup/teardown: the greenlet library is required to use this function. No module named 'greenlet'
2025-04-09 18:28:31,420 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test'... THIS WILL DELETE ALL DATA!
2025-04-09 18:28:39,244 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy_test'...
2025-04-09 18:28:39,249 - BackendLogger - INFO - Connections terminated.
2025-04-09 18:28:39,250 - BackendLogger - INFO - Dropping database 'ydrpolicy_test'...
2025-04-09 18:28:39,277 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' dropped successfully.
2025-04-09 18:34:41,844 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 18:34:42,075 - PytestDB - INFO - Backend logging initialized. Log file: /Users/pouria/Documents/Coding/YDR Policy Scraping/data/logs/backend.log
2025-04-09 18:34:42,076 - PytestDB - INFO - Using Test Database URL: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test
2025-04-09 18:34:42,086 - PytestDB - INFO - Setting up test database (session scope)...
2025-04-09 18:34:42,086 - PytestDB - WARNING - Attempting to drop test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test' if it exists...
2025-04-09 18:34:42,087 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test'... THIS WILL DELETE ALL DATA!
2025-04-09 18:34:42,093 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy_test'...
2025-04-09 18:34:42,096 - BackendLogger - INFO - Connections terminated.
2025-04-09 18:34:42,096 - BackendLogger - INFO - Dropping database 'ydrpolicy_test'...
2025-04-09 18:34:42,097 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' dropped successfully.
2025-04-09 18:34:42,098 - PytestDB - INFO - Attempting to create test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test'...
2025-04-09 18:34:42,099 - BackendLogger - INFO - Checking if database 'ydrpolicy_test' exists...
2025-04-09 18:34:42,104 - BackendLogger - INFO - Creating database 'ydrpolicy_test'...
2025-04-09 18:34:42,162 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' created.
2025-04-09 18:34:42,164 - PytestDB - INFO - Test database created or already exists.
2025-04-09 18:34:42,164 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 18:34:42,165 - BackendLogger - ERROR - Error creating extension 'vector': the greenlet library is required to use this function. No module named 'greenlet'
2025-04-09 18:34:42,165 - PytestDB - INFO - Creating tables in test database...
2025-04-09 18:34:42,165 - PytestDB - ERROR - CRITICAL: Unexpected error during database setup/teardown: the greenlet library is required to use this function. No module named 'greenlet'
2025-04-09 18:34:42,166 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test'... THIS WILL DELETE ALL DATA!
2025-04-09 18:34:42,166 - BackendLogger - ERROR - Error parsing database URL 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test' for dropping: pytest: reading from stdin while output is captured!  Consider using `-s`.
2025-04-09 18:34:55,351 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 18:34:55,577 - PytestDB - INFO - Backend logging initialized. Log file: /Users/pouria/Documents/Coding/YDR Policy Scraping/data/logs/backend.log
2025-04-09 18:34:55,578 - PytestDB - INFO - Using Test Database URL: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test
2025-04-09 18:34:55,587 - PytestDB - INFO - Setting up test database (session scope)...
2025-04-09 18:34:55,588 - PytestDB - WARNING - Attempting to drop test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test' if it exists...
2025-04-09 18:34:55,588 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test'... THIS WILL DELETE ALL DATA!
2025-04-09 18:34:55,594 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy_test'...
2025-04-09 18:34:55,597 - BackendLogger - INFO - Connections terminated.
2025-04-09 18:34:55,597 - BackendLogger - INFO - Dropping database 'ydrpolicy_test'...
2025-04-09 18:34:55,625 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' dropped successfully.
2025-04-09 18:34:55,626 - PytestDB - INFO - Attempting to create test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test'...
2025-04-09 18:34:55,627 - BackendLogger - INFO - Checking if database 'ydrpolicy_test' exists...
2025-04-09 18:34:55,630 - BackendLogger - INFO - Creating database 'ydrpolicy_test'...
2025-04-09 18:34:55,672 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' created.
2025-04-09 18:34:55,673 - PytestDB - INFO - Test database created or already exists.
2025-04-09 18:34:55,674 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 18:34:55,841 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-09 18:34:55,842 - PytestDB - INFO - Creating tables in test database...
2025-04-09 18:34:55,904 - PytestDB - INFO - Tables created successfully.
2025-04-09 18:34:55,905 - PytestDB - INFO - Applying search vector triggers...
2025-04-09 18:34:55,909 - PytestDB - ERROR - CRITICAL: Unexpected error during database setup/teardown: BackendLogger.error() got an unexpected keyword argument 'exc_info'
2025-04-09 18:34:55,910 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test'... THIS WILL DELETE ALL DATA!
2025-04-09 18:34:55,911 - BackendLogger - ERROR - Error parsing database URL 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test' for dropping: pytest: reading from stdin while output is captured!  Consider using `-s`.
2025-04-09 18:35:19,927 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 18:35:20,158 - PytestDB - INFO - Backend logging initialized. Log file: /Users/pouria/Documents/Coding/YDR Policy Scraping/data/logs/backend.log
2025-04-09 18:35:20,158 - PytestDB - INFO - Using Test Database URL: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test
2025-04-09 18:35:20,167 - PytestDB - INFO - Setting up test database (session scope)...
2025-04-09 18:35:20,167 - PytestDB - WARNING - Attempting to drop test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test' if it exists...
2025-04-09 18:35:20,168 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test'... THIS WILL DELETE ALL DATA!
2025-04-09 18:35:20,174 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy_test'...
2025-04-09 18:35:20,177 - BackendLogger - INFO - Connections terminated.
2025-04-09 18:35:20,177 - BackendLogger - INFO - Dropping database 'ydrpolicy_test'...
2025-04-09 18:35:20,212 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' dropped successfully.
2025-04-09 18:35:20,214 - PytestDB - INFO - Attempting to create test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test'...
2025-04-09 18:35:20,214 - BackendLogger - INFO - Checking if database 'ydrpolicy_test' exists...
2025-04-09 18:35:20,217 - BackendLogger - INFO - Creating database 'ydrpolicy_test'...
2025-04-09 18:35:20,258 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' created.
2025-04-09 18:35:20,260 - PytestDB - INFO - Test database created or already exists.
2025-04-09 18:35:20,260 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 18:35:20,276 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-09 18:35:20,276 - PytestDB - INFO - Creating tables in test database...
2025-04-09 18:35:20,304 - PytestDB - INFO - Tables created successfully.
2025-04-09 18:35:20,304 - PytestDB - INFO - Applying search vector triggers...
2025-04-09 18:35:20,306 - PytestDB - ERROR - Failed to apply triggers: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.PostgresSyntaxError'>: cannot insert multiple commands into a prepared statement
[SQL: 
    -- Trigger function for the 'policies' table
    CREATE OR REPLACE FUNCTION policies_search_vector_update() RETURNS trigger AS $$
    BEGIN
        -- Combine title (A), description (B), and text_content (C)
        -- Use coalesce to handle potential NULL values
        NEW.search_vector = setweight(to_tsvector('english', COALESCE(NEW.title, '')), 'A') ||
                            setweight(to_tsvector('english', COALESCE(NEW.description, '')), 'B') ||
                            setweight(to_tsvector('english', COALESCE(NEW.text_content, '')), 'C');
        RETURN NEW;
    END
    $$ LANGUAGE plpgsql;

    -- Drop existing trigger before creating a new one to avoid errors
    DROP TRIGGER IF EXISTS policies_search_vector_trigger ON policies;

    -- Create the trigger for INSERT or UPDATE operations on 'policies'
    CREATE TRIGGER policies_search_vector_trigger
    BEFORE INSERT OR UPDATE ON policies
    FOR EACH ROW EXECUTE FUNCTION policies_search_vector_update();

    -- Trigger function for the 'policy_chunks' table
    CREATE OR REPLACE FUNCTION policy_chunks_search_vector_update() RETURNS trigger AS $$
    BEGIN
        -- Use only the chunk's content for its search vector
        NEW.search_vector = to_tsvector('english', COALESCE(NEW.content, ''));
        RETURN NEW;
    END
    $$ LANGUAGE plpgsql;

    -- Drop existing trigger before creating a new one to avoid errors
    DROP TRIGGER IF EXISTS policy_chunks_search_vector_trigger ON policy_chunks;

    -- Create the trigger for INSERT or UPDATE operations on 'policy_chunks'
    CREATE TRIGGER policy_chunks_search_vector_trigger
    BEFORE INSERT OR UPDATE ON policy_chunks
    FOR EACH ROW EXECUTE FUNCTION policy_chunks_search_vector_update();
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 521, in _prepare_and_execute
    prepared_stmt, attributes = await adapt_connection._prepare(
                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 768, in _prepare
    prepared_stmt = await self._connection.prepare(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/asyncpg/connection.py", line 635, in prepare
    return await self._prepare(
           ^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/asyncpg/connection.py", line 653, in _prepare
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/asyncpg/connection.py", line 432, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 165, in prepare
asyncpg.exceptions.PostgresSyntaxError: cannot insert multiple commands into a prepared statement

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.PostgresSyntaxError'>: cannot insert multiple commands into a prepared statement

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/tests/backend/database/conftest.py", line 98, in initialize_test_db
    await conn.execute(text(create_search_vector_trigger())) # Import text from sqlalchemy
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/engine.py", line 658, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.PostgresSyntaxError'>: cannot insert multiple commands into a prepared statement
[SQL: 
    -- Trigger function for the 'policies' table
    CREATE OR REPLACE FUNCTION policies_search_vector_update() RETURNS trigger AS $$
    BEGIN
        -- Combine title (A), description (B), and text_content (C)
        -- Use coalesce to handle potential NULL values
        NEW.search_vector = setweight(to_tsvector('english', COALESCE(NEW.title, '')), 'A') ||
                            setweight(to_tsvector('english', COALESCE(NEW.description, '')), 'B') ||
                            setweight(to_tsvector('english', COALESCE(NEW.text_content, '')), 'C');
        RETURN NEW;
    END
    $$ LANGUAGE plpgsql;

    -- Drop existing trigger before creating a new one to avoid errors
    DROP TRIGGER IF EXISTS policies_search_vector_trigger ON policies;

    -- Create the trigger for INSERT or UPDATE operations on 'policies'
    CREATE TRIGGER policies_search_vector_trigger
    BEFORE INSERT OR UPDATE ON policies
    FOR EACH ROW EXECUTE FUNCTION policies_search_vector_update();

    -- Trigger function for the 'policy_chunks' table
    CREATE OR REPLACE FUNCTION policy_chunks_search_vector_update() RETURNS trigger AS $$
    BEGIN
        -- Use only the chunk's content for its search vector
        NEW.search_vector = to_tsvector('english', COALESCE(NEW.content, ''));
        RETURN NEW;
    END
    $$ LANGUAGE plpgsql;

    -- Drop existing trigger before creating a new one to avoid errors
    DROP TRIGGER IF EXISTS policy_chunks_search_vector_trigger ON policy_chunks;

    -- Create the trigger for INSERT or UPDATE operations on 'policy_chunks'
    CREATE TRIGGER policy_chunks_search_vector_trigger
    BEFORE INSERT OR UPDATE ON policy_chunks
    FOR EACH ROW EXECUTE FUNCTION policy_chunks_search_vector_update();
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-04-09 18:35:20,768 - PytestDB - ERROR - CRITICAL: Unexpected error during database setup/teardown: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.PostgresSyntaxError'>: cannot insert multiple commands into a prepared statement
[SQL: 
    -- Trigger function for the 'policies' table
    CREATE OR REPLACE FUNCTION policies_search_vector_update() RETURNS trigger AS $$
    BEGIN
        -- Combine title (A), description (B), and text_content (C)
        -- Use coalesce to handle potential NULL values
        NEW.search_vector = setweight(to_tsvector('english', COALESCE(NEW.title, '')), 'A') ||
                            setweight(to_tsvector('english', COALESCE(NEW.description, '')), 'B') ||
                            setweight(to_tsvector('english', COALESCE(NEW.text_content, '')), 'C');
        RETURN NEW;
    END
    $$ LANGUAGE plpgsql;

    -- Drop existing trigger before creating a new one to avoid errors
    DROP TRIGGER IF EXISTS policies_search_vector_trigger ON policies;

    -- Create the trigger for INSERT or UPDATE operations on 'policies'
    CREATE TRIGGER policies_search_vector_trigger
    BEFORE INSERT OR UPDATE ON policies
    FOR EACH ROW EXECUTE FUNCTION policies_search_vector_update();

    -- Trigger function for the 'policy_chunks' table
    CREATE OR REPLACE FUNCTION policy_chunks_search_vector_update() RETURNS trigger AS $$
    BEGIN
        -- Use only the chunk's content for its search vector
        NEW.search_vector = to_tsvector('english', COALESCE(NEW.content, ''));
        RETURN NEW;
    END
    $$ LANGUAGE plpgsql;

    -- Drop existing trigger before creating a new one to avoid errors
    DROP TRIGGER IF EXISTS policy_chunks_search_vector_trigger ON policy_chunks;

    -- Create the trigger for INSERT or UPDATE operations on 'policy_chunks'
    CREATE TRIGGER policy_chunks_search_vector_trigger
    BEFORE INSERT OR UPDATE ON policy_chunks
    FOR EACH ROW EXECUTE FUNCTION policy_chunks_search_vector_update();
    ]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-04-09 18:35:20,770 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test'... THIS WILL DELETE ALL DATA!
2025-04-09 18:35:20,770 - BackendLogger - ERROR - Error parsing database URL 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test' for dropping: pytest: reading from stdin while output is captured!  Consider using `-s`.
2025-04-09 18:35:44,838 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 18:35:45,068 - PytestDB - INFO - Backend logging initialized. Log file: /Users/pouria/Documents/Coding/YDR Policy Scraping/data/logs/backend.log
2025-04-09 18:35:45,069 - PytestDB - INFO - Using Test Database URL: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test
2025-04-09 18:35:45,078 - PytestDB - INFO - Setting up test database (session scope)...
2025-04-09 18:35:45,078 - PytestDB - WARNING - Attempting to drop test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test' if it exists...
2025-04-09 18:35:45,079 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test'... THIS WILL DELETE ALL DATA!
2025-04-09 18:35:45,085 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy_test'...
2025-04-09 18:35:45,088 - BackendLogger - INFO - Connections terminated.
2025-04-09 18:35:45,088 - BackendLogger - INFO - Dropping database 'ydrpolicy_test'...
2025-04-09 18:35:45,117 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' dropped successfully.
2025-04-09 18:35:45,119 - PytestDB - INFO - Attempting to create test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test'...
2025-04-09 18:35:45,119 - BackendLogger - INFO - Checking if database 'ydrpolicy_test' exists...
2025-04-09 18:35:45,122 - BackendLogger - INFO - Creating database 'ydrpolicy_test'...
2025-04-09 18:35:45,165 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' created.
2025-04-09 18:35:45,166 - PytestDB - INFO - Test database created or already exists.
2025-04-09 18:35:45,167 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 18:35:45,182 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-09 18:35:45,183 - PytestDB - INFO - Creating tables in test database...
2025-04-09 18:35:45,211 - PytestDB - INFO - Tables created successfully.
2025-04-09 18:35:45,212 - PytestDB - INFO - Applying search vector triggers...
2025-04-09 18:35:45,213 - PytestDB - ERROR - Failed to apply triggers: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.PostgresSyntaxError'>: unterminated dollar-quoted string at or near "$$
    BEGIN
        -- Combine title (A), description (B), and text_content (C)
        -- Use coalesce to handle potential NULL values
        NEW.search_vector = setweight(to_tsvector('english', COALESCE(NEW.title, '')), 'A') ||
                            setweight(to_tsvector('english', COALESCE(NEW.description, '')), 'B') ||
                            setweight(to_tsvector('english', COALESCE(NEW.text_content, '')), 'C');"
[SQL: -- Trigger function for the 'policies' table
    CREATE OR REPLACE FUNCTION policies_search_vector_update() RETURNS trigger AS $$
    BEGIN
        -- Combine title (A), description (B), and text_content (C)
        -- Use coalesce to handle potential NULL values
        NEW.search_vector = setweight(to_tsvector('english', COALESCE(NEW.title, '')), 'A') ||
                            setweight(to_tsvector('english', COALESCE(NEW.description, '')), 'B') ||
                            setweight(to_tsvector('english', COALESCE(NEW.text_content, '')), 'C');]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 521, in _prepare_and_execute
    prepared_stmt, attributes = await adapt_connection._prepare(
                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 768, in _prepare
    prepared_stmt = await self._connection.prepare(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/asyncpg/connection.py", line 635, in prepare
    return await self._prepare(
           ^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/asyncpg/connection.py", line 653, in _prepare
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/asyncpg/connection.py", line 432, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 165, in prepare
asyncpg.exceptions.PostgresSyntaxError: unterminated dollar-quoted string at or near "$$
    BEGIN
        -- Combine title (A), description (B), and text_content (C)
        -- Use coalesce to handle potential NULL values
        NEW.search_vector = setweight(to_tsvector('english', COALESCE(NEW.title, '')), 'A') ||
                            setweight(to_tsvector('english', COALESCE(NEW.description, '')), 'B') ||
                            setweight(to_tsvector('english', COALESCE(NEW.text_content, '')), 'C');"

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.PostgresSyntaxError'>: unterminated dollar-quoted string at or near "$$
    BEGIN
        -- Combine title (A), description (B), and text_content (C)
        -- Use coalesce to handle potential NULL values
        NEW.search_vector = setweight(to_tsvector('english', COALESCE(NEW.title, '')), 'A') ||
                            setweight(to_tsvector('english', COALESCE(NEW.description, '')), 'B') ||
                            setweight(to_tsvector('english', COALESCE(NEW.text_content, '')), 'C');"

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/tests/backend/database/conftest.py", line 103, in initialize_test_db
    await conn.execute(text(statement + ";"))
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/engine.py", line 658, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.PostgresSyntaxError'>: unterminated dollar-quoted string at or near "$$
    BEGIN
        -- Combine title (A), description (B), and text_content (C)
        -- Use coalesce to handle potential NULL values
        NEW.search_vector = setweight(to_tsvector('english', COALESCE(NEW.title, '')), 'A') ||
                            setweight(to_tsvector('english', COALESCE(NEW.description, '')), 'B') ||
                            setweight(to_tsvector('english', COALESCE(NEW.text_content, '')), 'C');"
[SQL: -- Trigger function for the 'policies' table
    CREATE OR REPLACE FUNCTION policies_search_vector_update() RETURNS trigger AS $$
    BEGIN
        -- Combine title (A), description (B), and text_content (C)
        -- Use coalesce to handle potential NULL values
        NEW.search_vector = setweight(to_tsvector('english', COALESCE(NEW.title, '')), 'A') ||
                            setweight(to_tsvector('english', COALESCE(NEW.description, '')), 'B') ||
                            setweight(to_tsvector('english', COALESCE(NEW.text_content, '')), 'C');]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-04-09 18:35:45,720 - PytestDB - ERROR - CRITICAL: Unexpected error during database setup/teardown: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.PostgresSyntaxError'>: unterminated dollar-quoted string at or near "$$
    BEGIN
        -- Combine title (A), description (B), and text_content (C)
        -- Use coalesce to handle potential NULL values
        NEW.search_vector = setweight(to_tsvector('english', COALESCE(NEW.title, '')), 'A') ||
                            setweight(to_tsvector('english', COALESCE(NEW.description, '')), 'B') ||
                            setweight(to_tsvector('english', COALESCE(NEW.text_content, '')), 'C');"
[SQL: -- Trigger function for the 'policies' table
    CREATE OR REPLACE FUNCTION policies_search_vector_update() RETURNS trigger AS $$
    BEGIN
        -- Combine title (A), description (B), and text_content (C)
        -- Use coalesce to handle potential NULL values
        NEW.search_vector = setweight(to_tsvector('english', COALESCE(NEW.title, '')), 'A') ||
                            setweight(to_tsvector('english', COALESCE(NEW.description, '')), 'B') ||
                            setweight(to_tsvector('english', COALESCE(NEW.text_content, '')), 'C');]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-04-09 18:35:45,722 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test'... THIS WILL DELETE ALL DATA!
2025-04-09 18:35:45,722 - BackendLogger - ERROR - Error parsing database URL 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test' for dropping: pytest: reading from stdin while output is captured!  Consider using `-s`.
2025-04-09 18:36:27,448 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 18:36:27,683 - PytestDB - INFO - Backend logging initialized. Log file: /Users/pouria/Documents/Coding/YDR Policy Scraping/data/logs/backend.log
2025-04-09 18:36:27,684 - PytestDB - INFO - Using Test Database URL: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test
2025-04-09 18:36:27,693 - PytestDB - INFO - Setting up test database (session scope)...
2025-04-09 18:36:27,694 - PytestDB - WARNING - Attempting to drop test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test' if it exists...
2025-04-09 18:36:27,694 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test'... THIS WILL DELETE ALL DATA!
2025-04-09 18:36:27,700 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy_test'...
2025-04-09 18:36:27,703 - BackendLogger - INFO - Connections terminated.
2025-04-09 18:36:27,703 - BackendLogger - INFO - Dropping database 'ydrpolicy_test'...
2025-04-09 18:36:27,735 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' dropped successfully.
2025-04-09 18:36:27,737 - PytestDB - INFO - Attempting to create test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test'...
2025-04-09 18:36:27,737 - BackendLogger - INFO - Checking if database 'ydrpolicy_test' exists...
2025-04-09 18:36:27,740 - BackendLogger - INFO - Creating database 'ydrpolicy_test'...
2025-04-09 18:36:27,782 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' created.
2025-04-09 18:36:27,784 - PytestDB - INFO - Test database created or already exists.
2025-04-09 18:36:27,784 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 18:36:27,800 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-09 18:36:27,801 - PytestDB - INFO - Creating tables in test database...
2025-04-09 18:36:27,830 - PytestDB - INFO - Tables created successfully.
2025-04-09 18:36:27,830 - PytestDB - INFO - Applying search vector triggers...
2025-04-09 18:36:27,863 - PytestDB - INFO - Triggers applied.
2025-04-09 18:36:28,304 - PytestDB - INFO - Tearing down test database (session scope)...
2025-04-09 18:36:28,304 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test'... THIS WILL DELETE ALL DATA!
2025-04-09 18:36:28,310 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy_test'...
2025-04-09 18:36:28,313 - BackendLogger - INFO - Connections terminated.
2025-04-09 18:36:28,313 - BackendLogger - INFO - Dropping database 'ydrpolicy_test'...
2025-04-09 18:36:28,340 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' dropped successfully.
2025-04-09 18:36:45,913 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 18:36:46,145 - PytestDB - INFO - Backend logging initialized. Log file: /Users/pouria/Documents/Coding/YDR Policy Scraping/data/logs/backend.log
2025-04-09 18:36:46,145 - PytestDB - INFO - Using Test Database URL: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test
2025-04-09 18:36:46,155 - PytestDB - INFO - Setting up test database (session scope)...
2025-04-09 18:36:46,155 - PytestDB - WARNING - Attempting to drop test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test' if it exists...
2025-04-09 18:36:46,155 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test'... THIS WILL DELETE ALL DATA!
2025-04-09 18:36:46,161 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy_test'...
2025-04-09 18:36:46,165 - BackendLogger - INFO - Connections terminated.
2025-04-09 18:36:46,165 - BackendLogger - INFO - Dropping database 'ydrpolicy_test'...
2025-04-09 18:36:46,165 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' dropped successfully.
2025-04-09 18:36:46,168 - PytestDB - INFO - Attempting to create test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test'...
2025-04-09 18:36:46,169 - BackendLogger - INFO - Checking if database 'ydrpolicy_test' exists...
2025-04-09 18:36:46,175 - BackendLogger - INFO - Creating database 'ydrpolicy_test'...
2025-04-09 18:36:46,234 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' created.
2025-04-09 18:36:46,236 - PytestDB - INFO - Test database created or already exists.
2025-04-09 18:36:46,236 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 18:36:46,253 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-09 18:36:46,254 - PytestDB - INFO - Creating tables in test database...
2025-04-09 18:36:46,284 - PytestDB - INFO - Tables created successfully.
2025-04-09 18:36:46,284 - PytestDB - INFO - Applying search vector triggers...
2025-04-09 18:36:46,288 - PytestDB - INFO - Triggers applied.
2025-04-09 18:36:46,725 - PytestDB - INFO - Tearing down test database (session scope)...
2025-04-09 18:36:46,726 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test'... THIS WILL DELETE ALL DATA!
2025-04-09 18:36:46,730 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy_test'...
2025-04-09 18:36:46,734 - BackendLogger - INFO - Connections terminated.
2025-04-09 18:36:46,734 - BackendLogger - INFO - Dropping database 'ydrpolicy_test'...
2025-04-09 18:36:46,762 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' dropped successfully.
2025-04-09 18:37:33,658 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 18:38:03,806 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 18:38:24,864 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 18:38:32,144 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 18:38:32,380 - PytestDB - INFO - Backend logging initialized. Log file: /Users/pouria/Documents/Coding/YDR Policy Scraping/data/logs/backend.log
2025-04-09 18:38:32,381 - PytestDB - INFO - Using Test Database URL: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test
2025-04-09 18:38:32,390 - PytestDB - INFO - Setting up test database (session scope)...
2025-04-09 18:38:32,390 - PytestDB - WARNING - Attempting to drop test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test' if it exists...
2025-04-09 18:38:32,391 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test'... THIS WILL DELETE ALL DATA!
2025-04-09 18:38:32,396 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy_test'...
2025-04-09 18:38:32,399 - BackendLogger - INFO - Connections terminated.
2025-04-09 18:38:32,399 - BackendLogger - INFO - Dropping database 'ydrpolicy_test'...
2025-04-09 18:38:32,429 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' dropped successfully.
2025-04-09 18:38:32,430 - PytestDB - INFO - Attempting to create test database 'postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy_test'...
2025-04-09 18:38:32,431 - BackendLogger - INFO - Checking if database 'ydrpolicy_test' exists...
2025-04-09 18:38:32,434 - BackendLogger - INFO - Creating database 'ydrpolicy_test'...
2025-04-09 18:38:32,470 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' created.
2025-04-09 18:38:32,471 - PytestDB - INFO - Test database created or already exists.
2025-04-09 18:38:32,472 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 18:38:32,486 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-09 18:38:32,486 - PytestDB - INFO - Creating tables in test database...
2025-04-09 18:38:32,512 - PytestDB - INFO - Tables created successfully.
2025-04-09 18:38:32,513 - PytestDB - INFO - Applying search vector triggers...
2025-04-09 18:38:32,516 - PytestDB - INFO - Triggers applied.
2025-04-09 18:38:32,953 - PytestDB - INFO - Tearing down test database (session scope)...
2025-04-09 18:38:32,954 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test'... THIS WILL DELETE ALL DATA!
2025-04-09 18:38:32,958 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy_test'...
2025-04-09 18:38:32,961 - BackendLogger - INFO - Connections terminated.
2025-04-09 18:38:32,961 - BackendLogger - INFO - Dropping database 'ydrpolicy_test'...
2025-04-09 18:38:32,992 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test' dropped successfully.
2025-04-09 18:42:30,907 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 18:42:31,315 - BackendLogger - INFO - Logged policy update: policy_id=1, action=update, admin_id=2
2025-04-09 18:42:31,319 - BackendLogger - WARNING - Attempting to delete policy with ID: 1 and all associated data.
2025-04-09 18:42:31,332 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 1 and associated data.
2025-04-09 18:45:23,863 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 18:45:24,200 - BackendLogger - INFO - Logged policy update: policy_id=1, action=update, admin_id=2
2025-04-09 18:45:24,202 - BackendLogger - WARNING - Attempting to delete policy with ID: 1 and all associated data.
2025-04-09 18:45:24,206 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 1 and associated data.
2025-04-09 18:48:42,121 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 18:48:42,463 - BackendLogger - INFO - Logged policy update: policy_id=1, action=update, admin_id=2
2025-04-09 18:48:42,466 - BackendLogger - WARNING - Attempting to delete policy with ID: 1 and all associated data.
2025-04-09 18:48:42,470 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 1 and associated data.
2025-04-09 18:54:35,247 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 18:54:36,165 - BackendLogger - INFO - Logged policy update: policy_id=1, action=update, admin_id=2
2025-04-09 18:54:36,170 - BackendLogger - WARNING - Attempting to delete policy with ID: 1 and all associated data.
2025-04-09 18:54:36,177 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 1 and associated data.
2025-04-09 19:00:20,373 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 19:00:21,252 - BackendLogger - INFO - Logged policy update: policy_id=1, action=update, admin_id=2
2025-04-09 19:00:21,255 - BackendLogger - WARNING - Attempting to delete policy with ID: 1 and all associated data.
2025-04-09 19:00:21,261 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 1 and associated data.
2025-04-09 19:00:42,603 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 19:00:43,491 - BackendLogger - INFO - Logged policy update: policy_id=1, action=update, admin_id=2
2025-04-09 19:00:43,494 - BackendLogger - WARNING - Attempting to delete policy with ID: 1 and all associated data.
2025-04-09 19:00:43,500 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 1 and associated data.
2025-04-09 19:00:43,549 - BackendLogger - INFO - Performing vector-only search with limit=2, threshold=0.7
2025-04-09 19:03:51,460 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 19:03:52,362 - BackendLogger - INFO - Logged policy update: policy_id=1, action=update, admin_id=2
2025-04-09 19:03:52,365 - BackendLogger - WARNING - Attempting to delete policy with ID: 1 and all associated data.
2025-04-09 19:03:52,371 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 1 and associated data.
2025-04-09 19:03:52,415 - BackendLogger - INFO - Performing vector-only search with limit=2, threshold=0.7
2025-04-09 19:10:58,157 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 19:11:00,330 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 19:11:00,988 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 19:12:55,637 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 19:12:57,625 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 19:13:00,716 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 19:13:00,757 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 19:13:01,332 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 19:13:01,369 - BackendLogger - INFO - Performing text-only search for query: 'guideline' with limit=5
2025-04-09 19:13:01,373 - BackendLogger - INFO - Performing text-only search for query: 'compliance' with limit=5
2025-04-09 19:13:01,375 - BackendLogger - INFO - Performing text-only search for query: 'introduction' with limit=5
2025-04-09 19:13:01,377 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.7
2025-04-09 19:13:01,382 - BackendLogger - INFO - Performing hybrid search with query='guideline', weight=0.8, limit=5
2025-04-09 19:13:01,395 - BackendLogger - INFO - Retrieving 1 complete policies from chunk results...
2025-04-09 19:14:14,535 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 19:14:15,950 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 19:14:16,871 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 19:14:16,911 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 19:14:17,407 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 19:14:17,444 - BackendLogger - INFO - Performing text-only search for query: 'guideline' with limit=5
2025-04-09 19:14:17,447 - BackendLogger - INFO - Performing text-only search for query: 'compliance' with limit=5
2025-04-09 19:14:17,449 - BackendLogger - INFO - Performing text-only search for query: 'introduction' with limit=5
2025-04-09 19:14:17,450 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.7
2025-04-09 19:14:17,455 - BackendLogger - INFO - Performing hybrid search with query='guideline', weight=0.8, limit=5
2025-04-09 19:14:17,463 - BackendLogger - INFO - Retrieving 1 complete policies from chunk results...
2025-04-09 19:15:18,936 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 19:15:20,880 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 19:15:21,444 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 19:15:21,474 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 19:15:22,312 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 19:15:22,335 - BackendLogger - INFO - Performing text-only search for query: 'guideline' with limit=5
2025-04-09 19:15:22,337 - BackendLogger - INFO - Performing text-only search for query: 'compliance' with limit=5
2025-04-09 19:15:22,338 - BackendLogger - INFO - Performing text-only search for query: 'introduction' with limit=5
2025-04-09 19:15:22,339 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.7
2025-04-09 19:15:22,341 - BackendLogger - INFO - Performing hybrid search with query='guideline', weight=0.8, limit=5
2025-04-09 19:15:22,348 - BackendLogger - INFO - Retrieving 1 complete policies from chunk results...
2025-04-09 19:15:22,387 - BackendLogger - INFO - Logged policy update: policy_id=2, action=test_update, admin_id=1
2025-04-09 19:15:22,389 - BackendLogger - WARNING - Attempting to delete policy with ID: 4 and all associated data.
2025-04-09 19:15:22,404 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 4 and associated data.
2025-04-09 19:15:22,404 - BackendLogger - WARNING - Attempting to delete policy with ID: 2 and all associated data.
2025-04-09 19:15:22,407 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 2 and associated data.
2025-04-09 19:38:00,488 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 19:38:20,395 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 19:38:37,671 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 19:41:43,017 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 19:42:59,778 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 19:44:12,360 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 19:45:13,962 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 19:45:13,964 - DBInit - INFO - Backend logging initialized. Log file: /Users/pouria/Documents/Coding/YDR Policy Scraping/data/logs/backend.log
2025-04-09 19:45:13,964 - DBInit - INFO - Starting database initialization...
2025-04-09 19:45:13,965 - BackendLogger - INFO - Created directory: /Users/pouria/Documents/Coding/YDR Policy Scraping/data/uploads
2025-04-09 19:45:13,965 - BackendLogger - INFO - Created directory: /Users/pouria/Documents/Coding/YDR Policy Scraping/data/auth
2025-04-09 19:45:13,965 - DBInit - INFO - Initializing database structure and populating data...
2025-04-09 19:45:14,276 - BackendLogger - INFO - Starting database initialization for: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy
2025-04-09 19:45:14,277 - BackendLogger - INFO - Checking if database 'ydrpolicy' exists...
2025-04-09 19:45:14,286 - BackendLogger - INFO - Creating database 'ydrpolicy'...
2025-04-09 19:45:14,334 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy' created.
2025-04-09 19:45:14,336 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 19:45:14,355 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-09 19:45:14,355 - BackendLogger - INFO - Creating database tables if they don't exist...
2025-04-09 19:45:14,384 - BackendLogger - INFO - Tables checked/created.
2025-04-09 19:45:14,384 - BackendLogger - INFO - Applying search vector triggers...
2025-04-09 19:45:14,390 - BackendLogger - INFO - Search vector triggers applied.
2025-04-09 19:45:14,390 - BackendLogger - INFO - Starting data population from processed directory...
2025-04-09 19:45:14,390 - BackendLogger - INFO - Scanning processed data directory: /Users/pouria/Documents/Coding/YDR Policy Scraping/data/processed
2025-04-09 19:45:14,391 - BackendLogger - INFO - Creating new database engine
2025-04-09 19:45:14,391 - BackendLogger - INFO - Database engine created successfully
2025-04-09 19:45:14,391 - BackendLogger - INFO - Fetching existing policy titles from database...
2025-04-09 19:45:14,403 - BackendLogger - INFO - Found 0 existing policy titles.
2025-04-09 19:45:14,404 - BackendLogger - WARNING - Skipping folder with unexpected name format: scraped_policies
2025-04-09 19:45:14,404 - BackendLogger - INFO - Database population finished. Processed 0 new policies. Skipped 1 folders.
2025-04-09 19:45:14,404 - BackendLogger - INFO - [green]SUCCESS:[/green] Database initialization completed successfully.
2025-04-09 19:45:14,409 - BackendLogger - INFO - Database engine disposed.
2025-04-09 19:45:14,409 - DBInit - INFO - [green]SUCCESS:[/green] Database initialization process completed successfully.
2025-04-09 19:48:16,032 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 19:48:16,034 - BackendLogger - INFO - Created directory: /Users/pouria/Documents/Coding/YDR Policy Scraping/test_data/uploads
2025-04-09 19:48:16,035 - BackendLogger - INFO - Created directory: /Users/pouria/Documents/Coding/YDR Policy Scraping/test_data/auth
2025-04-09 19:48:16,317 - BackendLogger - INFO - Starting database initialization for: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy
2025-04-09 19:48:16,318 - BackendLogger - INFO - Checking if database 'ydrpolicy' exists...
2025-04-09 19:48:16,327 - BackendLogger - INFO - Database 'ydrpolicy' already exists.
2025-04-09 19:48:16,330 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 19:48:16,340 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-09 19:48:16,341 - BackendLogger - INFO - Creating database tables if they don't exist...
2025-04-09 19:48:16,347 - BackendLogger - INFO - Tables checked/created.
2025-04-09 19:48:16,347 - BackendLogger - INFO - Applying search vector triggers...
2025-04-09 19:48:16,354 - BackendLogger - INFO - Search vector triggers applied.
2025-04-09 19:48:16,354 - BackendLogger - INFO - Starting data population from processed directory...
2025-04-09 19:48:16,354 - BackendLogger - INFO - Scanning processed data directory: /Users/pouria/Documents/Coding/YDR Policy Scraping/test_data/processed
2025-04-09 19:48:16,355 - BackendLogger - INFO - Creating new database engine
2025-04-09 19:48:16,355 - BackendLogger - INFO - Database engine created successfully
2025-04-09 19:48:16,355 - BackendLogger - INFO - Fetching existing policy titles from database...
2025-04-09 19:48:16,371 - BackendLogger - INFO - Found 0 existing policy titles.
2025-04-09 19:48:16,371 - BackendLogger - WARNING - Skipping folder with unexpected name format: scraped_policies
2025-04-09 19:48:16,372 - BackendLogger - INFO - Database population finished. Processed 0 new policies. Skipped 1 folders.
2025-04-09 19:48:16,372 - BackendLogger - INFO - [green]SUCCESS:[/green] Database initialization completed successfully.
2025-04-09 19:48:16,377 - BackendLogger - INFO - Database engine disposed.
2025-04-09 19:54:01,105 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 19:54:01,394 - BackendLogger - INFO - Starting database initialization for: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy
2025-04-09 19:54:01,395 - BackendLogger - INFO - Checking if database 'ydrpolicy' exists...
2025-04-09 19:54:01,404 - BackendLogger - INFO - Creating database 'ydrpolicy'...
2025-04-09 19:54:01,463 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy' created.
2025-04-09 19:54:01,466 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 19:54:01,482 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-09 19:54:01,482 - BackendLogger - INFO - Creating database tables if they don't exist...
2025-04-09 19:54:01,511 - BackendLogger - INFO - Tables checked/created.
2025-04-09 19:54:01,512 - BackendLogger - INFO - Applying search vector triggers...
2025-04-09 19:54:01,515 - BackendLogger - INFO - Search vector triggers applied.
2025-04-09 19:54:01,516 - BackendLogger - INFO - Starting data population from processed directory...
2025-04-09 19:54:01,516 - BackendLogger - INFO - Scanning processed data directory: /Users/pouria/Documents/Coding/YDR Policy Scraping/test_data/processed
2025-04-09 19:54:01,516 - BackendLogger - INFO - Creating new database engine
2025-04-09 19:54:01,517 - BackendLogger - INFO - Database engine created successfully
2025-04-09 19:54:01,517 - BackendLogger - INFO - Fetching existing policy titles from database...
2025-04-09 19:54:01,530 - BackendLogger - INFO - Found 0 existing policy titles.
2025-04-09 19:54:01,530 - BackendLogger - WARNING - Skipping folder with unexpected name format: scraped_policies
2025-04-09 19:54:01,531 - BackendLogger - INFO - Database population finished. Processed 0 new policies. Skipped 1 folders.
2025-04-09 19:54:01,531 - BackendLogger - INFO - [green]SUCCESS:[/green] Database initialization completed successfully.
2025-04-09 19:54:01,537 - BackendLogger - INFO - Database engine disposed.
2025-04-09 20:02:03,507 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:02:03,798 - BackendLogger - INFO - Starting database initialization for: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy
2025-04-09 20:02:03,798 - BackendLogger - INFO - Checking if database 'ydrpolicy' exists...
2025-04-09 20:02:03,808 - BackendLogger - INFO - Database 'ydrpolicy' already exists.
2025-04-09 20:02:03,810 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 20:02:03,821 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-09 20:02:03,821 - BackendLogger - INFO - Creating database tables if they don't exist...
2025-04-09 20:02:03,828 - BackendLogger - INFO - Tables checked/created.
2025-04-09 20:02:03,828 - BackendLogger - INFO - Applying search vector triggers...
2025-04-09 20:02:03,836 - BackendLogger - INFO - Search vector triggers applied.
2025-04-09 20:02:03,836 - BackendLogger - INFO - Starting data population from processed directory...
2025-04-09 20:02:03,836 - BackendLogger - ERROR - Database initialization failed: 'types.SimpleNamespace' object has no attribute 'SCRAPED_POLICIES_DIR'
Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/ydrpolicy/backend/database/init_db.py", line 404, in init_db
    await populate_database_from_processed_data()
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/ydrpolicy/backend/database/init_db.py", line 305, in populate_database_from_processed_data
    processed_dir = config.PATHS.SCRAPED_POLICIES_DIR
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'types.SimpleNamespace' object has no attribute 'SCRAPED_POLICIES_DIR'
2025-04-09 20:02:03,870 - BackendLogger - INFO - Database engine disposed.
2025-04-09 20:05:16,282 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:05:16,572 - BackendLogger - INFO - Starting database initialization for: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy
2025-04-09 20:05:16,573 - BackendLogger - INFO - Checking if database 'ydrpolicy' exists...
2025-04-09 20:05:16,582 - BackendLogger - INFO - Database 'ydrpolicy' already exists.
2025-04-09 20:05:16,584 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 20:05:16,595 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-09 20:05:16,595 - BackendLogger - INFO - Creating database tables if they don't exist...
2025-04-09 20:05:16,602 - BackendLogger - INFO - Tables checked/created.
2025-04-09 20:05:16,602 - BackendLogger - INFO - Applying search vector triggers...
2025-04-09 20:05:16,610 - BackendLogger - INFO - Search vector triggers applied.
2025-04-09 20:05:16,610 - BackendLogger - INFO - Starting data population from scraped_policies directory...
2025-04-09 20:05:16,611 - BackendLogger - INFO - Scanning scraped policies directory: /Users/pouria/Documents/Coding/YDR Policy Scraping/test_data/processed/scraped_policies
2025-04-09 20:05:16,611 - BackendLogger - INFO - Creating new database engine
2025-04-09 20:05:16,611 - BackendLogger - INFO - Database engine created successfully
2025-04-09 20:05:16,612 - BackendLogger - INFO - Fetching existing policy titles from database...
2025-04-09 20:05:16,626 - BackendLogger - INFO - Found 0 existing policy titles.
2025-04-09 20:05:16,626 - BackendLogger - INFO - Processing new policy: 'Yale_University_Policy_on_Conflict_of_Interest' from folder: Yale_University_Policy_on_Conflict_of_Interest_20250409192912567168
2025-04-09 20:05:16,642 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 1
2025-04-09 20:05:16,643 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-09 20:05:16,692 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-09 20:05:17,501 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-09 20:05:17,502 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-09 20:05:17,502 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-09 20:05:17,503 - BackendLogger - INFO - Processing new policy: 'Residents_Wellbeing_Policy' from folder: Residents_Wellbeing_Policy_20250409193300717366
2025-04-09 20:05:17,536 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 2
2025-04-09 20:05:17,537 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-09 20:05:17,537 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-09 20:05:18,446 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-09 20:05:18,447 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-09 20:05:18,448 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-09 20:05:18,449 - BackendLogger - INFO - Processing new policy: 'School_of_Medicine_Sabbatical_and_Triennial_Leave_Policy' from folder: School_of_Medicine_Sabbatical_and_Triennial_Leave_Policy_20250409193128387433
2025-04-09 20:05:18,471 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 3
2025-04-09 20:05:18,471 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-09 20:05:18,472 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-09 20:05:19,377 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-09 20:05:19,379 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-09 20:05:19,380 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-09 20:05:19,380 - BackendLogger - INFO - Processing new policy: 'Controller_s_Office_Factsheet' from folder: Controller_s_Office_Factsheet_20250409194424987413
2025-04-09 20:05:19,400 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 4
2025-04-09 20:05:19,401 - BackendLogger - INFO -   Split text content into 21 chunks.
2025-04-09 20:05:19,401 - BackendLogger - INFO - Generating embeddings for 21 texts
2025-04-09 20:05:20,165 - BackendLogger - INFO - Successfully generated 21 embeddings
2025-04-09 20:05:20,167 - BackendLogger - INFO -   Generated 21 embeddings.
2025-04-09 20:05:20,168 - BackendLogger - INFO -   Added 21 PolicyChunk records to session.
2025-04-09 20:05:20,169 - BackendLogger - INFO - Processing new policy: 'Voluntary_Faculty_Appointment_Application_Requirements_Process' from folder: Voluntary_Faculty_Appointment_Application_Requirements_Process_20250409193339788344
2025-04-09 20:05:20,214 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 5
2025-04-09 20:05:20,215 - BackendLogger - INFO -   Split text content into 3 chunks.
2025-04-09 20:05:20,215 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 20:05:20,778 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 20:05:20,780 - BackendLogger - INFO -   Generated 3 embeddings.
2025-04-09 20:05:20,781 - BackendLogger - INFO -   Added 3 PolicyChunk records to session.
2025-04-09 20:05:20,782 - BackendLogger - INFO - Processing new policy: 'Workday_Finance_User-Based_Security_Groups_Request_Process' from folder: Workday_Finance_User-Based_Security_Groups_Request_Process_20250409194153006635
2025-04-09 20:05:20,795 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 6
2025-04-09 20:05:20,797 - BackendLogger - INFO -   Split text content into 3 chunks.
2025-04-09 20:05:20,797 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 20:05:21,801 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 20:05:21,802 - BackendLogger - INFO -   Generated 3 embeddings.
2025-04-09 20:05:21,803 - BackendLogger - INFO -   Added 3 PolicyChunk records to session.
2025-04-09 20:05:21,806 - BackendLogger - INFO - Processing new policy: 'Grand_Rounds_Allowable_Expenses' from folder: Grand_Rounds_Allowable_Expenses_20250409192920823251
2025-04-09 20:05:21,822 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 7
2025-04-09 20:05:21,823 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-09 20:05:21,825 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-09 20:05:22,179 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-09 20:05:22,180 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-09 20:05:22,181 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-09 20:05:22,182 - BackendLogger - INFO - Processing new policy: 'Voluntary_Faculty_Guidelines_Clarification' from folder: Voluntary_Faculty_Guidelines_Clarification_20250409193316792165
2025-04-09 20:05:22,200 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 8
2025-04-09 20:05:22,203 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-09 20:05:22,203 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-09 20:05:22,671 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-09 20:05:22,672 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-09 20:05:22,674 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-09 20:05:22,674 - BackendLogger - INFO - Processing new policy: 'Guidelines_for_Appointment' from folder: Guidelines_for_Appointment_20250409193232742762
2025-04-09 20:05:22,699 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 9
2025-04-09 20:05:22,701 - BackendLogger - INFO -   Split text content into 6 chunks.
2025-04-09 20:05:22,702 - BackendLogger - INFO - Generating embeddings for 6 texts
2025-04-09 20:05:23,211 - BackendLogger - INFO - Successfully generated 6 embeddings
2025-04-09 20:05:23,212 - BackendLogger - INFO -   Generated 6 embeddings.
2025-04-09 20:05:23,213 - BackendLogger - INFO -   Added 6 PolicyChunk records to session.
2025-04-09 20:05:23,214 - BackendLogger - INFO - Processing new policy: 'Critical_Out-Patient_Imaging_Findings_-_Immediate_Medical_Care_SOP' from folder: Critical_Out-Patient_Imaging_Findings_-_Immediate_Medical_Care_SOP_20250409193528279122
2025-04-09 20:05:23,230 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 10
2025-04-09 20:05:23,231 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-09 20:05:23,231 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-09 20:05:24,154 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-09 20:05:24,155 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-09 20:05:24,156 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-09 20:05:24,157 - BackendLogger - INFO - Processing new policy: 'YDR_Conflict_of_Interest_Policy' from folder: YDR_Conflict_of_Interest_Policy_20250409192856529512
2025-04-09 20:05:24,172 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 11
2025-04-09 20:05:24,173 - BackendLogger - INFO -   Split text content into 7 chunks.
2025-04-09 20:05:24,174 - BackendLogger - INFO - Generating embeddings for 7 texts
2025-04-09 20:05:24,870 - BackendLogger - INFO - Successfully generated 7 embeddings
2025-04-09 20:05:24,871 - BackendLogger - INFO -   Generated 7 embeddings.
2025-04-09 20:05:24,871 - BackendLogger - INFO -   Added 7 PolicyChunk records to session.
2025-04-09 20:05:24,885 - BackendLogger - INFO - Database population finished. Processed 11 new policies. Skipped 0 folders.
2025-04-09 20:05:24,886 - BackendLogger - INFO - [green]SUCCESS:[/green] Database initialization completed successfully.
2025-04-09 20:05:24,891 - BackendLogger - INFO - Database engine disposed.
2025-04-09 20:10:15,745 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:10:19,856 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy'... THIS WILL DELETE ALL DATA!
2025-04-09 20:10:23,482 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy'...
2025-04-09 20:10:23,487 - BackendLogger - INFO - Connections terminated.
2025-04-09 20:10:23,488 - BackendLogger - INFO - Dropping database 'ydrpolicy'...
2025-04-09 20:10:23,521 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy' dropped successfully.
2025-04-09 20:11:53,105 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:12:11,467 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:13:13,597 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:13:13,930 - BackendLogger - INFO - Logged policy update: policy_id=1, action=update, admin_id=2
2025-04-09 20:13:13,932 - BackendLogger - WARNING - Attempting to delete policy with ID: 1 and all associated data.
2025-04-09 20:13:13,937 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 1 and associated data.
2025-04-09 20:13:13,980 - BackendLogger - INFO - Performing vector-only search with limit=2, threshold=0.7
2025-04-09 20:13:39,244 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:13:40,353 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 20:13:40,862 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 20:13:40,916 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 20:13:42,000 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 20:13:42,037 - BackendLogger - INFO - Performing text-only search for query: 'guideline' with limit=5
2025-04-09 20:13:42,040 - BackendLogger - INFO - Performing text-only search for query: 'compliance' with limit=5
2025-04-09 20:13:42,042 - BackendLogger - INFO - Performing text-only search for query: 'introduction' with limit=5
2025-04-09 20:13:42,044 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.7
2025-04-09 20:13:42,047 - BackendLogger - INFO - Performing hybrid search with query='guideline', weight=0.8, limit=5
2025-04-09 20:13:42,056 - BackendLogger - INFO - Retrieving 1 complete policies from chunk results...
2025-04-09 20:13:42,106 - BackendLogger - INFO - Logged policy update: policy_id=2, action=test_update, admin_id=1
2025-04-09 20:13:42,110 - BackendLogger - WARNING - Attempting to delete policy with ID: 4 and all associated data.
2025-04-09 20:13:42,128 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 4 and associated data.
2025-04-09 20:13:42,129 - BackendLogger - WARNING - Attempting to delete policy with ID: 2 and all associated data.
2025-04-09 20:13:42,133 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 2 and associated data.
2025-04-09 20:15:00,962 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:15:01,864 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 20:15:02,575 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 20:15:02,606 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 20:15:03,088 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 20:15:03,125 - BackendLogger - INFO - Performing text-only search for query: 'guideline' with limit=5
2025-04-09 20:15:03,128 - BackendLogger - INFO - Performing text-only search for query: 'compliance' with limit=5
2025-04-09 20:15:03,130 - BackendLogger - INFO - Performing text-only search for query: 'introduction' with limit=5
2025-04-09 20:15:03,132 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.7
2025-04-09 20:15:03,135 - BackendLogger - INFO - Performing hybrid search with query='guideline', weight=0.8, limit=5
2025-04-09 20:15:03,144 - BackendLogger - INFO - Retrieving 1 complete policies from chunk results...
2025-04-09 20:15:03,197 - BackendLogger - INFO - Logged policy update: policy_id=2, action=test_update, admin_id=1
2025-04-09 20:15:03,200 - BackendLogger - WARNING - Attempting to delete policy with ID: 4 and all associated data.
2025-04-09 20:15:03,219 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 4 and associated data.
2025-04-09 20:15:03,220 - BackendLogger - WARNING - Attempting to delete policy with ID: 2 and all associated data.
2025-04-09 20:15:03,223 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 2 and associated data.
2025-04-09 20:25:10,936 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:25:11,469 - BackendLogger - INFO - Starting database initialization for: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy
2025-04-09 20:25:11,469 - BackendLogger - INFO - Checking if database 'ydrpolicy' exists...
2025-04-09 20:25:11,479 - BackendLogger - INFO - Creating database 'ydrpolicy'...
2025-04-09 20:25:11,525 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy' created.
2025-04-09 20:25:11,527 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 20:25:11,543 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-09 20:25:11,543 - BackendLogger - INFO - Creating database tables if they don't exist...
2025-04-09 20:25:11,568 - BackendLogger - INFO - Tables checked/created.
2025-04-09 20:25:11,569 - BackendLogger - INFO - Applying search vector triggers...
2025-04-09 20:25:11,574 - BackendLogger - INFO - Search vector triggers applied.
2025-04-09 20:25:11,574 - BackendLogger - INFO - Starting data population from scraped_policies directory...
2025-04-09 20:25:11,574 - BackendLogger - INFO - Scanning scraped policies directory: /Users/pouria/Documents/Coding/YDR Policy Scraping/test_data/processed/scraped_policies
2025-04-09 20:25:11,575 - BackendLogger - INFO - Reading policy descriptions from CSV: /Users/pouria/Documents/Coding/YDR Policy Scraping/test_data/processed/processed_policies_log.csv
2025-04-09 20:25:11,579 - BackendLogger - INFO - Loaded 17 timestamp mappings and 17 URL mappings for policy descriptions
2025-04-09 20:25:11,579 - BackendLogger - INFO - Creating new database engine
2025-04-09 20:25:11,580 - BackendLogger - INFO - Database engine created successfully
2025-04-09 20:25:11,580 - BackendLogger - INFO - Fetching existing policy titles from database...
2025-04-09 20:25:11,592 - BackendLogger - INFO - Found 0 existing policy titles.
2025-04-09 20:25:11,593 - BackendLogger - INFO - Processing new policy: 'Yale_University_Policy_on_Conflict_of_Interest' from folder: Yale_University_Policy_on_Conflict_of_Interest_20250409192912567168
2025-04-09 20:25:11,600 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 1
2025-04-09 20:25:11,601 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-09 20:25:11,651 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-09 20:25:13,249 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-09 20:25:13,250 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-09 20:25:13,250 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-09 20:25:13,251 - BackendLogger - INFO - Processing new policy: 'Residents_Wellbeing_Policy' from folder: Residents_Wellbeing_Policy_20250409193300717366
2025-04-09 20:25:13,280 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 2
2025-04-09 20:25:13,280 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-09 20:25:13,281 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-09 20:25:13,982 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-09 20:25:13,984 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-09 20:25:13,985 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-09 20:25:13,986 - BackendLogger - INFO - Processing new policy: 'School_of_Medicine_Sabbatical_and_Triennial_Leave_Policy' from folder: School_of_Medicine_Sabbatical_and_Triennial_Leave_Policy_20250409193128387433
2025-04-09 20:25:14,010 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 3
2025-04-09 20:25:14,011 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-09 20:25:14,012 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-09 20:25:14,989 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-09 20:25:14,991 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-09 20:25:14,992 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-09 20:25:14,994 - BackendLogger - INFO - Processing new policy: 'Controller_s_Office_Factsheet' from folder: Controller_s_Office_Factsheet_20250409194424987413
2025-04-09 20:25:15,014 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 4
2025-04-09 20:25:15,015 - BackendLogger - INFO -   Split text content into 21 chunks.
2025-04-09 20:25:15,015 - BackendLogger - INFO - Generating embeddings for 21 texts
2025-04-09 20:25:15,792 - BackendLogger - INFO - Successfully generated 21 embeddings
2025-04-09 20:25:15,794 - BackendLogger - INFO -   Generated 21 embeddings.
2025-04-09 20:25:15,795 - BackendLogger - INFO -   Added 21 PolicyChunk records to session.
2025-04-09 20:25:15,795 - BackendLogger - INFO - Processing new policy: 'Voluntary_Faculty_Appointment_Application_Requirements_Process' from folder: Voluntary_Faculty_Appointment_Application_Requirements_Process_20250409193339788344
2025-04-09 20:25:15,837 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 5
2025-04-09 20:25:15,838 - BackendLogger - INFO -   Split text content into 3 chunks.
2025-04-09 20:25:15,838 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 20:25:16,809 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 20:25:16,811 - BackendLogger - INFO -   Generated 3 embeddings.
2025-04-09 20:25:16,812 - BackendLogger - INFO -   Added 3 PolicyChunk records to session.
2025-04-09 20:25:16,814 - BackendLogger - INFO - Processing new policy: 'Workday_Finance_User-Based_Security_Groups_Request_Process' from folder: Workday_Finance_User-Based_Security_Groups_Request_Process_20250409194153006635
2025-04-09 20:25:16,827 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 6
2025-04-09 20:25:16,828 - BackendLogger - INFO -   Split text content into 3 chunks.
2025-04-09 20:25:16,830 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 20:25:17,220 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 20:25:17,221 - BackendLogger - INFO -   Generated 3 embeddings.
2025-04-09 20:25:17,222 - BackendLogger - INFO -   Added 3 PolicyChunk records to session.
2025-04-09 20:25:17,223 - BackendLogger - INFO - Processing new policy: 'Grand_Rounds_Allowable_Expenses' from folder: Grand_Rounds_Allowable_Expenses_20250409192920823251
2025-04-09 20:25:17,237 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 7
2025-04-09 20:25:17,238 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-09 20:25:17,239 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-09 20:25:17,611 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-09 20:25:17,612 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-09 20:25:17,613 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-09 20:25:17,614 - BackendLogger - INFO - Processing new policy: 'Voluntary_Faculty_Guidelines_Clarification' from folder: Voluntary_Faculty_Guidelines_Clarification_20250409193316792165
2025-04-09 20:25:17,632 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 8
2025-04-09 20:25:17,633 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-09 20:25:17,634 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-09 20:25:18,067 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-09 20:25:18,069 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-09 20:25:18,070 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-09 20:25:18,071 - BackendLogger - INFO - Processing new policy: 'Guidelines_for_Appointment' from folder: Guidelines_for_Appointment_20250409193232742762
2025-04-09 20:25:18,096 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 9
2025-04-09 20:25:18,097 - BackendLogger - INFO -   Split text content into 6 chunks.
2025-04-09 20:25:18,098 - BackendLogger - INFO - Generating embeddings for 6 texts
2025-04-09 20:25:18,982 - BackendLogger - INFO - Successfully generated 6 embeddings
2025-04-09 20:25:18,983 - BackendLogger - INFO -   Generated 6 embeddings.
2025-04-09 20:25:18,983 - BackendLogger - INFO -   Added 6 PolicyChunk records to session.
2025-04-09 20:25:18,984 - BackendLogger - INFO - Processing new policy: 'Critical_Out-Patient_Imaging_Findings_-_Immediate_Medical_Care_SOP' from folder: Critical_Out-Patient_Imaging_Findings_-_Immediate_Medical_Care_SOP_20250409193528279122
2025-04-09 20:25:18,998 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 10
2025-04-09 20:25:18,999 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-09 20:25:18,999 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-09 20:25:19,325 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-09 20:25:19,326 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-09 20:25:19,327 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-09 20:25:19,328 - BackendLogger - INFO - Processing new policy: 'YDR_Conflict_of_Interest_Policy' from folder: YDR_Conflict_of_Interest_Policy_20250409192856529512
2025-04-09 20:25:19,344 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 11
2025-04-09 20:25:19,346 - BackendLogger - INFO -   Split text content into 7 chunks.
2025-04-09 20:25:19,346 - BackendLogger - INFO - Generating embeddings for 7 texts
2025-04-09 20:25:20,127 - BackendLogger - INFO - Successfully generated 7 embeddings
2025-04-09 20:25:20,129 - BackendLogger - INFO -   Generated 7 embeddings.
2025-04-09 20:25:20,130 - BackendLogger - INFO -   Added 7 PolicyChunk records to session.
2025-04-09 20:25:20,147 - BackendLogger - INFO - Database population finished. Processed 11 new policies. Skipped 0 folders.
2025-04-09 20:25:20,148 - BackendLogger - INFO - [green]SUCCESS:[/green] Database initialization completed successfully.
2025-04-09 20:25:20,161 - BackendLogger - INFO - Database engine disposed.
2025-04-09 20:28:39,034 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:29:06,367 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:29:06,796 - BackendLogger - INFO - Starting database initialization for: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy
2025-04-09 20:29:06,796 - BackendLogger - INFO - Checking if database 'ydrpolicy' exists...
2025-04-09 20:29:06,806 - BackendLogger - INFO - Database 'ydrpolicy' already exists.
2025-04-09 20:29:06,810 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 20:29:06,821 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-09 20:29:06,822 - BackendLogger - INFO - Creating database tables if they don't exist...
2025-04-09 20:29:06,829 - BackendLogger - INFO - Tables checked/created.
2025-04-09 20:29:06,829 - BackendLogger - INFO - Applying search vector triggers...
2025-04-09 20:29:06,837 - BackendLogger - INFO - Search vector triggers applied.
2025-04-09 20:29:06,838 - BackendLogger - INFO - Starting data population from scraped_policies directory...
2025-04-09 20:29:06,838 - BackendLogger - INFO - Scanning scraped policies directory: /Users/pouria/Documents/Coding/YDR Policy Scraping/test_data/processed/scraped_policies
2025-04-09 20:29:06,838 - BackendLogger - INFO - Reading policy descriptions from CSV: /Users/pouria/Documents/Coding/YDR Policy Scraping/test_data/processed/processed_policies_log.csv
2025-04-09 20:29:06,843 - BackendLogger - INFO - Loaded 17 timestamp mappings and 17 URL mappings for policy descriptions
2025-04-09 20:29:06,843 - BackendLogger - INFO - Creating new database engine
2025-04-09 20:29:06,844 - BackendLogger - INFO - Database engine created successfully
2025-04-09 20:29:06,844 - BackendLogger - INFO - Fetching existing policy titles from database...
2025-04-09 20:29:06,859 - BackendLogger - INFO - Found 11 existing policy titles.
2025-04-09 20:29:06,860 - BackendLogger - INFO - Database population finished. Processed 0 new policies. Skipped 12 folders.
2025-04-09 20:29:06,860 - BackendLogger - INFO - [green]SUCCESS:[/green] Database initialization completed successfully.
2025-04-09 20:29:06,864 - BackendLogger - INFO - Database engine disposed.
2025-04-09 20:36:25,956 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:36:26,375 - BackendLogger - INFO - Starting database initialization for: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy
2025-04-09 20:36:26,375 - BackendLogger - INFO - Checking if database 'ydrpolicy' exists...
2025-04-09 20:36:26,384 - BackendLogger - INFO - Database 'ydrpolicy' already exists.
2025-04-09 20:36:26,387 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 20:36:26,396 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-09 20:36:26,397 - BackendLogger - INFO - Creating database tables if they don't exist...
2025-04-09 20:36:26,403 - BackendLogger - INFO - Tables checked/created.
2025-04-09 20:36:26,403 - BackendLogger - INFO - Applying search vector triggers...
2025-04-09 20:36:26,411 - BackendLogger - INFO - Search vector triggers applied.
2025-04-09 20:36:26,412 - BackendLogger - INFO - Starting data population from scraped_policies directory...
2025-04-09 20:36:26,412 - BackendLogger - INFO - Scanning scraped policies directory: /Users/pouria/Documents/Coding/YDR Policy Scraping/test_data/processed/scraped_policies
2025-04-09 20:36:26,412 - BackendLogger - INFO - Reading policy descriptions from CSV: /Users/pouria/Documents/Coding/YDR Policy Scraping/test_data/processed/processed_policies_log.csv
2025-04-09 20:36:26,414 - BackendLogger - INFO - Loaded 17 timestamp mappings and 17 URL mappings for policy descriptions
2025-04-09 20:36:26,414 - BackendLogger - INFO - Creating new database engine
2025-04-09 20:36:26,415 - BackendLogger - INFO - Database engine created successfully
2025-04-09 20:36:26,415 - BackendLogger - INFO - Fetching existing policy information from database...
2025-04-09 20:36:26,415 - BackendLogger - ERROR - Error during database population: Column expression, FROM clause, or other columns clause element expected, got MetaData().
Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/ydrpolicy/backend/database/init_db.py", line 372, in populate_database_from_scraped_policies
    existing_policies = await get_existing_policies_info(session)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/ydrpolicy/backend/database/init_db.py", line 164, in get_existing_policies_info
    stmt = select(Policy.id, Policy.title, Policy.metadata)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/sql/_selectable_constructors.py", line 537, in select
    return Select(*entities)
           ^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py", line 5341, in __init__
    coercions.expect(
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/sql/coercions.py", line 424, in expect
    return impl._implicit_coercions(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/sql/coercions.py", line 488, in _implicit_coercions
    self._raise_for_expected(element, argname, resolved)
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/sql/coercions.py", line 1132, in _raise_for_expected
    return super()._raise_for_expected(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/sql/coercions.py", line 695, in _raise_for_expected
    super()._raise_for_expected(
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/sql/coercions.py", line 518, in _raise_for_expected
    raise exc.ArgumentError(msg, code=code) from err
sqlalchemy.exc.ArgumentError: Column expression, FROM clause, or other columns clause element expected, got MetaData().
2025-04-09 20:36:26,615 - BackendLogger - ERROR - Session rolled back due to error: Column expression, FROM clause, or other columns clause element expected, got MetaData().
2025-04-09 20:36:26,616 - BackendLogger - ERROR - Database initialization failed: Column expression, FROM clause, or other columns clause element expected, got MetaData().
Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/ydrpolicy/backend/database/init_db.py", line 497, in init_db
    await populate_database_from_scraped_policies()
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/ydrpolicy/backend/database/init_db.py", line 372, in populate_database_from_scraped_policies
    existing_policies = await get_existing_policies_info(session)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/ydrpolicy/backend/database/init_db.py", line 164, in get_existing_policies_info
    stmt = select(Policy.id, Policy.title, Policy.metadata)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/sql/_selectable_constructors.py", line 537, in select
    return Select(*entities)
           ^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/sql/selectable.py", line 5341, in __init__
    coercions.expect(
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/sql/coercions.py", line 424, in expect
    return impl._implicit_coercions(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/sql/coercions.py", line 488, in _implicit_coercions
    self._raise_for_expected(element, argname, resolved)
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/sql/coercions.py", line 1132, in _raise_for_expected
    return super()._raise_for_expected(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/sql/coercions.py", line 695, in _raise_for_expected
    super()._raise_for_expected(
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/sql/coercions.py", line 518, in _raise_for_expected
    raise exc.ArgumentError(msg, code=code) from err
sqlalchemy.exc.ArgumentError: Column expression, FROM clause, or other columns clause element expected, got MetaData().
2025-04-09 20:36:26,821 - BackendLogger - INFO - Database engine disposed.
2025-04-09 20:37:46,301 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:37:48,407 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:37:51,173 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy'... THIS WILL DELETE ALL DATA!
2025-04-09 20:37:52,873 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy'...
2025-04-09 20:37:52,879 - BackendLogger - INFO - Connections terminated.
2025-04-09 20:37:52,881 - BackendLogger - INFO - Dropping database 'ydrpolicy'...
2025-04-09 20:37:52,914 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy' dropped successfully.
2025-04-09 20:37:56,676 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:37:57,057 - BackendLogger - INFO - Starting database initialization for: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy
2025-04-09 20:37:57,057 - BackendLogger - INFO - Checking if database 'ydrpolicy' exists...
2025-04-09 20:37:57,066 - BackendLogger - INFO - Creating database 'ydrpolicy'...
2025-04-09 20:37:57,122 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy' created.
2025-04-09 20:37:57,124 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 20:37:57,141 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-09 20:37:57,142 - BackendLogger - INFO - Creating database tables if they don't exist...
2025-04-09 20:37:57,171 - BackendLogger - INFO - Tables checked/created.
2025-04-09 20:37:57,171 - BackendLogger - INFO - Applying search vector triggers...
2025-04-09 20:37:57,175 - BackendLogger - INFO - Search vector triggers applied.
2025-04-09 20:37:57,175 - BackendLogger - INFO - Starting data population from scraped_policies directory...
2025-04-09 20:37:57,175 - BackendLogger - INFO - Scanning scraped policies directory: /Users/pouria/Documents/Coding/YDR Policy Scraping/test_data/processed/scraped_policies
2025-04-09 20:37:57,176 - BackendLogger - INFO - Reading policy descriptions from CSV: /Users/pouria/Documents/Coding/YDR Policy Scraping/test_data/processed/processed_policies_log.csv
2025-04-09 20:37:57,178 - BackendLogger - INFO - Loaded 17 timestamp mappings and 17 URL mappings for policy descriptions
2025-04-09 20:37:57,178 - BackendLogger - INFO - Creating new database engine
2025-04-09 20:37:57,179 - BackendLogger - INFO - Database engine created successfully
2025-04-09 20:37:57,179 - BackendLogger - INFO - Fetching existing policy information from database...
2025-04-09 20:37:57,179 - BackendLogger - ERROR - Error during database population: metadata
Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py", line 1617, in __getattr__
    return self._index[key][1]
           ~~~~~~~~~~~^^^^^
KeyError: 'metadata'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/ydrpolicy/backend/database/init_db.py", line 373, in populate_database_from_scraped_policies
    existing_policies = await get_existing_policies_info(session)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/ydrpolicy/backend/database/init_db.py", line 165, in get_existing_policies_info
    stmt = select(Policy.id, Policy.title, Policy.__table__.c.metadata)
                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py", line 1619, in __getattr__
    raise AttributeError(key) from err
AttributeError: metadata
2025-04-09 20:37:57,283 - BackendLogger - ERROR - Session rolled back due to error: metadata
2025-04-09 20:37:57,283 - BackendLogger - ERROR - Database initialization failed: metadata
Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py", line 1617, in __getattr__
    return self._index[key][1]
           ~~~~~~~~~~~^^^^^
KeyError: 'metadata'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/ydrpolicy/backend/database/init_db.py", line 498, in init_db
    await populate_database_from_scraped_policies()
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/ydrpolicy/backend/database/init_db.py", line 373, in populate_database_from_scraped_policies
    existing_policies = await get_existing_policies_info(session)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/ydrpolicy/backend/database/init_db.py", line 165, in get_existing_policies_info
    stmt = select(Policy.id, Policy.title, Policy.__table__.c.metadata)
                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/sql/base.py", line 1619, in __getattr__
    raise AttributeError(key) from err
AttributeError: metadata
2025-04-09 20:37:57,380 - BackendLogger - INFO - Database engine disposed.
2025-04-09 20:39:00,984 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:39:01,377 - BackendLogger - INFO - Starting database initialization for: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy
2025-04-09 20:39:01,377 - BackendLogger - INFO - Checking if database 'ydrpolicy' exists...
2025-04-09 20:39:01,388 - BackendLogger - INFO - Database 'ydrpolicy' already exists.
2025-04-09 20:39:01,391 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 20:39:01,403 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-09 20:39:01,403 - BackendLogger - INFO - Creating database tables if they don't exist...
2025-04-09 20:39:01,409 - BackendLogger - INFO - Tables checked/created.
2025-04-09 20:39:01,410 - BackendLogger - INFO - Applying search vector triggers...
2025-04-09 20:39:01,416 - BackendLogger - INFO - Search vector triggers applied.
2025-04-09 20:39:01,417 - BackendLogger - INFO - Starting data population from scraped_policies directory...
2025-04-09 20:39:01,417 - BackendLogger - INFO - Scanning scraped policies directory: /Users/pouria/Documents/Coding/YDR Policy Scraping/test_data/processed/scraped_policies
2025-04-09 20:39:01,418 - BackendLogger - INFO - Reading policy descriptions from CSV: /Users/pouria/Documents/Coding/YDR Policy Scraping/test_data/processed/processed_policies_log.csv
2025-04-09 20:39:01,419 - BackendLogger - INFO - Loaded 17 timestamp mappings and 17 URL mappings for policy descriptions
2025-04-09 20:39:01,420 - BackendLogger - INFO - Creating new database engine
2025-04-09 20:39:01,420 - BackendLogger - INFO - Database engine created successfully
2025-04-09 20:39:01,420 - BackendLogger - INFO - Fetching existing policy information from database...
2025-04-09 20:39:01,436 - BackendLogger - INFO - Found 0 existing policies in database.
2025-04-09 20:39:01,436 - BackendLogger - INFO - Processing new policy: 'Yale_University_Policy_on_Conflict_of_Interest' from folder: Yale_University_Policy_on_Conflict_of_Interest_20250409192912567168
2025-04-09 20:39:01,450 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 1
2025-04-09 20:39:01,451 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-09 20:39:01,501 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-09 20:39:02,789 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-09 20:39:02,791 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-09 20:39:02,793 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-09 20:39:02,794 - BackendLogger - INFO - Processing new policy: 'Residents_Wellbeing_Policy' from folder: Residents_Wellbeing_Policy_20250409193300717366
2025-04-09 20:39:02,861 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 2
2025-04-09 20:39:02,862 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-09 20:39:02,862 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-09 20:39:03,399 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-09 20:39:03,401 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-09 20:39:03,402 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-09 20:39:03,403 - BackendLogger - INFO - Processing new policy: 'School_of_Medicine_Sabbatical_and_Triennial_Leave_Policy' from folder: School_of_Medicine_Sabbatical_and_Triennial_Leave_Policy_20250409193128387433
2025-04-09 20:39:03,429 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 3
2025-04-09 20:39:03,430 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-09 20:39:03,431 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-09 20:39:04,051 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-09 20:39:04,053 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-09 20:39:04,054 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-09 20:39:04,056 - BackendLogger - INFO - Processing new policy: 'Controller_s_Office_Factsheet' from folder: Controller_s_Office_Factsheet_20250409194424987413
2025-04-09 20:39:04,079 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 4
2025-04-09 20:39:04,082 - BackendLogger - INFO -   Split text content into 21 chunks.
2025-04-09 20:39:04,083 - BackendLogger - INFO - Generating embeddings for 21 texts
2025-04-09 20:39:04,842 - BackendLogger - INFO - Successfully generated 21 embeddings
2025-04-09 20:39:04,844 - BackendLogger - INFO -   Generated 21 embeddings.
2025-04-09 20:39:04,846 - BackendLogger - INFO -   Added 21 PolicyChunk records to session.
2025-04-09 20:39:04,847 - BackendLogger - INFO - Processing new policy: 'Voluntary_Faculty_Appointment_Application_Requirements_Process' from folder: Voluntary_Faculty_Appointment_Application_Requirements_Process_20250409193339788344
2025-04-09 20:39:04,893 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 5
2025-04-09 20:39:04,894 - BackendLogger - INFO -   Split text content into 3 chunks.
2025-04-09 20:39:04,895 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 20:39:05,226 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 20:39:05,228 - BackendLogger - INFO -   Generated 3 embeddings.
2025-04-09 20:39:05,229 - BackendLogger - INFO -   Added 3 PolicyChunk records to session.
2025-04-09 20:39:05,231 - BackendLogger - INFO - Processing new policy: 'Workday_Finance_User-Based_Security_Groups_Request_Process' from folder: Workday_Finance_User-Based_Security_Groups_Request_Process_20250409194153006635
2025-04-09 20:39:05,250 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 6
2025-04-09 20:39:05,250 - BackendLogger - INFO -   Split text content into 3 chunks.
2025-04-09 20:39:05,251 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 20:39:05,847 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 20:39:05,849 - BackendLogger - INFO -   Generated 3 embeddings.
2025-04-09 20:39:05,850 - BackendLogger - INFO -   Added 3 PolicyChunk records to session.
2025-04-09 20:39:05,851 - BackendLogger - INFO - Processing new policy: 'Grand_Rounds_Allowable_Expenses' from folder: Grand_Rounds_Allowable_Expenses_20250409192920823251
2025-04-09 20:39:05,867 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 7
2025-04-09 20:39:05,869 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-09 20:39:05,870 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-09 20:39:06,523 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-09 20:39:06,525 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-09 20:39:06,526 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-09 20:39:06,527 - BackendLogger - INFO - Processing new policy: 'Voluntary_Faculty_Guidelines_Clarification' from folder: Voluntary_Faculty_Guidelines_Clarification_20250409193316792165
2025-04-09 20:39:06,550 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 8
2025-04-09 20:39:06,551 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-09 20:39:06,552 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-09 20:39:07,425 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-09 20:39:07,427 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-09 20:39:07,428 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-09 20:39:07,429 - BackendLogger - INFO - Processing new policy: 'Guidelines_for_Appointment' from folder: Guidelines_for_Appointment_20250409193232742762
2025-04-09 20:39:07,457 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 9
2025-04-09 20:39:07,458 - BackendLogger - INFO -   Split text content into 6 chunks.
2025-04-09 20:39:07,459 - BackendLogger - INFO - Generating embeddings for 6 texts
2025-04-09 20:39:07,970 - BackendLogger - INFO - Successfully generated 6 embeddings
2025-04-09 20:39:07,972 - BackendLogger - INFO -   Generated 6 embeddings.
2025-04-09 20:39:07,974 - BackendLogger - INFO -   Added 6 PolicyChunk records to session.
2025-04-09 20:39:07,975 - BackendLogger - INFO - Processing new policy: 'Critical_Out-Patient_Imaging_Findings_-_Immediate_Medical_Care_SOP' from folder: Critical_Out-Patient_Imaging_Findings_-_Immediate_Medical_Care_SOP_20250409193528279122
2025-04-09 20:39:07,998 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 10
2025-04-09 20:39:07,999 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-09 20:39:08,000 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-09 20:39:08,516 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-09 20:39:08,517 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-09 20:39:08,519 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-09 20:39:08,520 - BackendLogger - INFO - Processing new policy: 'YDR_Conflict_of_Interest_Policy' from folder: YDR_Conflict_of_Interest_Policy_20250409192856529512
2025-04-09 20:39:08,550 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 11
2025-04-09 20:39:08,557 - BackendLogger - INFO -   Split text content into 7 chunks.
2025-04-09 20:39:08,558 - BackendLogger - INFO - Generating embeddings for 7 texts
2025-04-09 20:39:08,895 - BackendLogger - INFO - Successfully generated 7 embeddings
2025-04-09 20:39:08,897 - BackendLogger - INFO -   Generated 7 embeddings.
2025-04-09 20:39:08,898 - BackendLogger - INFO -   Added 7 PolicyChunk records to session.
2025-04-09 20:39:08,900 - BackendLogger - INFO - Processing new policy: 'Controller_s_Office_Factsheet' from folder: Controller_s_Office_Factsheet_20250409202851867259
2025-04-09 20:39:08,912 - BackendLogger - ERROR -   Database integrity error (likely duplicate title) for 'Controller_s_Office_Factsheet': (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "uix_policy_title"
DETAIL:  Key (title)=(Controller_s_Office_Factsheet) already exists.
[SQL: INSERT INTO policies (title, description, source_url, markdown_content, text_content, policy_metadata, created_at, updated_at, search_vector) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::JSON, now(), now(), $7) RETURNING policies.id, policies.created_at, policies.updated_at]
[parameters: ('Controller_s_Office_Factsheet', None, 'https://your.yale.edu/policies-procedures/guides/controllers-office-factsheet', '# Source URL: https://your.yale.edu/policies-procedures/guides/controllers-office-factsheet\n# Final URL: https://your.yale.edu/policies-procedures/g ... (16556 characters truncated) ... ransit/shuttle)\n\n[Yale](http://www.yale.edu)\n\nCopyright © 2025 Yale University All Rights Reserved [Contact Internal Communications](/contact-us)', '# Source URL: https://your.yale.edu/policies-procedures/guides/controllers-office-factsheet\n# Final URL: https://your.yale.edu/policies-procedures/g ... (11237 characters truncated) ...  Links\n## Required Information\n## Yale Shuttle\nCopyright © 2025 Yale University All Rights Reserved [Contact Internal Communications](/contact-us)', '{"scrape_timestamp": "20250409202851867259", "source_folder": "Controller_s_Office_Factsheet_20250409202851867259", "processed_at": "2025-04-10T00:39:08.901289"}', None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-04-09 20:39:08,918 - BackendLogger - ERROR - Session rolled back due to error: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "uix_policy_title"
DETAIL:  Key (title)=(Controller_s_Office_Factsheet) already exists.
[SQL: INSERT INTO policies (title, description, source_url, markdown_content, text_content, policy_metadata, created_at, updated_at, search_vector) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::JSON, now(), now(), $7) RETURNING policies.id, policies.created_at, policies.updated_at]
[parameters: ('Controller_s_Office_Factsheet', None, 'https://your.yale.edu/policies-procedures/guides/controllers-office-factsheet', '# Source URL: https://your.yale.edu/policies-procedures/guides/controllers-office-factsheet\n# Final URL: https://your.yale.edu/policies-procedures/g ... (16556 characters truncated) ... ransit/shuttle)\n\n[Yale](http://www.yale.edu)\n\nCopyright © 2025 Yale University All Rights Reserved [Contact Internal Communications](/contact-us)', '# Source URL: https://your.yale.edu/policies-procedures/guides/controllers-office-factsheet\n# Final URL: https://your.yale.edu/policies-procedures/g ... (11237 characters truncated) ...  Links\n## Required Information\n## Yale Shuttle\nCopyright © 2025 Yale University All Rights Reserved [Contact Internal Communications](/contact-us)', '{"scrape_timestamp": "20250409202851867259", "source_folder": "Controller_s_Office_Factsheet_20250409202851867259", "processed_at": "2025-04-10T00:39:08.901289"}', None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-04-09 20:39:08,923 - BackendLogger - ERROR - Database initialization failed: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "uix_policy_title"
DETAIL:  Key (title)=(Controller_s_Office_Factsheet) already exists.
[SQL: INSERT INTO policies (title, description, source_url, markdown_content, text_content, policy_metadata, created_at, updated_at, search_vector) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::JSON, now(), now(), $7) RETURNING policies.id, policies.created_at, policies.updated_at]
[parameters: ('Controller_s_Office_Factsheet', None, 'https://your.yale.edu/policies-procedures/guides/controllers-office-factsheet', '# Source URL: https://your.yale.edu/policies-procedures/guides/controllers-office-factsheet\n# Final URL: https://your.yale.edu/policies-procedures/g ... (16556 characters truncated) ... ransit/shuttle)\n\n[Yale](http://www.yale.edu)\n\nCopyright © 2025 Yale University All Rights Reserved [Contact Internal Communications](/contact-us)', '# Source URL: https://your.yale.edu/policies-procedures/guides/controllers-office-factsheet\n# Final URL: https://your.yale.edu/policies-procedures/g ... (11237 characters truncated) ...  Links\n## Required Information\n## Yale Shuttle\nCopyright © 2025 Yale University All Rights Reserved [Contact Internal Communications](/contact-us)', '{"scrape_timestamp": "20250409202851867259", "source_folder": "Controller_s_Office_Factsheet_20250409202851867259", "processed_at": "2025-04-10T00:39:08.901289"}', None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/ydrpolicy/backend/database/init_db.py", line 498, in init_db
    await populate_database_from_scraped_policies()
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/ydrpolicy/backend/database/init_db.py", line 370, in populate_database_from_scraped_policies
    async with get_async_session() as session:
               ^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 217, in __aexit__
    await anext(self.gen)
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/ydrpolicy/backend/database/engine.py", line 70, in get_async_session
    await session.commit()
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1011, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2032, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "/Users/pouria/Documents/Coding/YDR Policy Scraping/.venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.UniqueViolationError'>: duplicate key value violates unique constraint "uix_policy_title"
DETAIL:  Key (title)=(Controller_s_Office_Factsheet) already exists.
[SQL: INSERT INTO policies (title, description, source_url, markdown_content, text_content, policy_metadata, created_at, updated_at, search_vector) VALUES ($1::VARCHAR, $2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::JSON, now(), now(), $7) RETURNING policies.id, policies.created_at, policies.updated_at]
[parameters: ('Controller_s_Office_Factsheet', None, 'https://your.yale.edu/policies-procedures/guides/controllers-office-factsheet', '# Source URL: https://your.yale.edu/policies-procedures/guides/controllers-office-factsheet\n# Final URL: https://your.yale.edu/policies-procedures/g ... (16556 characters truncated) ... ransit/shuttle)\n\n[Yale](http://www.yale.edu)\n\nCopyright © 2025 Yale University All Rights Reserved [Contact Internal Communications](/contact-us)', '# Source URL: https://your.yale.edu/policies-procedures/guides/controllers-office-factsheet\n# Final URL: https://your.yale.edu/policies-procedures/g ... (11237 characters truncated) ...  Links\n## Required Information\n## Yale Shuttle\nCopyright © 2025 Yale University All Rights Reserved [Contact Internal Communications](/contact-us)', '{"scrape_timestamp": "20250409202851867259", "source_folder": "Controller_s_Office_Factsheet_20250409202851867259", "processed_at": "2025-04-10T00:39:08.901289"}', None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-04-09 20:39:09,051 - BackendLogger - INFO - Database engine disposed.
2025-04-09 20:44:03,385 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:44:07,820 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy'... THIS WILL DELETE ALL DATA!
2025-04-09 20:44:10,521 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy'...
2025-04-09 20:44:10,525 - BackendLogger - INFO - Connections terminated.
2025-04-09 20:44:10,527 - BackendLogger - INFO - Dropping database 'ydrpolicy'...
2025-04-09 20:44:10,563 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy' dropped successfully.
2025-04-09 20:44:15,928 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:44:16,303 - BackendLogger - INFO - Starting database initialization for: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy
2025-04-09 20:44:16,303 - BackendLogger - INFO - Checking if database 'ydrpolicy' exists...
2025-04-09 20:44:16,312 - BackendLogger - INFO - Creating database 'ydrpolicy'...
2025-04-09 20:44:16,371 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy' created.
2025-04-09 20:44:16,373 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 20:44:16,391 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-09 20:44:16,391 - BackendLogger - INFO - Creating database tables if they don't exist...
2025-04-09 20:44:16,419 - BackendLogger - INFO - Tables checked/created.
2025-04-09 20:44:16,419 - BackendLogger - INFO - Applying search vector triggers...
2025-04-09 20:44:16,423 - BackendLogger - INFO - Search vector triggers applied.
2025-04-09 20:44:16,423 - BackendLogger - INFO - Starting data population from scraped_policies directory...
2025-04-09 20:44:16,423 - BackendLogger - INFO - Scanning scraped policies directory: /Users/pouria/Documents/Coding/YDR Policy Scraping/test_data/processed/scraped_policies
2025-04-09 20:44:16,424 - BackendLogger - INFO - Reading policy descriptions from CSV: /Users/pouria/Documents/Coding/YDR Policy Scraping/test_data/processed/processed_policies_log.csv
2025-04-09 20:44:16,426 - BackendLogger - INFO - Loaded 17 timestamp mappings and 17 URL mappings for policy descriptions
2025-04-09 20:44:16,426 - BackendLogger - INFO - Creating new database engine
2025-04-09 20:44:16,427 - BackendLogger - INFO - Database engine created successfully
2025-04-09 20:44:16,427 - BackendLogger - INFO - Fetching existing policy information from database...
2025-04-09 20:44:16,440 - BackendLogger - INFO - Found 0 existing policies in database.
2025-04-09 20:44:16,441 - BackendLogger - INFO - Processing new policy: 'Yale_University_Policy_on_Conflict_of_Interest' from folder: Yale_University_Policy_on_Conflict_of_Interest_20250409192912567168
2025-04-09 20:44:16,447 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 1
2025-04-09 20:44:16,447 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-09 20:44:16,488 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-09 20:44:17,024 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-09 20:44:17,025 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-09 20:44:17,025 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-09 20:44:17,026 - BackendLogger - INFO - Processing new policy: 'Residents_Wellbeing_Policy' from folder: Residents_Wellbeing_Policy_20250409193300717366
2025-04-09 20:44:17,048 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 2
2025-04-09 20:44:17,049 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-09 20:44:17,049 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-09 20:44:17,580 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-09 20:44:17,582 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-09 20:44:17,583 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-09 20:44:17,583 - BackendLogger - INFO - Processing new policy: 'School_of_Medicine_Sabbatical_and_Triennial_Leave_Policy' from folder: School_of_Medicine_Sabbatical_and_Triennial_Leave_Policy_20250409193128387433
2025-04-09 20:44:17,607 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 3
2025-04-09 20:44:17,608 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-09 20:44:17,609 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-09 20:44:21,551 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-09 20:44:21,553 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-09 20:44:21,554 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-09 20:44:21,555 - BackendLogger - INFO - Processing new policy: 'Controller_s_Office_Factsheet' from folder: Controller_s_Office_Factsheet_20250409194424987413
2025-04-09 20:44:21,575 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 4
2025-04-09 20:44:21,576 - BackendLogger - INFO -   Split text content into 21 chunks.
2025-04-09 20:44:21,576 - BackendLogger - INFO - Generating embeddings for 21 texts
2025-04-09 20:44:22,238 - BackendLogger - INFO - Successfully generated 21 embeddings
2025-04-09 20:44:22,239 - BackendLogger - INFO -   Generated 21 embeddings.
2025-04-09 20:44:22,241 - BackendLogger - INFO -   Added 21 PolicyChunk records to session.
2025-04-09 20:44:22,242 - BackendLogger - INFO - Processing new policy: 'Voluntary_Faculty_Appointment_Application_Requirements_Process' from folder: Voluntary_Faculty_Appointment_Application_Requirements_Process_20250409193339788344
2025-04-09 20:44:22,285 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 5
2025-04-09 20:44:22,286 - BackendLogger - INFO -   Split text content into 3 chunks.
2025-04-09 20:44:22,287 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 20:44:22,562 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 20:44:22,564 - BackendLogger - INFO -   Generated 3 embeddings.
2025-04-09 20:44:22,565 - BackendLogger - INFO -   Added 3 PolicyChunk records to session.
2025-04-09 20:44:22,566 - BackendLogger - INFO - Processing new policy: 'Workday_Finance_User-Based_Security_Groups_Request_Process' from folder: Workday_Finance_User-Based_Security_Groups_Request_Process_20250409194153006635
2025-04-09 20:44:22,579 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 6
2025-04-09 20:44:22,581 - BackendLogger - INFO -   Split text content into 3 chunks.
2025-04-09 20:44:22,582 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 20:44:23,086 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 20:44:23,087 - BackendLogger - INFO -   Generated 3 embeddings.
2025-04-09 20:44:23,089 - BackendLogger - INFO -   Added 3 PolicyChunk records to session.
2025-04-09 20:44:23,089 - BackendLogger - INFO - Processing new policy: 'Grand_Rounds_Allowable_Expenses' from folder: Grand_Rounds_Allowable_Expenses_20250409192920823251
2025-04-09 20:44:23,102 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 7
2025-04-09 20:44:23,103 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-09 20:44:23,104 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-09 20:44:23,529 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-09 20:44:23,531 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-09 20:44:23,532 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-09 20:44:23,533 - BackendLogger - INFO - Processing new policy: 'Voluntary_Faculty_Guidelines_Clarification' from folder: Voluntary_Faculty_Guidelines_Clarification_20250409193316792165
2025-04-09 20:44:23,549 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 8
2025-04-09 20:44:23,551 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-09 20:44:23,552 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-09 20:44:24,009 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-09 20:44:24,010 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-09 20:44:24,011 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-09 20:44:24,012 - BackendLogger - INFO - Processing new policy: 'Guidelines_for_Appointment' from folder: Guidelines_for_Appointment_20250409193232742762
2025-04-09 20:44:24,037 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 9
2025-04-09 20:44:24,039 - BackendLogger - INFO -   Split text content into 6 chunks.
2025-04-09 20:44:24,039 - BackendLogger - INFO - Generating embeddings for 6 texts
2025-04-09 20:44:25,545 - BackendLogger - INFO - Successfully generated 6 embeddings
2025-04-09 20:44:25,547 - BackendLogger - INFO -   Generated 6 embeddings.
2025-04-09 20:44:25,548 - BackendLogger - INFO -   Added 6 PolicyChunk records to session.
2025-04-09 20:44:25,549 - BackendLogger - INFO - Processing new policy: 'Critical_Out-Patient_Imaging_Findings_-_Immediate_Medical_Care_SOP' from folder: Critical_Out-Patient_Imaging_Findings_-_Immediate_Medical_Care_SOP_20250409193528279122
2025-04-09 20:44:25,566 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 10
2025-04-09 20:44:25,567 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-09 20:44:25,568 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-09 20:44:26,115 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-09 20:44:26,116 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-09 20:44:26,117 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-09 20:44:26,118 - BackendLogger - INFO - Processing new policy: 'YDR_Conflict_of_Interest_Policy' from folder: YDR_Conflict_of_Interest_Policy_20250409192856529512
2025-04-09 20:44:26,134 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 11
2025-04-09 20:44:26,136 - BackendLogger - INFO -   Split text content into 7 chunks.
2025-04-09 20:44:26,137 - BackendLogger - INFO - Generating embeddings for 7 texts
2025-04-09 20:44:26,734 - BackendLogger - INFO - Successfully generated 7 embeddings
2025-04-09 20:44:26,736 - BackendLogger - INFO -   Generated 7 embeddings.
2025-04-09 20:44:26,737 - BackendLogger - INFO -   Added 7 PolicyChunk records to session.
2025-04-09 20:44:26,755 - BackendLogger - INFO - Database population finished. Processed 11 new policies. Skipped 0 folders.
2025-04-09 20:44:26,756 - BackendLogger - INFO - [green]SUCCESS:[/green] Database initialization completed successfully.
2025-04-09 20:44:26,766 - BackendLogger - INFO - Database engine disposed.
2025-04-09 20:45:30,225 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:48:54,611 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:48:55,020 - BackendLogger - INFO - Starting database initialization for: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy
2025-04-09 20:48:55,021 - BackendLogger - INFO - Checking if database 'ydrpolicy' exists...
2025-04-09 20:48:55,030 - BackendLogger - INFO - Database 'ydrpolicy' already exists.
2025-04-09 20:48:55,033 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 20:48:55,044 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-09 20:48:55,044 - BackendLogger - INFO - Creating database tables if they don't exist...
2025-04-09 20:48:55,051 - BackendLogger - INFO - Tables checked/created.
2025-04-09 20:48:55,051 - BackendLogger - INFO - Applying search vector triggers...
2025-04-09 20:48:55,060 - BackendLogger - INFO - Search vector triggers applied.
2025-04-09 20:48:55,061 - BackendLogger - INFO - Starting data population from scraped_policies directory...
2025-04-09 20:48:55,061 - BackendLogger - INFO - Scanning scraped policies directory: /Users/pouria/Documents/Coding/YDR Policy Scraping/test_data/processed/scraped_policies
2025-04-09 20:48:55,061 - BackendLogger - INFO - Reading policy descriptions from CSV: /Users/pouria/Documents/Coding/YDR Policy Scraping/test_data/processed/processed_policies_log.csv
2025-04-09 20:48:55,063 - BackendLogger - INFO - Loaded 17 timestamp mappings and 17 URL mappings for policy descriptions
2025-04-09 20:48:55,064 - BackendLogger - INFO - Creating new database engine
2025-04-09 20:48:55,064 - BackendLogger - INFO - Database engine created successfully
2025-04-09 20:48:55,064 - BackendLogger - INFO - Fetching existing policy information from database...
2025-04-09 20:48:55,079 - BackendLogger - INFO - Found 11 existing policies in database.
2025-04-09 20:48:55,079 - BackendLogger - INFO - Processing new policy: 'Staff_Workplace_Policies' from folder: Staff_Workplace_Policies_20250409204542316052
2025-04-09 20:48:55,127 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 12
2025-04-09 20:48:55,132 - BackendLogger - INFO -   Split text content into 333 chunks.
2025-04-09 20:48:55,171 - BackendLogger - INFO - Generating embeddings for 333 texts
2025-04-09 20:48:56,897 - BackendLogger - INFO - Successfully generated 333 embeddings
2025-04-09 20:48:56,897 - BackendLogger - INFO -   Generated 333 embeddings.
2025-04-09 20:48:56,899 - BackendLogger - INFO -   Added 333 PolicyChunk records to session.
2025-04-09 20:48:57,161 - BackendLogger - INFO - Database population finished. Processed 1 new policies. Skipped 11 folders.
2025-04-09 20:48:57,161 - BackendLogger - INFO - [green]SUCCESS:[/green] Database initialization completed successfully.
2025-04-09 20:48:57,163 - BackendLogger - INFO - Database engine disposed.
2025-04-09 20:51:10,510 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:51:10,896 - BackendLogger - INFO - Starting database initialization for: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy
2025-04-09 20:51:10,896 - BackendLogger - INFO - Checking if database 'ydrpolicy' exists...
2025-04-09 20:51:10,906 - BackendLogger - INFO - Database 'ydrpolicy' already exists.
2025-04-09 20:51:10,909 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 20:51:10,921 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-09 20:51:10,921 - BackendLogger - INFO - Creating database tables if they don't exist...
2025-04-09 20:51:10,928 - BackendLogger - INFO - Tables checked/created.
2025-04-09 20:51:10,929 - BackendLogger - INFO - Applying search vector triggers...
2025-04-09 20:51:10,936 - BackendLogger - INFO - Search vector triggers applied.
2025-04-09 20:51:10,937 - BackendLogger - INFO - Starting data population from scraped_policies directory...
2025-04-09 20:51:10,937 - BackendLogger - INFO - Scanning scraped policies directory: /Users/pouria/Documents/Coding/YDR Policy Scraping/test_data/processed/scraped_policies
2025-04-09 20:51:10,937 - BackendLogger - INFO - Reading policy descriptions from CSV: /Users/pouria/Documents/Coding/YDR Policy Scraping/test_data/processed/processed_policies_log.csv
2025-04-09 20:51:10,939 - BackendLogger - INFO - Loaded 17 timestamp mappings and 17 URL mappings for policy descriptions
2025-04-09 20:51:10,939 - BackendLogger - INFO - Creating new database engine
2025-04-09 20:51:10,939 - BackendLogger - INFO - Database engine created successfully
2025-04-09 20:51:10,940 - BackendLogger - INFO - Fetching existing policy information from database...
2025-04-09 20:51:10,957 - BackendLogger - INFO - Found 12 existing policies in database.
2025-04-09 20:51:10,958 - BackendLogger - INFO - Found newer version of policy: 'YDR_Conflict_of_Interest_Policy', existing=20250409192856529512, new=20250409192856529523
2025-04-09 20:51:10,958 - BackendLogger - INFO - Deleting old version of policy with ID: 11
2025-04-09 20:51:10,958 - BackendLogger - WARNING - Attempting to delete policy with ID: 11 and all associated data.
2025-04-09 20:51:10,985 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 11 and associated data.
2025-04-09 20:51:10,986 - BackendLogger - INFO - Processing new policy: 'YDR_Conflict_of_Interest_Policy' from folder: YDR_Conflict_of_Interest_Policy_20250409192856529523
2025-04-09 20:51:10,996 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 13
2025-04-09 20:51:10,997 - BackendLogger - INFO -   Split text content into 7 chunks.
2025-04-09 20:51:11,035 - BackendLogger - INFO - Generating embeddings for 7 texts
2025-04-09 20:51:11,680 - BackendLogger - INFO - Successfully generated 7 embeddings
2025-04-09 20:51:11,682 - BackendLogger - INFO -   Generated 7 embeddings.
2025-04-09 20:51:11,684 - BackendLogger - INFO -   Added 7 PolicyChunk records to session.
2025-04-09 20:51:11,709 - BackendLogger - INFO - Database population finished. Processed 1 new policies. Skipped 11 folders.
2025-04-09 20:51:11,710 - BackendLogger - INFO - [green]SUCCESS:[/green] Database initialization completed successfully.
2025-04-09 20:51:11,714 - BackendLogger - INFO - Database engine disposed.
2025-04-09 20:57:22,944 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:57:34,098 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:57:37,553 - BackendLogger - INFO - Creating new database engine
2025-04-09 20:57:37,561 - BackendLogger - INFO - Database engine created successfully
2025-04-09 20:57:37,585 - BackendLogger - WARNING - Attempting to delete policy with ID: 12 and all associated data.
2025-04-09 20:57:37,676 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 12 and associated data.
2025-04-09 20:57:38,366 - BackendLogger - INFO - Logged policy update: policy_id=12, action=delete_failed, admin_id=None
2025-04-09 20:58:55,425 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:58:58,244 - BackendLogger - INFO - Creating new database engine
2025-04-09 20:58:58,252 - BackendLogger - INFO - Database engine created successfully
2025-04-09 20:59:05,291 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 20:59:06,984 - BackendLogger - INFO - Creating new database engine
2025-04-09 20:59:06,991 - BackendLogger - INFO - Database engine created successfully
2025-04-09 20:59:07,016 - BackendLogger - WARNING - Attempting to delete policy with ID: 12 and all associated data.
2025-04-09 20:59:07,100 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 12 and associated data.
2025-04-09 20:59:07,784 - BackendLogger - INFO - Logged policy update: policy_id=12, action=delete_failed, admin_id=None
2025-04-09 21:01:51,752 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 21:01:53,623 - BackendLogger - INFO - Creating new database engine
2025-04-09 21:01:53,632 - BackendLogger - INFO - Database engine created successfully
2025-04-09 21:01:53,659 - BackendLogger - INFO - Logged policy update: policy_id=12, action=delete, admin_id=None
2025-04-09 21:01:53,659 - BackendLogger - WARNING - Attempting to delete policy with ID: 12 and all associated data.
2025-04-09 21:01:53,751 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 12 and associated data.
2025-04-09 21:22:03,614 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 21:22:04,906 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy'... THIS WILL DELETE ALL DATA!
2025-04-09 21:22:06,291 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy'...
2025-04-09 21:22:06,298 - BackendLogger - INFO - Connections terminated.
2025-04-09 21:22:06,299 - BackendLogger - INFO - Dropping database 'ydrpolicy'...
2025-04-09 21:22:06,341 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy' dropped successfully.
2025-04-09 21:22:09,956 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 21:22:10,332 - BackendLogger - INFO - Starting database initialization for: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy
2025-04-09 21:22:10,333 - BackendLogger - INFO - Checking if database 'ydrpolicy' exists...
2025-04-09 21:22:10,341 - BackendLogger - INFO - Creating database 'ydrpolicy'...
2025-04-09 21:22:10,406 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy' created.
2025-04-09 21:22:10,409 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 21:22:10,427 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-09 21:22:10,427 - BackendLogger - INFO - Creating database tables if they don't exist...
2025-04-09 21:22:10,457 - BackendLogger - INFO - Tables checked/created.
2025-04-09 21:22:10,457 - BackendLogger - INFO - Applying search vector triggers...
2025-04-09 21:22:10,463 - BackendLogger - INFO - Search vector triggers applied.
2025-04-09 21:22:10,464 - BackendLogger - INFO - Starting data population from scraped_policies directory...
2025-04-09 21:22:10,464 - BackendLogger - INFO - Scanning scraped policies directory: /Users/pouria/Documents/Coding/YDR Policy Scraping/test_data/processed/scraped_policies
2025-04-09 21:22:10,464 - BackendLogger - INFO - Reading policy descriptions from CSV: /Users/pouria/Documents/Coding/YDR Policy Scraping/test_data/processed/processed_policies_log.csv
2025-04-09 21:22:10,469 - BackendLogger - INFO - Loaded 17 timestamp mappings and 17 URL mappings for policy descriptions
2025-04-09 21:22:10,470 - BackendLogger - INFO - Creating new database engine
2025-04-09 21:22:10,470 - BackendLogger - INFO - Database engine created successfully
2025-04-09 21:22:10,471 - BackendLogger - INFO - Fetching existing policy information from database...
2025-04-09 21:22:10,484 - BackendLogger - INFO - Found 0 existing policies in database.
2025-04-09 21:22:10,485 - BackendLogger - INFO - Processing new policy: 'Yale_University_Policy_on_Conflict_of_Interest' from folder: Yale_University_Policy_on_Conflict_of_Interest_20250409192912567168
2025-04-09 21:22:10,493 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 1
2025-04-09 21:22:10,494 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-09 21:22:10,553 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-09 21:22:11,311 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-09 21:22:11,312 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-09 21:22:11,313 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-09 21:22:11,313 - BackendLogger - INFO - Processing new policy: 'Residents_Wellbeing_Policy' from folder: Residents_Wellbeing_Policy_20250409193300717366
2025-04-09 21:22:11,341 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 2
2025-04-09 21:22:11,341 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-09 21:22:11,342 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-09 21:22:12,094 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-09 21:22:12,095 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-09 21:22:12,096 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-09 21:22:12,097 - BackendLogger - INFO - Processing new policy: 'School_of_Medicine_Sabbatical_and_Triennial_Leave_Policy' from folder: School_of_Medicine_Sabbatical_and_Triennial_Leave_Policy_20250409193128387433
2025-04-09 21:22:12,120 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 3
2025-04-09 21:22:12,122 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-09 21:22:12,122 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-09 21:22:12,915 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-09 21:22:12,916 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-09 21:22:12,917 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-09 21:22:12,918 - BackendLogger - INFO - Processing new policy: 'Controller_s_Office_Factsheet' from folder: Controller_s_Office_Factsheet_20250409194424987413
2025-04-09 21:22:12,938 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 4
2025-04-09 21:22:12,940 - BackendLogger - INFO -   Split text content into 21 chunks.
2025-04-09 21:22:12,941 - BackendLogger - INFO - Generating embeddings for 21 texts
2025-04-09 21:22:13,698 - BackendLogger - INFO - Successfully generated 21 embeddings
2025-04-09 21:22:13,699 - BackendLogger - INFO -   Generated 21 embeddings.
2025-04-09 21:22:13,701 - BackendLogger - INFO -   Added 21 PolicyChunk records to session.
2025-04-09 21:22:13,701 - BackendLogger - INFO - Processing new policy: 'Voluntary_Faculty_Appointment_Application_Requirements_Process' from folder: Voluntary_Faculty_Appointment_Application_Requirements_Process_20250409193339788344
2025-04-09 21:22:13,745 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 5
2025-04-09 21:22:13,745 - BackendLogger - INFO -   Split text content into 3 chunks.
2025-04-09 21:22:13,746 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 21:22:14,184 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 21:22:14,187 - BackendLogger - INFO -   Generated 3 embeddings.
2025-04-09 21:22:14,188 - BackendLogger - INFO -   Added 3 PolicyChunk records to session.
2025-04-09 21:22:14,190 - BackendLogger - INFO - Processing new policy: 'Workday_Finance_User-Based_Security_Groups_Request_Process' from folder: Workday_Finance_User-Based_Security_Groups_Request_Process_20250409194153006635
2025-04-09 21:22:14,201 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 6
2025-04-09 21:22:14,202 - BackendLogger - INFO -   Split text content into 3 chunks.
2025-04-09 21:22:14,203 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 21:22:14,785 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 21:22:14,787 - BackendLogger - INFO -   Generated 3 embeddings.
2025-04-09 21:22:14,787 - BackendLogger - INFO -   Added 3 PolicyChunk records to session.
2025-04-09 21:22:14,790 - BackendLogger - INFO - Processing new policy: 'Staff_Workplace_Policies' from folder: Staff_Workplace_Policies_20250409204542316052
2025-04-09 21:22:14,840 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 7
2025-04-09 21:22:14,850 - BackendLogger - INFO -   Split text content into 333 chunks.
2025-04-09 21:22:14,851 - BackendLogger - INFO - Generating embeddings for 333 texts
2025-04-09 21:22:16,783 - BackendLogger - INFO - Successfully generated 333 embeddings
2025-04-09 21:22:16,784 - BackendLogger - INFO -   Generated 333 embeddings.
2025-04-09 21:22:16,790 - BackendLogger - INFO -   Added 333 PolicyChunk records to session.
2025-04-09 21:22:16,790 - BackendLogger - INFO - Processing new policy: 'Grand_Rounds_Allowable_Expenses' from folder: Grand_Rounds_Allowable_Expenses_20250409192920823251
2025-04-09 21:22:17,056 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 8
2025-04-09 21:22:17,057 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-09 21:22:17,057 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-09 21:22:19,036 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-09 21:22:19,038 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-09 21:22:19,039 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-09 21:22:19,040 - BackendLogger - INFO - Processing new policy: 'Voluntary_Faculty_Guidelines_Clarification' from folder: Voluntary_Faculty_Guidelines_Clarification_20250409193316792165
2025-04-09 21:22:19,059 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 9
2025-04-09 21:22:19,061 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-09 21:22:19,062 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-09 21:22:23,921 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-09 21:22:23,923 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-09 21:22:23,924 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-09 21:22:23,925 - BackendLogger - INFO - Processing new policy: 'Guidelines_for_Appointment' from folder: Guidelines_for_Appointment_20250409193232742762
2025-04-09 21:22:23,947 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 10
2025-04-09 21:22:23,948 - BackendLogger - INFO -   Split text content into 6 chunks.
2025-04-09 21:22:23,948 - BackendLogger - INFO - Generating embeddings for 6 texts
2025-04-09 21:22:24,325 - BackendLogger - INFO - Successfully generated 6 embeddings
2025-04-09 21:22:24,325 - BackendLogger - INFO -   Generated 6 embeddings.
2025-04-09 21:22:24,326 - BackendLogger - INFO -   Added 6 PolicyChunk records to session.
2025-04-09 21:22:24,326 - BackendLogger - INFO - Processing new policy: 'Critical_Out-Patient_Imaging_Findings_-_Immediate_Medical_Care_SOP' from folder: Critical_Out-Patient_Imaging_Findings_-_Immediate_Medical_Care_SOP_20250409193528279122
2025-04-09 21:22:24,338 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 11
2025-04-09 21:22:24,339 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-09 21:22:24,340 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-09 21:22:25,004 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-09 21:22:25,006 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-09 21:22:25,007 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-09 21:22:25,009 - BackendLogger - INFO - Processing new policy: 'YDR_Conflict_of_Interest_Policy' from folder: YDR_Conflict_of_Interest_Policy_20250409192856529523
2025-04-09 21:22:25,026 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 12
2025-04-09 21:22:25,028 - BackendLogger - INFO -   Split text content into 7 chunks.
2025-04-09 21:22:25,028 - BackendLogger - INFO - Generating embeddings for 7 texts
2025-04-09 21:22:26,064 - BackendLogger - INFO - Successfully generated 7 embeddings
2025-04-09 21:22:26,066 - BackendLogger - INFO -   Generated 7 embeddings.
2025-04-09 21:22:26,067 - BackendLogger - INFO -   Added 7 PolicyChunk records to session.
2025-04-09 21:22:26,086 - BackendLogger - INFO - Database population finished. Processed 12 new policies. Skipped 0 folders.
2025-04-09 21:22:26,087 - BackendLogger - INFO - [green]SUCCESS:[/green] Database initialization completed successfully.
2025-04-09 21:22:26,098 - BackendLogger - INFO - Database engine disposed.
2025-04-09 21:25:44,764 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 21:25:46,270 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 21:25:46,984 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 21:25:47,037 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 21:25:47,391 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 21:25:47,433 - BackendLogger - INFO - Performing text-only search for query: 'guideline' with limit=5
2025-04-09 21:25:47,436 - BackendLogger - INFO - Performing text-only search for query: 'compliance' with limit=5
2025-04-09 21:25:47,438 - BackendLogger - INFO - Performing text-only search for query: 'introduction' with limit=5
2025-04-09 21:25:47,440 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.7
2025-04-09 21:25:47,443 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.7
2025-04-09 21:25:47,445 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.7
2025-04-09 21:25:47,447 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.95
2025-04-09 21:25:47,449 - BackendLogger - INFO - Performing hybrid search with query='guideline', weight=0.8, limit=5
2025-04-09 21:25:47,458 - BackendLogger - INFO - Retrieving 1 complete policies from chunk results...
2025-04-09 21:25:47,504 - BackendLogger - INFO - Logged policy update: policy_id=2, action=test_update, admin_id=1
2025-04-09 21:25:47,508 - BackendLogger - WARNING - Attempting to delete policy with ID: 4 and all associated data.
2025-04-09 21:25:47,526 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 4 and associated data.
2025-04-09 21:25:47,527 - BackendLogger - WARNING - Attempting to delete policy with ID: 2 and all associated data.
2025-04-09 21:25:47,530 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 2 and associated data.
2025-04-09 21:26:17,568 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 21:26:18,422 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 21:26:18,829 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 21:26:18,871 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 21:26:19,465 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 21:26:19,503 - BackendLogger - INFO - Performing text-only search for query: 'guideline' with limit=5
2025-04-09 21:26:19,506 - BackendLogger - INFO - Performing text-only search for query: 'compliance' with limit=5
2025-04-09 21:26:19,508 - BackendLogger - INFO - Performing text-only search for query: 'introduction' with limit=5
2025-04-09 21:26:19,510 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.7
2025-04-09 21:26:19,514 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.5
2025-04-09 21:26:19,517 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.7
2025-04-09 21:26:19,518 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.95
2025-04-09 21:26:19,521 - BackendLogger - INFO - Performing hybrid search with query='guideline', weight=0.8, limit=5
2025-04-09 21:26:19,530 - BackendLogger - INFO - Retrieving 1 complete policies from chunk results...
2025-04-09 21:26:19,579 - BackendLogger - INFO - Logged policy update: policy_id=2, action=test_update, admin_id=1
2025-04-09 21:26:19,583 - BackendLogger - WARNING - Attempting to delete policy with ID: 4 and all associated data.
2025-04-09 21:26:19,599 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 4 and associated data.
2025-04-09 21:26:19,600 - BackendLogger - WARNING - Attempting to delete policy with ID: 2 and all associated data.
2025-04-09 21:26:19,603 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 2 and associated data.
2025-04-09 21:28:00,097 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 21:28:00,934 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 21:28:01,435 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 21:28:01,475 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 21:28:02,049 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 21:28:02,088 - BackendLogger - INFO - Performing text-only search for query: 'guideline' with limit=5
2025-04-09 21:28:02,091 - BackendLogger - INFO - Performing text-only search for query: 'compliance' with limit=5
2025-04-09 21:28:02,093 - BackendLogger - INFO - Performing text-only search for query: 'introduction' with limit=5
2025-04-09 21:28:02,094 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.7
2025-04-09 21:28:02,098 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.5
2025-04-09 21:28:02,101 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.7
2025-04-09 21:28:02,103 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.95
2025-04-09 21:28:02,105 - BackendLogger - INFO - Performing hybrid search with query='guideline', weight=0.8, limit=5
2025-04-09 21:28:02,113 - BackendLogger - INFO - Retrieving 1 complete policies from chunk results...
2025-04-09 21:28:02,163 - BackendLogger - INFO - Logged policy update: policy_id=2, action=test_update, admin_id=1
2025-04-09 21:28:02,167 - BackendLogger - WARNING - Attempting to delete policy with ID: 4 and all associated data.
2025-04-09 21:28:02,185 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 4 and associated data.
2025-04-09 21:28:02,185 - BackendLogger - WARNING - Attempting to delete policy with ID: 2 and all associated data.
2025-04-09 21:28:02,189 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 2 and associated data.
2025-04-09 21:29:54,867 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 21:29:55,173 - BackendLogger - INFO - Logged policy update: policy_id=1, action=update, admin_id=2
2025-04-09 21:29:55,176 - BackendLogger - WARNING - Attempting to delete policy with ID: 1 and all associated data.
2025-04-09 21:29:55,180 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 1 and associated data.
2025-04-09 21:29:55,223 - BackendLogger - INFO - Performing vector-only search with limit=2, threshold=0.7
2025-04-09 21:31:42,213 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 21:31:43,319 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 21:31:44,002 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 21:31:44,047 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 21:31:44,470 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 21:31:44,509 - BackendLogger - INFO - Performing text-only search for query: 'guideline' with limit=5
2025-04-09 21:31:44,513 - BackendLogger - INFO - Performing text-only search for query: 'compliance' with limit=5
2025-04-09 21:31:44,516 - BackendLogger - INFO - Performing text-only search for query: 'introduction' with limit=5
2025-04-09 21:31:44,518 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.7
2025-04-09 21:31:44,523 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.5
2025-04-09 21:31:44,526 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.7
2025-04-09 21:31:44,528 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.95
2025-04-09 21:31:44,531 - BackendLogger - INFO - Performing hybrid search with query='guideline', weight=0.8, limit=5
2025-04-09 21:31:44,540 - BackendLogger - INFO - Retrieving 1 complete policies from chunk results...
2025-04-09 21:31:44,596 - BackendLogger - INFO - Logged policy update: policy_id=2, action=test_update, admin_id=1
2025-04-09 21:31:44,599 - BackendLogger - WARNING - Attempting to delete policy with ID: 4 and all associated data.
2025-04-09 21:31:44,613 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 4 and associated data.
2025-04-09 21:31:44,614 - BackendLogger - WARNING - Attempting to delete policy with ID: 2 and all associated data.
2025-04-09 21:31:44,617 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 2 and associated data.
2025-04-09 21:32:00,239 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 21:32:00,551 - BackendLogger - INFO - Logged policy update: policy_id=1, action=update, admin_id=2
2025-04-09 21:32:00,554 - BackendLogger - WARNING - Attempting to delete policy with ID: 1 and all associated data.
2025-04-09 21:32:00,558 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 1 and associated data.
2025-04-09 21:32:00,601 - BackendLogger - INFO - Performing vector-only search with limit=2, threshold=0.7
2025-04-09 21:32:59,837 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 21:33:01,271 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 21:33:01,574 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 21:33:01,605 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 21:33:01,883 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 21:33:01,917 - BackendLogger - INFO - Performing text-only search for query: 'guideline' with limit=5
2025-04-09 21:33:01,920 - BackendLogger - INFO - Performing text-only search for query: 'compliance' with limit=5
2025-04-09 21:33:01,922 - BackendLogger - INFO - Performing text-only search for query: 'introduction' with limit=5
2025-04-09 21:33:01,924 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.7
2025-04-09 21:33:01,928 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.5
2025-04-09 21:33:01,931 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.7
2025-04-09 21:33:01,933 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.95
2025-04-09 21:33:01,935 - BackendLogger - INFO - Performing hybrid search with query='guideline', weight=0.8, limit=5
2025-04-09 21:33:01,945 - BackendLogger - INFO - Retrieving 1 complete policies from chunk results...
2025-04-09 21:33:02,006 - BackendLogger - INFO - Logged policy update: policy_id=2, action=test_update, admin_id=1
2025-04-09 21:33:02,010 - BackendLogger - WARNING - Attempting to delete policy with ID: 4 and all associated data.
2025-04-09 21:33:02,026 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 4 and associated data.
2025-04-09 21:33:02,027 - BackendLogger - WARNING - Attempting to delete policy with ID: 2 and all associated data.
2025-04-09 21:33:02,031 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 2 and associated data.
2025-04-09 21:33:21,059 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 21:33:21,449 - BackendLogger - INFO - Logged policy update: policy_id=1, action=update, admin_id=2
2025-04-09 21:33:21,453 - BackendLogger - WARNING - Attempting to delete policy with ID: 1 and all associated data.
2025-04-09 21:33:21,458 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 1 and associated data.
2025-04-09 21:33:21,522 - BackendLogger - INFO - Performing vector-only search with limit=2, threshold=0.7
2025-04-09 21:37:02,446 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 21:37:03,439 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy'... THIS WILL DELETE ALL DATA!
2025-04-09 21:37:04,141 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy'...
2025-04-09 21:37:04,146 - BackendLogger - INFO - Connections terminated.
2025-04-09 21:37:04,146 - BackendLogger - INFO - Dropping database 'ydrpolicy'...
2025-04-09 21:37:04,186 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy' dropped successfully.
2025-04-09 21:37:10,697 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 21:37:11,078 - BackendLogger - INFO - Starting database initialization for: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy
2025-04-09 21:37:11,079 - BackendLogger - INFO - Checking if database 'ydrpolicy' exists...
2025-04-09 21:37:11,088 - BackendLogger - INFO - Creating database 'ydrpolicy'...
2025-04-09 21:37:11,147 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy' created.
2025-04-09 21:37:11,149 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 21:37:11,165 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-09 21:37:11,165 - BackendLogger - INFO - Creating database tables if they don't exist...
2025-04-09 21:37:11,192 - BackendLogger - INFO - Tables checked/created.
2025-04-09 21:37:11,192 - BackendLogger - INFO - Applying search vector triggers...
2025-04-09 21:37:11,195 - BackendLogger - INFO - Search vector triggers applied.
2025-04-09 21:37:11,196 - BackendLogger - INFO - Starting data population from scraped_policies directory...
2025-04-09 21:37:11,196 - BackendLogger - INFO - Scanning scraped policies directory: /Users/pouria/Documents/Coding/YDR Policy Scraping/tests/data_collection/test_data/processed/scraped_policies
2025-04-09 21:37:11,196 - BackendLogger - INFO - Reading policy descriptions from CSV: /Users/pouria/Documents/Coding/YDR Policy Scraping/tests/data_collection/test_data/processed/processed_policies_log.csv
2025-04-09 21:37:11,200 - BackendLogger - INFO - Loaded 17 timestamp mappings and 17 URL mappings for policy descriptions
2025-04-09 21:37:11,201 - BackendLogger - INFO - Creating new database engine
2025-04-09 21:37:11,201 - BackendLogger - INFO - Database engine created successfully
2025-04-09 21:37:11,201 - BackendLogger - INFO - Fetching existing policy information from database...
2025-04-09 21:37:11,213 - BackendLogger - INFO - Found 0 existing policies in database.
2025-04-09 21:37:11,214 - BackendLogger - INFO - Processing new policy: 'Yale_University_Policy_on_Conflict_of_Interest' from folder: Yale_University_Policy_on_Conflict_of_Interest_20250409192912567168
2025-04-09 21:37:11,219 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 1
2025-04-09 21:37:11,220 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-09 21:37:11,259 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-09 21:37:12,070 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-09 21:37:12,071 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-09 21:37:12,071 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-09 21:37:12,072 - BackendLogger - INFO - Processing new policy: 'Residents_Wellbeing_Policy' from folder: Residents_Wellbeing_Policy_20250409193300717366
2025-04-09 21:37:12,094 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 2
2025-04-09 21:37:12,095 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-09 21:37:12,095 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-09 21:37:12,402 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-09 21:37:12,404 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-09 21:37:12,405 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-09 21:37:12,406 - BackendLogger - INFO - Processing new policy: 'School_of_Medicine_Sabbatical_and_Triennial_Leave_Policy' from folder: School_of_Medicine_Sabbatical_and_Triennial_Leave_Policy_20250409193128387433
2025-04-09 21:37:12,430 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 3
2025-04-09 21:37:12,432 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-09 21:37:12,432 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-09 21:37:13,021 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-09 21:37:13,023 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-09 21:37:13,025 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-09 21:37:13,026 - BackendLogger - INFO - Processing new policy: 'Controller_s_Office_Factsheet' from folder: Controller_s_Office_Factsheet_20250409194424987413
2025-04-09 21:37:13,047 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 4
2025-04-09 21:37:13,049 - BackendLogger - INFO -   Split text content into 21 chunks.
2025-04-09 21:37:13,049 - BackendLogger - INFO - Generating embeddings for 21 texts
2025-04-09 21:37:13,596 - BackendLogger - INFO - Successfully generated 21 embeddings
2025-04-09 21:37:13,597 - BackendLogger - INFO -   Generated 21 embeddings.
2025-04-09 21:37:13,599 - BackendLogger - INFO -   Added 21 PolicyChunk records to session.
2025-04-09 21:37:13,599 - BackendLogger - INFO - Processing new policy: 'Voluntary_Faculty_Appointment_Application_Requirements_Process' from folder: Voluntary_Faculty_Appointment_Application_Requirements_Process_20250409193339788344
2025-04-09 21:37:13,643 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 5
2025-04-09 21:37:13,644 - BackendLogger - INFO -   Split text content into 3 chunks.
2025-04-09 21:37:13,644 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 21:37:14,102 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 21:37:14,103 - BackendLogger - INFO -   Generated 3 embeddings.
2025-04-09 21:37:14,104 - BackendLogger - INFO -   Added 3 PolicyChunk records to session.
2025-04-09 21:37:14,105 - BackendLogger - INFO - Processing new policy: 'Workday_Finance_User-Based_Security_Groups_Request_Process' from folder: Workday_Finance_User-Based_Security_Groups_Request_Process_20250409194153006635
2025-04-09 21:37:14,118 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 6
2025-04-09 21:37:14,119 - BackendLogger - INFO -   Split text content into 3 chunks.
2025-04-09 21:37:14,120 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 21:37:14,818 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 21:37:14,820 - BackendLogger - INFO -   Generated 3 embeddings.
2025-04-09 21:37:14,821 - BackendLogger - INFO -   Added 3 PolicyChunk records to session.
2025-04-09 21:37:14,824 - BackendLogger - INFO - Processing new policy: 'Staff_Workplace_Policies' from folder: Staff_Workplace_Policies_20250409204542316052
2025-04-09 21:37:14,872 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 7
2025-04-09 21:37:14,880 - BackendLogger - INFO -   Split text content into 333 chunks.
2025-04-09 21:37:14,881 - BackendLogger - INFO - Generating embeddings for 333 texts
2025-04-09 21:37:16,920 - BackendLogger - INFO - Successfully generated 333 embeddings
2025-04-09 21:37:16,921 - BackendLogger - INFO -   Generated 333 embeddings.
2025-04-09 21:37:16,926 - BackendLogger - INFO -   Added 333 PolicyChunk records to session.
2025-04-09 21:37:16,926 - BackendLogger - INFO - Processing new policy: 'Grand_Rounds_Allowable_Expenses' from folder: Grand_Rounds_Allowable_Expenses_20250409192920823251
2025-04-09 21:37:17,191 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 8
2025-04-09 21:37:17,192 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-09 21:37:17,192 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-09 21:37:17,747 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-09 21:37:17,747 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-09 21:37:17,748 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-09 21:37:17,748 - BackendLogger - INFO - Processing new policy: 'Voluntary_Faculty_Guidelines_Clarification' from folder: Voluntary_Faculty_Guidelines_Clarification_20250409193316792165
2025-04-09 21:37:17,763 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 9
2025-04-09 21:37:17,764 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-09 21:37:17,764 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-09 21:37:18,691 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-09 21:37:18,693 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-09 21:37:18,694 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-09 21:37:18,695 - BackendLogger - INFO - Processing new policy: 'Guidelines_for_Appointment' from folder: Guidelines_for_Appointment_20250409193232742762
2025-04-09 21:37:18,721 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 10
2025-04-09 21:37:18,723 - BackendLogger - INFO -   Split text content into 6 chunks.
2025-04-09 21:37:18,723 - BackendLogger - INFO - Generating embeddings for 6 texts
2025-04-09 21:37:19,225 - BackendLogger - INFO - Successfully generated 6 embeddings
2025-04-09 21:37:19,226 - BackendLogger - INFO -   Generated 6 embeddings.
2025-04-09 21:37:19,227 - BackendLogger - INFO -   Added 6 PolicyChunk records to session.
2025-04-09 21:37:19,228 - BackendLogger - INFO - Processing new policy: 'Critical_Out-Patient_Imaging_Findings_-_Immediate_Medical_Care_SOP' from folder: Critical_Out-Patient_Imaging_Findings_-_Immediate_Medical_Care_SOP_20250409193528279122
2025-04-09 21:37:19,249 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 11
2025-04-09 21:37:19,250 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-09 21:37:19,251 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-09 21:37:19,936 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-09 21:37:19,937 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-09 21:37:19,937 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-09 21:37:19,939 - BackendLogger - INFO - Processing new policy: 'YDR_Conflict_of_Interest_Policy' from folder: YDR_Conflict_of_Interest_Policy_20250409192856529523
2025-04-09 21:37:19,953 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 12
2025-04-09 21:37:19,954 - BackendLogger - INFO -   Split text content into 7 chunks.
2025-04-09 21:37:19,954 - BackendLogger - INFO - Generating embeddings for 7 texts
2025-04-09 21:37:20,889 - BackendLogger - INFO - Successfully generated 7 embeddings
2025-04-09 21:37:20,891 - BackendLogger - INFO -   Generated 7 embeddings.
2025-04-09 21:37:20,892 - BackendLogger - INFO -   Added 7 PolicyChunk records to session.
2025-04-09 21:37:20,905 - BackendLogger - INFO - Database population finished. Processed 12 new policies. Skipped 0 folders.
2025-04-09 21:37:20,906 - BackendLogger - INFO - [green]SUCCESS:[/green] Database initialization completed successfully.
2025-04-09 21:37:20,915 - BackendLogger - INFO - Database engine disposed.
2025-04-09 22:21:06,698 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 22:21:09,192 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy'... THIS WILL DELETE ALL DATA!
2025-04-09 22:21:10,357 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy'...
2025-04-09 22:21:10,362 - BackendLogger - INFO - Connections terminated.
2025-04-09 22:21:10,363 - BackendLogger - INFO - Dropping database 'ydrpolicy'...
2025-04-09 22:21:10,405 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy' dropped successfully.
2025-04-09 22:21:27,701 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 22:21:28,077 - BackendLogger - INFO - Starting database initialization for: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy
2025-04-09 22:21:28,077 - BackendLogger - INFO - Checking if database 'ydrpolicy' exists...
2025-04-09 22:21:28,085 - BackendLogger - INFO - Creating database 'ydrpolicy'...
2025-04-09 22:21:28,153 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy' created.
2025-04-09 22:21:28,156 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 22:21:28,173 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-09 22:21:28,174 - BackendLogger - INFO - Creating database tables if they don't exist...
2025-04-09 22:21:28,200 - BackendLogger - INFO - Tables checked/created.
2025-04-09 22:21:28,200 - BackendLogger - INFO - Applying search vector triggers...
2025-04-09 22:21:28,205 - BackendLogger - INFO - Search vector triggers applied.
2025-04-09 22:21:28,205 - BackendLogger - INFO - Starting data population from scraped_policies directory...
2025-04-09 22:21:28,205 - BackendLogger - INFO - Scanning scraped policies directory: /Users/pouria/Documents/Coding/YDR Policy Scraping/tests/data_collection/test_data/processed/scraped_policies
2025-04-09 22:21:28,206 - BackendLogger - INFO - Reading policy descriptions from CSV: /Users/pouria/Documents/Coding/YDR Policy Scraping/tests/data_collection/test_data/processed/processed_policies_log.csv
2025-04-09 22:21:28,210 - BackendLogger - INFO - Loaded 17 timestamp mappings and 17 URL mappings for policy descriptions
2025-04-09 22:21:28,210 - BackendLogger - INFO - Creating new database engine
2025-04-09 22:21:28,211 - BackendLogger - INFO - Database engine created successfully
2025-04-09 22:21:28,211 - BackendLogger - INFO - Fetching existing policy information from database...
2025-04-09 22:21:28,224 - BackendLogger - INFO - Found 0 existing policies in database.
2025-04-09 22:21:28,224 - BackendLogger - INFO - Processing new policy: 'Yale_University_Policy_on_Conflict_of_Interest' from folder: Yale_University_Policy_on_Conflict_of_Interest_20250409192912567168
2025-04-09 22:21:28,236 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 1
2025-04-09 22:21:28,237 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-09 22:21:28,289 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-09 22:21:29,072 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-09 22:21:29,072 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-09 22:21:29,073 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-09 22:21:29,073 - BackendLogger - INFO - Processing new policy: 'Residents_Wellbeing_Policy' from folder: Residents_Wellbeing_Policy_20250409193300717366
2025-04-09 22:21:29,100 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 2
2025-04-09 22:21:29,101 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-09 22:21:29,101 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-09 22:21:30,246 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-09 22:21:30,248 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-09 22:21:30,249 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-09 22:21:30,249 - BackendLogger - INFO - Processing new policy: 'School_of_Medicine_Sabbatical_and_Triennial_Leave_Policy' from folder: School_of_Medicine_Sabbatical_and_Triennial_Leave_Policy_20250409193128387433
2025-04-09 22:21:30,269 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 3
2025-04-09 22:21:30,270 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-09 22:21:30,271 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-09 22:21:31,120 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-09 22:21:31,122 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-09 22:21:31,123 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-09 22:21:31,125 - BackendLogger - INFO - Processing new policy: 'Controller_s_Office_Factsheet' from folder: Controller_s_Office_Factsheet_20250409194424987413
2025-04-09 22:21:31,144 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 4
2025-04-09 22:21:31,146 - BackendLogger - INFO -   Split text content into 21 chunks.
2025-04-09 22:21:31,147 - BackendLogger - INFO - Generating embeddings for 21 texts
2025-04-09 22:21:32,193 - BackendLogger - INFO - Successfully generated 21 embeddings
2025-04-09 22:21:32,194 - BackendLogger - INFO -   Generated 21 embeddings.
2025-04-09 22:21:32,196 - BackendLogger - INFO -   Added 21 PolicyChunk records to session.
2025-04-09 22:21:32,197 - BackendLogger - INFO - Processing new policy: 'Voluntary_Faculty_Appointment_Application_Requirements_Process' from folder: Voluntary_Faculty_Appointment_Application_Requirements_Process_20250409193339788344
2025-04-09 22:21:32,241 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 5
2025-04-09 22:21:32,242 - BackendLogger - INFO -   Split text content into 3 chunks.
2025-04-09 22:21:32,243 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 22:21:32,787 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 22:21:32,789 - BackendLogger - INFO -   Generated 3 embeddings.
2025-04-09 22:21:32,790 - BackendLogger - INFO -   Added 3 PolicyChunk records to session.
2025-04-09 22:21:32,791 - BackendLogger - INFO - Processing new policy: 'Workday_Finance_User-Based_Security_Groups_Request_Process' from folder: Workday_Finance_User-Based_Security_Groups_Request_Process_20250409194153006635
2025-04-09 22:21:32,802 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 6
2025-04-09 22:21:32,803 - BackendLogger - INFO -   Split text content into 3 chunks.
2025-04-09 22:21:32,804 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 22:21:33,321 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 22:21:33,323 - BackendLogger - INFO -   Generated 3 embeddings.
2025-04-09 22:21:33,324 - BackendLogger - INFO -   Added 3 PolicyChunk records to session.
2025-04-09 22:21:33,327 - BackendLogger - INFO - Processing new policy: 'Staff_Workplace_Policies' from folder: Staff_Workplace_Policies_20250409204542316052
2025-04-09 22:21:33,370 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 7
2025-04-09 22:21:33,378 - BackendLogger - INFO -   Split text content into 333 chunks.
2025-04-09 22:21:33,378 - BackendLogger - INFO - Generating embeddings for 333 texts
2025-04-09 22:21:36,321 - BackendLogger - INFO - Successfully generated 333 embeddings
2025-04-09 22:21:36,322 - BackendLogger - INFO -   Generated 333 embeddings.
2025-04-09 22:21:36,328 - BackendLogger - INFO -   Added 333 PolicyChunk records to session.
2025-04-09 22:21:36,328 - BackendLogger - INFO - Processing new policy: 'Grand_Rounds_Allowable_Expenses' from folder: Grand_Rounds_Allowable_Expenses_20250409192920823251
2025-04-09 22:21:36,599 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 8
2025-04-09 22:21:36,600 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-09 22:21:36,600 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-09 22:21:37,192 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-09 22:21:37,194 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-09 22:21:37,196 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-09 22:21:37,197 - BackendLogger - INFO - Processing new policy: 'Voluntary_Faculty_Guidelines_Clarification' from folder: Voluntary_Faculty_Guidelines_Clarification_20250409193316792165
2025-04-09 22:21:37,216 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 9
2025-04-09 22:21:37,218 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-09 22:21:37,219 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-09 22:21:37,995 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-09 22:21:37,997 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-09 22:21:37,998 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-09 22:21:37,999 - BackendLogger - INFO - Processing new policy: 'Guidelines_for_Appointment' from folder: Guidelines_for_Appointment_20250409193232742762
2025-04-09 22:21:38,025 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 10
2025-04-09 22:21:38,026 - BackendLogger - INFO -   Split text content into 6 chunks.
2025-04-09 22:21:38,027 - BackendLogger - INFO - Generating embeddings for 6 texts
2025-04-09 22:21:38,830 - BackendLogger - INFO - Successfully generated 6 embeddings
2025-04-09 22:21:38,831 - BackendLogger - INFO -   Generated 6 embeddings.
2025-04-09 22:21:38,832 - BackendLogger - INFO -   Added 6 PolicyChunk records to session.
2025-04-09 22:21:38,833 - BackendLogger - INFO - Processing new policy: 'Critical_Out-Patient_Imaging_Findings_-_Immediate_Medical_Care_SOP' from folder: Critical_Out-Patient_Imaging_Findings_-_Immediate_Medical_Care_SOP_20250409193528279122
2025-04-09 22:21:38,852 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 11
2025-04-09 22:21:38,853 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-09 22:21:38,854 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-09 22:21:39,734 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-09 22:21:39,736 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-09 22:21:39,737 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-09 22:21:39,739 - BackendLogger - INFO - Processing new policy: 'YDR_Conflict_of_Interest_Policy' from folder: YDR_Conflict_of_Interest_Policy_20250409192856529523
2025-04-09 22:21:39,754 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 12
2025-04-09 22:21:39,755 - BackendLogger - INFO -   Split text content into 7 chunks.
2025-04-09 22:21:39,755 - BackendLogger - INFO - Generating embeddings for 7 texts
2025-04-09 22:21:40,231 - BackendLogger - INFO - Successfully generated 7 embeddings
2025-04-09 22:21:40,232 - BackendLogger - INFO -   Generated 7 embeddings.
2025-04-09 22:21:40,233 - BackendLogger - INFO -   Added 7 PolicyChunk records to session.
2025-04-09 22:21:40,248 - BackendLogger - INFO - Database population finished. Processed 12 new policies. Skipped 0 folders.
2025-04-09 22:21:40,249 - BackendLogger - INFO - [green]SUCCESS:[/green] Database initialization completed successfully.
2025-04-09 22:21:40,259 - BackendLogger - INFO - Database engine disposed.
2025-04-09 22:22:11,507 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 22:22:12,423 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 22:22:12,974 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 22:22:13,020 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 22:22:13,383 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 22:22:13,420 - BackendLogger - INFO - Performing text-only search for query: 'guideline' with limit=5
2025-04-09 22:22:13,424 - BackendLogger - INFO - Performing text-only search for query: 'compliance' with limit=5
2025-04-09 22:22:13,426 - BackendLogger - INFO - Performing text-only search for query: 'introduction' with limit=5
2025-04-09 22:22:13,428 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.7
2025-04-09 22:22:13,431 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.5
2025-04-09 22:22:13,434 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.7
2025-04-09 22:22:13,435 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.95
2025-04-09 22:22:13,438 - BackendLogger - INFO - Performing hybrid search with query='guideline', weight=0.8, limit=5
2025-04-09 22:22:13,445 - BackendLogger - INFO - Retrieving 1 complete policies from chunk results...
2025-04-09 22:22:13,487 - BackendLogger - INFO - Logged policy update: policy_id=2, action=test_update, admin_id=1
2025-04-09 22:22:13,490 - BackendLogger - WARNING - Attempting to delete policy with ID: 4 and all associated data.
2025-04-09 22:22:13,504 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 4 and associated data.
2025-04-09 22:22:13,505 - BackendLogger - WARNING - Attempting to delete policy with ID: 2 and all associated data.
2025-04-09 22:22:13,509 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 2 and associated data.
2025-04-09 22:22:22,169 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 22:22:22,487 - BackendLogger - INFO - Logged policy update: policy_id=1, action=update, admin_id=2
2025-04-09 22:22:22,490 - BackendLogger - WARNING - Attempting to delete policy with ID: 1 and all associated data.
2025-04-09 22:22:22,494 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 1 and associated data.
2025-04-09 22:22:22,538 - BackendLogger - INFO - Performing vector-only search with limit=2, threshold=0.7
2025-04-09 23:15:29,498 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 23:15:45,799 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 23:15:55,657 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy'... THIS WILL DELETE ALL DATA!
2025-04-09 23:15:58,749 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy'...
2025-04-09 23:15:58,754 - BackendLogger - INFO - Connections terminated.
2025-04-09 23:15:58,755 - BackendLogger - INFO - Dropping database 'ydrpolicy'...
2025-04-09 23:15:58,802 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy' dropped successfully.
2025-04-09 23:16:05,659 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 23:16:06,035 - BackendLogger - INFO - Starting database initialization for: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy
2025-04-09 23:16:06,035 - BackendLogger - INFO - Checking if database 'ydrpolicy' exists...
2025-04-09 23:16:06,043 - BackendLogger - INFO - Creating database 'ydrpolicy'...
2025-04-09 23:16:06,110 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy' created.
2025-04-09 23:16:06,113 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-09 23:16:06,134 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-09 23:16:06,134 - BackendLogger - INFO - Creating database tables if they don't exist...
2025-04-09 23:16:06,164 - BackendLogger - INFO - Tables checked/created.
2025-04-09 23:16:06,165 - BackendLogger - INFO - Applying search vector triggers...
2025-04-09 23:16:06,170 - BackendLogger - INFO - Search vector triggers applied.
2025-04-09 23:16:06,171 - BackendLogger - INFO - Starting data population from scraped_policies directory...
2025-04-09 23:16:06,171 - BackendLogger - INFO - Scanning scraped policies directory: /Users/pouria/Documents/Coding/YDRP-RAG/tests/data_collection/test_data/processed/scraped_policies
2025-04-09 23:16:06,171 - BackendLogger - INFO - Reading policy descriptions from CSV: /Users/pouria/Documents/Coding/YDRP-RAG/tests/data_collection/test_data/processed/processed_policies_log.csv
2025-04-09 23:16:06,175 - BackendLogger - INFO - Loaded 17 timestamp mappings and 17 URL mappings for policy descriptions
2025-04-09 23:16:06,176 - BackendLogger - INFO - Creating new database engine
2025-04-09 23:16:06,176 - BackendLogger - INFO - Database engine created successfully
2025-04-09 23:16:06,177 - BackendLogger - INFO - Fetching existing policy information from database...
2025-04-09 23:16:06,192 - BackendLogger - INFO - Found 0 existing policies in database.
2025-04-09 23:16:06,192 - BackendLogger - INFO - Processing new policy: 'Yale_University_Policy_on_Conflict_of_Interest' from folder: Yale_University_Policy_on_Conflict_of_Interest_20250409192912567168
2025-04-09 23:16:06,200 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 1
2025-04-09 23:16:06,201 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-09 23:16:06,321 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-09 23:16:06,850 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-09 23:16:06,851 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-09 23:16:06,852 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-09 23:16:06,853 - BackendLogger - INFO - Processing new policy: 'Residents_Wellbeing_Policy' from folder: Residents_Wellbeing_Policy_20250409193300717366
2025-04-09 23:16:06,883 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 2
2025-04-09 23:16:06,883 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-09 23:16:06,884 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-09 23:16:07,638 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-09 23:16:07,639 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-09 23:16:07,640 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-09 23:16:07,640 - BackendLogger - INFO - Processing new policy: 'School_of_Medicine_Sabbatical_and_Triennial_Leave_Policy' from folder: School_of_Medicine_Sabbatical_and_Triennial_Leave_Policy_20250409193128387433
2025-04-09 23:16:07,661 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 3
2025-04-09 23:16:07,662 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-09 23:16:07,663 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-09 23:16:07,968 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-09 23:16:07,970 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-09 23:16:07,971 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-09 23:16:07,973 - BackendLogger - INFO - Processing new policy: 'Controller_s_Office_Factsheet' from folder: Controller_s_Office_Factsheet_20250409194424987413
2025-04-09 23:16:07,994 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 4
2025-04-09 23:16:07,996 - BackendLogger - INFO -   Split text content into 21 chunks.
2025-04-09 23:16:07,997 - BackendLogger - INFO - Generating embeddings for 21 texts
2025-04-09 23:16:08,619 - BackendLogger - INFO - Successfully generated 21 embeddings
2025-04-09 23:16:08,620 - BackendLogger - INFO -   Generated 21 embeddings.
2025-04-09 23:16:08,621 - BackendLogger - INFO -   Added 21 PolicyChunk records to session.
2025-04-09 23:16:08,622 - BackendLogger - INFO - Processing new policy: 'Voluntary_Faculty_Appointment_Application_Requirements_Process' from folder: Voluntary_Faculty_Appointment_Application_Requirements_Process_20250409193339788344
2025-04-09 23:16:08,662 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 5
2025-04-09 23:16:08,663 - BackendLogger - INFO -   Split text content into 3 chunks.
2025-04-09 23:16:08,664 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 23:16:09,330 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 23:16:09,332 - BackendLogger - INFO -   Generated 3 embeddings.
2025-04-09 23:16:09,334 - BackendLogger - INFO -   Added 3 PolicyChunk records to session.
2025-04-09 23:16:09,336 - BackendLogger - INFO - Processing new policy: 'Workday_Finance_User-Based_Security_Groups_Request_Process' from folder: Workday_Finance_User-Based_Security_Groups_Request_Process_20250409194153006635
2025-04-09 23:16:09,350 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 6
2025-04-09 23:16:09,351 - BackendLogger - INFO -   Split text content into 3 chunks.
2025-04-09 23:16:09,353 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 23:16:09,889 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 23:16:09,891 - BackendLogger - INFO -   Generated 3 embeddings.
2025-04-09 23:16:09,893 - BackendLogger - INFO -   Added 3 PolicyChunk records to session.
2025-04-09 23:16:09,895 - BackendLogger - INFO - Processing new policy: 'Staff_Workplace_Policies' from folder: Staff_Workplace_Policies_20250409204542316052
2025-04-09 23:16:09,943 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 7
2025-04-09 23:16:09,952 - BackendLogger - INFO -   Split text content into 333 chunks.
2025-04-09 23:16:09,953 - BackendLogger - INFO - Generating embeddings for 333 texts
2025-04-09 23:16:11,597 - BackendLogger - INFO - Successfully generated 333 embeddings
2025-04-09 23:16:11,598 - BackendLogger - INFO -   Generated 333 embeddings.
2025-04-09 23:16:11,603 - BackendLogger - INFO -   Added 333 PolicyChunk records to session.
2025-04-09 23:16:11,603 - BackendLogger - INFO - Processing new policy: 'Grand_Rounds_Allowable_Expenses' from folder: Grand_Rounds_Allowable_Expenses_20250409192920823251
2025-04-09 23:16:11,860 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 8
2025-04-09 23:16:11,860 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-09 23:16:11,861 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-09 23:16:12,196 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-09 23:16:12,197 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-09 23:16:12,198 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-09 23:16:12,199 - BackendLogger - INFO - Processing new policy: 'Voluntary_Faculty_Guidelines_Clarification' from folder: Voluntary_Faculty_Guidelines_Clarification_20250409193316792165
2025-04-09 23:16:12,217 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 9
2025-04-09 23:16:12,218 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-09 23:16:12,219 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-09 23:16:12,813 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-09 23:16:12,815 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-09 23:16:12,816 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-09 23:16:12,817 - BackendLogger - INFO - Processing new policy: 'Guidelines_for_Appointment' from folder: Guidelines_for_Appointment_20250409193232742762
2025-04-09 23:16:12,841 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 10
2025-04-09 23:16:12,842 - BackendLogger - INFO -   Split text content into 6 chunks.
2025-04-09 23:16:12,842 - BackendLogger - INFO - Generating embeddings for 6 texts
2025-04-09 23:16:13,218 - BackendLogger - INFO - Successfully generated 6 embeddings
2025-04-09 23:16:13,221 - BackendLogger - INFO -   Generated 6 embeddings.
2025-04-09 23:16:13,222 - BackendLogger - INFO -   Added 6 PolicyChunk records to session.
2025-04-09 23:16:13,222 - BackendLogger - INFO - Processing new policy: 'Critical_Out-Patient_Imaging_Findings_-_Immediate_Medical_Care_SOP' from folder: Critical_Out-Patient_Imaging_Findings_-_Immediate_Medical_Care_SOP_20250409193528279122
2025-04-09 23:16:13,243 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 11
2025-04-09 23:16:13,245 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-09 23:16:13,245 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-09 23:16:13,579 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-09 23:16:13,581 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-09 23:16:13,581 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-09 23:16:13,583 - BackendLogger - INFO - Processing new policy: 'YDR_Conflict_of_Interest_Policy' from folder: YDR_Conflict_of_Interest_Policy_20250409192856529523
2025-04-09 23:16:13,600 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 12
2025-04-09 23:16:13,602 - BackendLogger - INFO -   Split text content into 7 chunks.
2025-04-09 23:16:13,603 - BackendLogger - INFO - Generating embeddings for 7 texts
2025-04-09 23:16:13,985 - BackendLogger - INFO - Successfully generated 7 embeddings
2025-04-09 23:16:13,987 - BackendLogger - INFO -   Generated 7 embeddings.
2025-04-09 23:16:13,988 - BackendLogger - INFO -   Added 7 PolicyChunk records to session.
2025-04-09 23:16:14,007 - BackendLogger - INFO - Database population finished. Processed 12 new policies. Skipped 0 folders.
2025-04-09 23:16:14,008 - BackendLogger - INFO - [green]SUCCESS:[/green] Database initialization completed successfully.
2025-04-09 23:16:14,019 - BackendLogger - INFO - Database engine disposed.
2025-04-09 23:16:26,327 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 23:16:27,149 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 23:16:27,559 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 23:16:27,606 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-09 23:16:28,401 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-09 23:16:28,453 - BackendLogger - INFO - Performing text-only search for query: 'guideline' with limit=5
2025-04-09 23:16:28,460 - BackendLogger - INFO - Performing text-only search for query: 'compliance' with limit=5
2025-04-09 23:16:28,463 - BackendLogger - INFO - Performing text-only search for query: 'introduction' with limit=5
2025-04-09 23:16:28,465 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.7
2025-04-09 23:16:28,469 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.5
2025-04-09 23:16:28,474 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.7
2025-04-09 23:16:28,477 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.95
2025-04-09 23:16:28,479 - BackendLogger - INFO - Performing hybrid search with query='guideline', weight=0.8, limit=5
2025-04-09 23:16:28,488 - BackendLogger - INFO - Retrieving 1 complete policies from chunk results...
2025-04-09 23:16:28,537 - BackendLogger - INFO - Logged policy update: policy_id=2, action=test_update, admin_id=1
2025-04-09 23:16:28,540 - BackendLogger - WARNING - Attempting to delete policy with ID: 4 and all associated data.
2025-04-09 23:16:28,557 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 4 and associated data.
2025-04-09 23:16:28,558 - BackendLogger - WARNING - Attempting to delete policy with ID: 2 and all associated data.
2025-04-09 23:16:28,562 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 2 and associated data.
2025-04-09 23:16:33,619 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-09 23:16:33,923 - BackendLogger - INFO - Logged policy update: policy_id=1, action=update, admin_id=2
2025-04-09 23:16:33,926 - BackendLogger - WARNING - Attempting to delete policy with ID: 1 and all associated data.
2025-04-09 23:16:33,930 - BackendLogger - INFO - [green]SUCCESS:[/green] Successfully deleted policy ID 1 and associated data.
2025-04-09 23:16:33,975 - BackendLogger - INFO - Performing vector-only search with limit=2, threshold=0.7
2025-04-10 20:42:45,425 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-10 20:42:53,535 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-10 20:43:03,407 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy'... THIS WILL DELETE ALL DATA!
2025-04-10 20:43:03,415 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy'...
2025-04-10 20:43:03,421 - BackendLogger - INFO - Connections terminated.
2025-04-10 20:43:03,421 - BackendLogger - INFO - Dropping database 'ydrpolicy'...
2025-04-10 20:43:03,458 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy' dropped successfully.
2025-04-10 20:43:08,929 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-10 20:43:09,307 - BackendLogger - INFO - Starting database initialization for: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy
2025-04-10 20:43:09,308 - BackendLogger - INFO - Checking if database 'ydrpolicy' exists...
2025-04-10 20:43:09,319 - BackendLogger - INFO - Creating database 'ydrpolicy'...
2025-04-10 20:43:09,401 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy' created.
2025-04-10 20:43:09,404 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-10 20:43:09,404 - BackendLogger - ERROR - Error creating extension 'vector': the greenlet library is required to use this function. No module named 'greenlet'
2025-04-10 20:43:09,405 - BackendLogger - INFO - Creating database tables if they don't exist...
2025-04-10 20:43:09,405 - BackendLogger - ERROR - Error creating tables or applying triggers: the greenlet library is required to use this function. No module named 'greenlet'
2025-04-10 20:43:09,406 - BackendLogger - ERROR - Database initialization failed: the greenlet library is required to use this function. No module named 'greenlet'
Traceback (most recent call last):
  File "/Users/pouria/Documents/Coding/YDRP-RAG/engine/ydrpolicy/backend/database/init_db.py", line 493, in init_db
    await create_tables(engine)
  File "/Users/pouria/Documents/Coding/YDRP-RAG/engine/ydrpolicy/backend/database/init_db.py", line 158, in create_tables
    raise e
  File "/Users/pouria/Documents/Coding/YDRP-RAG/engine/ydrpolicy/backend/database/init_db.py", line 141, in create_tables
    async with engine.begin() as conn:
               ^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDRP-RAG/engine/.venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/engine.py", line 1064, in begin
    async with conn:
               ^^^^
  File "/Users/pouria/Documents/Coding/YDRP-RAG/engine/.venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/base.py", line 121, in __aenter__
    return await self.start(is_ctxmanager=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDRP-RAG/engine/.venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/engine.py", line 274, in start
    await greenlet_spawn(self.sync_engine.connect)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pouria/Documents/Coding/YDRP-RAG/engine/.venv/lib/python3.12/site-packages/sqlalchemy/util/concurrency.py", line 99, in greenlet_spawn
    _not_implemented()
  File "/Users/pouria/Documents/Coding/YDRP-RAG/engine/.venv/lib/python3.12/site-packages/sqlalchemy/util/concurrency.py", line 79, in _not_implemented
    raise ValueError(
ValueError: the greenlet library is required to use this function. No module named 'greenlet'
2025-04-10 20:43:25,406 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-10 20:43:25,932 - BackendLogger - INFO - Starting database initialization for: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy
2025-04-10 20:43:25,933 - BackendLogger - INFO - Checking if database 'ydrpolicy' exists...
2025-04-10 20:43:25,943 - BackendLogger - INFO - Database 'ydrpolicy' already exists.
2025-04-10 20:43:25,946 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-10 20:43:25,982 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-10 20:43:25,982 - BackendLogger - INFO - Creating database tables if they don't exist...
2025-04-10 20:43:26,010 - BackendLogger - INFO - Tables checked/created.
2025-04-10 20:43:26,010 - BackendLogger - INFO - Applying search vector triggers...
2025-04-10 20:43:26,014 - BackendLogger - INFO - Search vector triggers applied.
2025-04-10 20:43:26,015 - BackendLogger - INFO - Starting data population from scraped_policies directory...
2025-04-10 20:43:26,015 - BackendLogger - INFO - Scanning scraped policies directory: /Users/pouria/Documents/Coding/YDRP-RAG/engine/tests/data_collection/test_data/processed/scraped_policies
2025-04-10 20:43:26,015 - BackendLogger - INFO - Reading policy descriptions from CSV: /Users/pouria/Documents/Coding/YDRP-RAG/engine/tests/data_collection/test_data/processed/processed_policies_log.csv
2025-04-10 20:43:26,018 - BackendLogger - INFO - Loaded 17 timestamp mappings and 17 URL mappings for policy descriptions
2025-04-10 20:43:26,018 - BackendLogger - INFO - Creating new database engine
2025-04-10 20:43:26,019 - BackendLogger - INFO - Database engine created successfully
2025-04-10 20:43:26,019 - BackendLogger - INFO - Fetching existing policy information from database...
2025-04-10 20:43:26,031 - BackendLogger - INFO - Found 0 existing policies in database.
2025-04-10 20:43:26,032 - BackendLogger - INFO - Processing new policy: 'Yale_University_Policy_on_Conflict_of_Interest' from folder: Yale_University_Policy_on_Conflict_of_Interest_20250409192912567168
2025-04-10 20:43:26,048 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 1
2025-04-10 20:43:26,048 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-10 20:43:26,166 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-10 20:43:27,269 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-10 20:43:27,270 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-10 20:43:27,271 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-10 20:43:27,272 - BackendLogger - INFO - Processing new policy: 'Residents_Wellbeing_Policy' from folder: Residents_Wellbeing_Policy_20250409193300717366
2025-04-10 20:43:27,305 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 2
2025-04-10 20:43:27,306 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-10 20:43:27,307 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-10 20:43:28,245 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-10 20:43:28,247 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-10 20:43:28,248 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-10 20:43:28,248 - BackendLogger - INFO - Processing new policy: 'School_of_Medicine_Sabbatical_and_Triennial_Leave_Policy' from folder: School_of_Medicine_Sabbatical_and_Triennial_Leave_Policy_20250409193128387433
2025-04-10 20:43:28,272 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 3
2025-04-10 20:43:28,273 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-10 20:43:28,273 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-10 20:43:28,998 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-10 20:43:29,000 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-10 20:43:29,001 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-10 20:43:29,003 - BackendLogger - INFO - Processing new policy: 'Controller_s_Office_Factsheet' from folder: Controller_s_Office_Factsheet_20250409194424987413
2025-04-10 20:43:29,022 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 4
2025-04-10 20:43:29,024 - BackendLogger - INFO -   Split text content into 21 chunks.
2025-04-10 20:43:29,024 - BackendLogger - INFO - Generating embeddings for 21 texts
2025-04-10 20:43:32,445 - BackendLogger - INFO - Successfully generated 21 embeddings
2025-04-10 20:43:32,446 - BackendLogger - INFO -   Generated 21 embeddings.
2025-04-10 20:43:32,447 - BackendLogger - INFO -   Added 21 PolicyChunk records to session.
2025-04-10 20:43:32,448 - BackendLogger - INFO - Processing new policy: 'Voluntary_Faculty_Appointment_Application_Requirements_Process' from folder: Voluntary_Faculty_Appointment_Application_Requirements_Process_20250409193339788344
2025-04-10 20:43:32,491 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 5
2025-04-10 20:43:32,492 - BackendLogger - INFO -   Split text content into 3 chunks.
2025-04-10 20:43:32,492 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-10 20:43:32,755 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-10 20:43:32,757 - BackendLogger - INFO -   Generated 3 embeddings.
2025-04-10 20:43:32,759 - BackendLogger - INFO -   Added 3 PolicyChunk records to session.
2025-04-10 20:43:32,761 - BackendLogger - INFO - Processing new policy: 'Workday_Finance_User-Based_Security_Groups_Request_Process' from folder: Workday_Finance_User-Based_Security_Groups_Request_Process_20250409194153006635
2025-04-10 20:43:32,774 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 6
2025-04-10 20:43:32,775 - BackendLogger - INFO -   Split text content into 3 chunks.
2025-04-10 20:43:32,776 - BackendLogger - INFO - Generating embeddings for 3 texts
2025-04-10 20:43:33,374 - BackendLogger - INFO - Successfully generated 3 embeddings
2025-04-10 20:43:33,376 - BackendLogger - INFO -   Generated 3 embeddings.
2025-04-10 20:43:33,377 - BackendLogger - INFO -   Added 3 PolicyChunk records to session.
2025-04-10 20:43:33,379 - BackendLogger - INFO - Processing new policy: 'Staff_Workplace_Policies' from folder: Staff_Workplace_Policies_20250409204542316052
2025-04-10 20:43:33,426 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 7
2025-04-10 20:43:33,436 - BackendLogger - INFO -   Split text content into 333 chunks.
2025-04-10 20:43:33,437 - BackendLogger - INFO - Generating embeddings for 333 texts
2025-04-10 20:43:36,105 - BackendLogger - INFO - Successfully generated 333 embeddings
2025-04-10 20:43:36,105 - BackendLogger - INFO -   Generated 333 embeddings.
2025-04-10 20:43:36,109 - BackendLogger - INFO -   Added 333 PolicyChunk records to session.
2025-04-10 20:43:36,109 - BackendLogger - INFO - Processing new policy: 'Grand_Rounds_Allowable_Expenses' from folder: Grand_Rounds_Allowable_Expenses_20250409192920823251
2025-04-10 20:43:36,373 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 8
2025-04-10 20:43:36,374 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-10 20:43:36,375 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-10 20:43:36,558 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-10 20:43:36,560 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-10 20:43:36,561 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-10 20:43:36,562 - BackendLogger - INFO - Processing new policy: 'Voluntary_Faculty_Guidelines_Clarification' from folder: Voluntary_Faculty_Guidelines_Clarification_20250409193316792165
2025-04-10 20:43:36,581 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 9
2025-04-10 20:43:36,582 - BackendLogger - INFO -   Split text content into 9 chunks.
2025-04-10 20:43:36,583 - BackendLogger - INFO - Generating embeddings for 9 texts
2025-04-10 20:43:37,786 - BackendLogger - INFO - Successfully generated 9 embeddings
2025-04-10 20:43:37,787 - BackendLogger - INFO -   Generated 9 embeddings.
2025-04-10 20:43:37,788 - BackendLogger - INFO -   Added 9 PolicyChunk records to session.
2025-04-10 20:43:37,789 - BackendLogger - INFO - Processing new policy: 'Guidelines_for_Appointment' from folder: Guidelines_for_Appointment_20250409193232742762
2025-04-10 20:43:37,812 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 10
2025-04-10 20:43:37,813 - BackendLogger - INFO -   Split text content into 6 chunks.
2025-04-10 20:43:37,814 - BackendLogger - INFO - Generating embeddings for 6 texts
2025-04-10 20:43:39,119 - BackendLogger - INFO - Successfully generated 6 embeddings
2025-04-10 20:43:39,120 - BackendLogger - INFO -   Generated 6 embeddings.
2025-04-10 20:43:39,121 - BackendLogger - INFO -   Added 6 PolicyChunk records to session.
2025-04-10 20:43:39,122 - BackendLogger - INFO - Processing new policy: 'Critical_Out-Patient_Imaging_Findings_-_Immediate_Medical_Care_SOP' from folder: Critical_Out-Patient_Imaging_Findings_-_Immediate_Medical_Care_SOP_20250409193528279122
2025-04-10 20:43:39,136 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 11
2025-04-10 20:43:39,137 - BackendLogger - INFO -   Split text content into 5 chunks.
2025-04-10 20:43:39,137 - BackendLogger - INFO - Generating embeddings for 5 texts
2025-04-10 20:43:39,688 - BackendLogger - INFO - Successfully generated 5 embeddings
2025-04-10 20:43:39,689 - BackendLogger - INFO -   Generated 5 embeddings.
2025-04-10 20:43:39,690 - BackendLogger - INFO -   Added 5 PolicyChunk records to session.
2025-04-10 20:43:39,692 - BackendLogger - INFO - Processing new policy: 'YDR_Conflict_of_Interest_Policy' from folder: YDR_Conflict_of_Interest_Policy_20250409192856529523
2025-04-10 20:43:39,711 - BackendLogger - INFO - [green]SUCCESS:[/green]   Created Policy record with ID: 12
2025-04-10 20:43:39,712 - BackendLogger - INFO -   Split text content into 7 chunks.
2025-04-10 20:43:39,713 - BackendLogger - INFO - Generating embeddings for 7 texts
2025-04-10 20:43:40,437 - BackendLogger - INFO - Successfully generated 7 embeddings
2025-04-10 20:43:40,439 - BackendLogger - INFO -   Generated 7 embeddings.
2025-04-10 20:43:40,440 - BackendLogger - INFO -   Added 7 PolicyChunk records to session.
2025-04-10 20:43:40,459 - BackendLogger - INFO - Database population finished. Processed 12 new policies. Skipped 0 folders.
2025-04-10 20:43:40,460 - BackendLogger - INFO - [green]SUCCESS:[/green] Database initialization completed successfully.
2025-04-10 20:43:40,473 - BackendLogger - INFO - Database engine disposed.
2025-04-11 00:06:41,063 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 00:06:41,408 - BackendLogger - INFO - Checking if database 'ydrpolicy_test_mcp_integration' exists...
2025-04-11 00:06:41,418 - BackendLogger - INFO - Creating database 'ydrpolicy_test_mcp_integration'...
2025-04-11 00:06:41,482 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test_mcp_integration' created.
2025-04-11 00:06:41,484 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-11 00:06:41,502 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-11 00:06:41,553 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test_mcp_integration'... THIS WILL DELETE ALL DATA!
2025-04-11 00:06:41,556 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy_test_mcp_integration'...
2025-04-11 00:06:41,558 - BackendLogger - INFO - Connections terminated.
2025-04-11 00:06:41,558 - BackendLogger - INFO - Dropping database 'ydrpolicy_test_mcp_integration'...
2025-04-11 00:06:41,571 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test_mcp_integration' dropped successfully.
2025-04-11 00:06:41,582 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test_mcp_integration'... THIS WILL DELETE ALL DATA!
2025-04-11 00:06:41,585 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy_test_mcp_integration'...
2025-04-11 00:06:41,587 - BackendLogger - INFO - Connections terminated.
2025-04-11 00:06:41,587 - BackendLogger - INFO - Dropping database 'ydrpolicy_test_mcp_integration'...
2025-04-11 00:06:41,587 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test_mcp_integration' dropped successfully.
2025-04-11 00:10:30,846 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 00:10:31,169 - BackendLogger - INFO - Checking if database 'ydrpolicy_test_mcp_integration' exists...
2025-04-11 00:10:31,179 - BackendLogger - INFO - Creating database 'ydrpolicy_test_mcp_integration'...
2025-04-11 00:10:31,242 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test_mcp_integration' created.
2025-04-11 00:10:31,244 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-11 00:10:31,261 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-11 00:10:31,361 - BackendLogger - INFO - Generating embeddings for 2 texts
2025-04-11 00:10:32,197 - BackendLogger - INFO - Successfully generated 2 embeddings
2025-04-11 00:10:32,225 - BackendLogger - INFO - Generating embeddings for 2 texts
2025-04-11 00:10:32,435 - BackendLogger - INFO - Successfully generated 2 embeddings
2025-04-11 00:10:32,562 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test_mcp_integration'... THIS WILL DELETE ALL DATA!
2025-04-11 00:10:32,569 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy_test_mcp_integration'...
2025-04-11 00:10:32,574 - BackendLogger - INFO - Connections terminated.
2025-04-11 00:10:32,574 - BackendLogger - INFO - Dropping database 'ydrpolicy_test_mcp_integration'...
2025-04-11 00:10:32,602 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test_mcp_integration' dropped successfully.
2025-04-11 00:11:59,411 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 00:11:59,733 - BackendLogger - INFO - Checking if database 'ydrpolicy_test_mcp_integration' exists...
2025-04-11 00:11:59,742 - BackendLogger - INFO - Creating database 'ydrpolicy_test_mcp_integration'...
2025-04-11 00:11:59,811 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test_mcp_integration' created.
2025-04-11 00:11:59,814 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-11 00:11:59,831 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-11 00:11:59,920 - BackendLogger - INFO - Generating embeddings for 2 texts
2025-04-11 00:12:00,777 - BackendLogger - INFO - Successfully generated 2 embeddings
2025-04-11 00:12:00,806 - BackendLogger - INFO - Generating embeddings for 2 texts
2025-04-11 00:12:01,490 - BackendLogger - INFO - Successfully generated 2 embeddings
2025-04-11 00:12:23,185 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test_mcp_integration'... THIS WILL DELETE ALL DATA!
2025-04-11 00:12:23,193 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy_test_mcp_integration'...
2025-04-11 00:12:23,198 - BackendLogger - INFO - Connections terminated.
2025-04-11 00:12:23,198 - BackendLogger - INFO - Dropping database 'ydrpolicy_test_mcp_integration'...
2025-04-11 00:12:23,232 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test_mcp_integration' dropped successfully.
2025-04-11 00:17:27,861 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 00:17:28,183 - BackendLogger - INFO - Checking if database 'ydrpolicy_test_mcp_integration' exists...
2025-04-11 00:17:28,193 - BackendLogger - INFO - Creating database 'ydrpolicy_test_mcp_integration'...
2025-04-11 00:17:28,254 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test_mcp_integration' created.
2025-04-11 00:17:28,256 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-11 00:17:28,274 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-11 00:17:28,362 - BackendLogger - INFO - Generating embeddings for 2 texts
2025-04-11 00:17:29,091 - BackendLogger - INFO - Successfully generated 2 embeddings
2025-04-11 00:17:29,121 - BackendLogger - INFO - Generating embeddings for 2 texts
2025-04-11 00:17:29,581 - BackendLogger - INFO - Successfully generated 2 embeddings
2025-04-11 00:17:29,925 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 00:17:50,859 - BackendLogger - WARNING - Attempting to drop database 'ydrpolicy_test_mcp_integration'... THIS WILL DELETE ALL DATA!
2025-04-11 00:17:50,867 - BackendLogger - INFO - Terminating active connections to 'ydrpolicy_test_mcp_integration'...
2025-04-11 00:17:50,872 - BackendLogger - INFO - Connections terminated.
2025-04-11 00:17:50,872 - BackendLogger - INFO - Dropping database 'ydrpolicy_test_mcp_integration'...
2025-04-11 00:17:50,900 - BackendLogger - INFO - [green]SUCCESS:[/green] Database 'ydrpolicy_test_mcp_integration' dropped successfully.
2025-04-11 00:27:20,297 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 00:41:50,256 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 00:44:26,041 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 07:53:33,717 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 07:54:00,562 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 07:54:01,084 - BackendLogger - INFO - Starting database initialization for: postgresql+asyncpg://pouria:@localhost:5432/ydrpolicy
2025-04-11 07:54:01,084 - BackendLogger - INFO - Checking if database 'ydrpolicy' exists...
2025-04-11 07:54:01,097 - BackendLogger - INFO - Database 'ydrpolicy' already exists.
2025-04-11 07:54:01,102 - BackendLogger - INFO - Ensuring extension 'vector' exists...
2025-04-11 07:54:01,113 - BackendLogger - INFO - Extension 'vector' checked/created.
2025-04-11 07:54:01,113 - BackendLogger - INFO - Creating database tables if they don't exist...
2025-04-11 07:54:01,122 - BackendLogger - INFO - Tables checked/created.
2025-04-11 07:54:01,122 - BackendLogger - INFO - Applying search vector triggers...
2025-04-11 07:54:01,131 - BackendLogger - INFO - Search vector triggers applied.
2025-04-11 07:54:01,132 - BackendLogger - INFO - Starting data population from scraped_policies directory...
2025-04-11 07:54:01,132 - BackendLogger - INFO - Scanning scraped policies directory: /Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/tests/data_collection/test_data/processed/scraped_policies
2025-04-11 07:54:01,132 - BackendLogger - INFO - Reading policy descriptions from CSV: /Users/pouria/Documents/Coding/YDRP-RAG/ydrp_engine/tests/data_collection/test_data/processed/processed_policies_log.csv
2025-04-11 07:54:01,136 - BackendLogger - INFO - Loaded 17 timestamp mappings and 17 URL mappings for policy descriptions
2025-04-11 07:54:01,136 - BackendLogger - INFO - Creating new database engine
2025-04-11 07:54:01,137 - BackendLogger - INFO - Database engine created successfully
2025-04-11 07:54:01,137 - BackendLogger - INFO - Fetching existing policy information from database...
2025-04-11 07:54:01,152 - BackendLogger - INFO - Found 12 existing policies in database.
2025-04-11 07:54:01,153 - BackendLogger - INFO - Database population finished. Processed 0 new policies. Skipped 12 folders.
2025-04-11 07:54:01,153 - BackendLogger - INFO - [green]SUCCESS:[/green] Database initialization completed successfully.
2025-04-11 07:54:01,156 - BackendLogger - INFO - Database engine disposed.
2025-04-11 08:02:35,693 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 08:15:49,579 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 08:17:16,277 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 08:30:02,189 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 08:30:02,191 - BackendLogger - INFO - Stdio transport selected. Disabling console logging for MCP process.
2025-04-11 08:30:02,192 - BackendLogger - INFO - Console (RichHandler) removed for this process.
2025-04-11 08:30:02,192 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio...
2025-04-11 08:30:26,684 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 08:30:26,687 - BackendLogger - INFO - Stdio transport selected. Disabling console logging for MCP process.
2025-04-11 08:30:26,687 - BackendLogger - INFO - Console (RichHandler) removed for this process.
2025-04-11 08:30:26,687 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio...
2025-04-11 08:32:18,347 - BackendLogger - INFO - MCP Server finished.
2025-04-11 08:37:15,901 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 08:37:15,903 - BackendLogger - INFO - Stdio transport selected. Disabling console logging for MCP process.
2025-04-11 08:37:15,904 - BackendLogger - INFO - Console (RichHandler) removed for this process.
2025-04-11 08:37:15,904 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio...
2025-04-11 08:37:16,229 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio transport...
2025-04-11 08:37:16,230 - BackendLogger - INFO - Running MCP server with stdio transport.
2025-04-11 08:38:25,742 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 08:38:25,744 - BackendLogger - INFO - Stdio transport selected. Disabling console logging for MCP process.
2025-04-11 08:38:25,744 - BackendLogger - INFO - Console (RichHandler) removed for this process.
2025-04-11 08:38:25,744 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio...
2025-04-11 08:38:26,261 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio transport...
2025-04-11 08:38:26,262 - BackendLogger - INFO - Running MCP server with stdio transport.
2025-04-11 08:40:59,071 - BackendLogger - INFO - Received find_similar_chunks request: query='resident shift change high volume hours...', k=5, threshold=None
2025-04-11 08:41:00,175 - BackendLogger - INFO - Creating new database engine
2025-04-11 08:41:00,209 - BackendLogger - INFO - Database engine created successfully
2025-04-11 08:41:00,210 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.7
2025-04-11 08:41:00,249 - BackendLogger - INFO - Found 0 similar chunks.
2025-04-11 08:41:02,597 - BackendLogger - INFO - Received find_similar_chunks request: query='resident scheduling high volume workflow...', k=5, threshold=None
2025-04-11 08:41:03,227 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.7
2025-04-11 08:41:03,231 - BackendLogger - INFO - Found 0 similar chunks.
2025-04-11 08:41:05,281 - BackendLogger - INFO - Received find_similar_chunks request: query='resident scheduling shift changes...', k=5, threshold=None
2025-04-11 08:41:05,499 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.7
2025-04-11 08:41:05,505 - BackendLogger - INFO - Found 0 similar chunks.
2025-04-11 08:41:07,640 - BackendLogger - INFO - Received find_similar_chunks request: query='high volume periods staffing workflow...', k=5, threshold=None
2025-04-11 08:41:08,183 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.7
2025-04-11 08:41:08,190 - BackendLogger - INFO - Found 0 similar chunks.
2025-04-11 08:42:15,725 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 08:42:15,727 - BackendLogger - INFO - Stdio transport selected. Disabling console logging for MCP process.
2025-04-11 08:42:15,727 - BackendLogger - INFO - Console (RichHandler) removed for this process.
2025-04-11 08:42:15,727 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio...
2025-04-11 08:42:16,056 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio transport...
2025-04-11 08:42:16,057 - BackendLogger - INFO - Running MCP server with stdio transport.
2025-04-11 08:42:21,053 - BackendLogger - INFO - MCP server process finished.
2025-04-11 08:42:21,057 - BackendLogger - INFO - MCP Server finished.
2025-04-11 08:42:24,920 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 08:42:24,922 - BackendLogger - INFO - Stdio transport selected. Disabling console logging for MCP process.
2025-04-11 08:42:24,923 - BackendLogger - INFO - Console (RichHandler) removed for this process.
2025-04-11 08:42:24,923 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio...
2025-04-11 08:42:25,279 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio transport...
2025-04-11 08:42:25,279 - BackendLogger - INFO - Running MCP server with stdio transport.
2025-04-11 08:43:17,407 - BackendLogger - INFO - Received find_similar_chunks request: query='Yale resident shift change high volume hours...', k=5, threshold=None
2025-04-11 08:43:19,337 - BackendLogger - INFO - Creating new database engine
2025-04-11 08:43:19,359 - BackendLogger - INFO - Database engine created successfully
2025-04-11 08:43:19,360 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-11 08:43:19,396 - BackendLogger - INFO - Found 5 similar chunks.
2025-04-11 08:43:21,364 - BackendLogger - INFO - Received find_similar_chunks request: query='Yale medical residents shift handover policy...', k=5, threshold=None
2025-04-11 08:43:21,959 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-11 08:43:21,967 - BackendLogger - INFO - Found 5 similar chunks.
2025-04-11 08:43:24,927 - BackendLogger - INFO - Received find_similar_chunks request: query='Yale resident handoff protocol high volume busy ti...', k=5, threshold=None
2025-04-11 08:43:25,431 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-11 08:43:25,440 - BackendLogger - INFO - Found 5 similar chunks.
2025-04-11 08:43:27,586 - BackendLogger - INFO - Received find_similar_chunks request: query='Yale medical resident duty hours handoff high volu...', k=5, threshold=None
2025-04-11 08:43:28,139 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-11 08:43:28,147 - BackendLogger - INFO - Found 5 similar chunks.
2025-04-11 08:43:32,485 - BackendLogger - INFO - Received get_policy_from_ID request for policy_id: 2
2025-04-11 08:45:44,950 - BackendLogger - INFO - Received find_similar_chunks request: query='Yale resident shift scheduling rotation schedule p...', k=5, threshold=None
2025-04-11 08:45:47,406 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-11 08:45:47,420 - BackendLogger - INFO - Found 5 similar chunks.
2025-04-11 08:45:50,019 - BackendLogger - INFO - Received get_policy_from_ID request for policy_id: 7
2025-04-11 08:45:58,923 - BackendLogger - INFO - Received find_similar_chunks request: query='Yale medical resident work hour shift schedule dut...', k=5, threshold=None
2025-04-11 08:45:59,795 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-11 08:45:59,804 - BackendLogger - INFO - Found 5 similar chunks.
2025-04-11 08:46:04,996 - BackendLogger - INFO - Received get_policy_from_ID request for policy_id: 7
2025-04-11 08:46:13,619 - BackendLogger - INFO - Received find_similar_chunks request: query='Yale alternative work arrangements schedule policy...', k=5, threshold=None
2025-04-11 08:46:14,334 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-11 08:46:14,343 - BackendLogger - INFO - Found 5 similar chunks.
2025-04-11 08:47:42,954 - BackendLogger - INFO - Received find_similar_chunks request: query='Yale radiology residents scheduling high volume ho...', k=5, threshold=None
2025-04-11 08:47:43,785 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-11 08:47:43,797 - BackendLogger - INFO - Found 5 similar chunks.
2025-04-11 08:47:49,703 - BackendLogger - INFO - Received get_policy_from_ID request for policy_id: 2
2025-04-11 08:47:52,758 - BackendLogger - INFO - Received find_similar_chunks request: query='Yale radiology resident scheduling coverage high v...', k=5, threshold=None
2025-04-11 08:47:54,055 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-11 08:47:54,064 - BackendLogger - INFO - Found 5 similar chunks.
2025-04-11 08:47:56,173 - BackendLogger - INFO - Received find_similar_chunks request: query='Yale radiology resident staffing coverage schedule...', k=5, threshold=None
2025-04-11 08:47:56,735 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-11 08:47:56,742 - BackendLogger - INFO - Found 5 similar chunks.
2025-04-11 08:47:59,167 - BackendLogger - INFO - Received find_similar_chunks request: query='Yale radiology excessive clinical volume manage pa...', k=5, threshold=None
2025-04-11 08:47:59,807 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-11 08:47:59,815 - BackendLogger - INFO - Found 5 similar chunks.
2025-04-11 08:48:01,874 - BackendLogger - INFO - Received get_policy_from_ID request for policy_id: 11
2025-04-11 08:48:06,865 - BackendLogger - INFO - Received find_similar_chunks request: query='Yale radiology resident staffing workflow excessiv...', k=5, threshold=None
2025-04-11 08:48:07,094 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-11 08:48:07,102 - BackendLogger - INFO - Found 5 similar chunks.
2025-04-11 08:59:59,372 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 08:59:59,374 - BackendLogger - INFO - Stdio transport selected. Elevating console log level to CRITICAL.
2025-04-11 08:59:59,374 - BackendLogger - INFO - Console handler level set to CRITICAL (was INFO). INFO messages will only go to file.
2025-04-11 08:59:59,374 - BackendLogger - INFO - --- TEST LOG MESSAGE AFTER HANDLER LEVEL CHANGE ---
2025-04-11 08:59:59,374 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio...
2025-04-11 08:59:59,694 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio transport...
2025-04-11 08:59:59,694 - BackendLogger - INFO - Running MCP server with stdio transport.
2025-04-11 09:00:46,888 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 09:00:46,890 - BackendLogger - INFO - Stdio transport selected. Disabling console logging for MCP process.
2025-04-11 09:00:46,890 - BackendLogger - INFO - Console (RichHandler) removed for this process.
2025-04-11 09:00:46,890 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio...
2025-04-11 09:00:47,231 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio transport...
2025-04-11 09:00:47,232 - BackendLogger - INFO - Running MCP server with stdio transport.
2025-04-11 09:05:46,737 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 09:05:46,739 - BackendLogger - INFO - Stdio transport selected. Disabling console logging for MCP process.
2025-04-11 09:05:46,739 - BackendLogger - INFO - Console (RichHandler) removed for this process.
2025-04-11 09:05:46,739 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio...
2025-04-11 09:05:47,065 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio transport...
2025-04-11 09:05:47,065 - BackendLogger - INFO - Running MCP server with stdio transport.
2025-04-11 09:05:51,228 - BackendLogger - INFO - MCP server process finished.
2025-04-11 09:05:51,234 - BackendLogger - INFO - MCP Server finished.
2025-04-11 09:05:55,522 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 09:05:55,524 - BackendLogger - INFO - Stdio transport selected. Disabling console logging for MCP process.
2025-04-11 09:05:55,525 - BackendLogger - INFO - Console (RichHandler) removed for this process.
2025-04-11 09:05:55,525 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio...
2025-04-11 09:05:56,068 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio transport...
2025-04-11 09:05:56,069 - BackendLogger - INFO - Running MCP server with stdio transport.
2025-04-11 09:06:48,140 - BackendLogger - INFO - Received find_similar_chunks request: query='Yale radiology resident shift policies high volume...', k=5, threshold=None
2025-04-11 09:06:48,938 - BackendLogger - INFO - Creating new database engine
2025-04-11 09:06:48,957 - BackendLogger - INFO - Database engine created successfully
2025-04-11 09:06:48,958 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-11 09:06:49,000 - BackendLogger - INFO - Found 5 similar chunks.
2025-04-11 09:06:51,051 - BackendLogger - INFO - Received find_similar_chunks request: query='Yale radiology resident scheduling high volume pat...', k=5, threshold=None
2025-04-11 09:06:51,490 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-11 09:06:51,498 - BackendLogger - INFO - Found 5 similar chunks.
2025-04-11 09:06:53,755 - BackendLogger - INFO - Received find_similar_chunks request: query='Yale radiology residency call schedule coverage pe...', k=5, threshold=None
2025-04-11 09:06:54,721 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-11 09:06:54,730 - BackendLogger - INFO - Found 5 similar chunks.
2025-04-11 09:06:58,368 - BackendLogger - INFO - Received get_policy_from_ID request for policy_id: 2
2025-04-11 09:08:13,861 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 09:08:13,863 - BackendLogger - INFO - Stdio transport selected. Disabling console logging for MCP process.
2025-04-11 09:08:13,864 - BackendLogger - INFO - Console (RichHandler) removed for this process.
2025-04-11 09:08:13,864 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio...
2025-04-11 09:08:14,186 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio transport...
2025-04-11 09:08:14,186 - BackendLogger - INFO - Running MCP server with stdio transport.
2025-04-11 09:08:19,893 - BackendLogger - INFO - MCP server process finished.
2025-04-11 09:08:19,896 - BackendLogger - INFO - MCP Server finished.
2025-04-11 09:08:35,091 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 09:08:35,093 - BackendLogger - INFO - Stdio transport selected. Disabling console logging for MCP process.
2025-04-11 09:08:35,093 - BackendLogger - INFO - Console (RichHandler) removed for this process.
2025-04-11 09:08:35,094 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio...
2025-04-11 09:08:35,460 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio transport...
2025-04-11 09:08:35,461 - BackendLogger - INFO - Running MCP server with stdio transport.
2025-04-11 09:09:24,020 - BackendLogger - INFO - Received find_similar_chunks request: query='radiology residents shifts high volume hours...', k=5, threshold=None
2025-04-11 09:09:24,584 - BackendLogger - INFO - Creating new database engine
2025-04-11 09:09:24,610 - BackendLogger - INFO - Database engine created successfully
2025-04-11 09:09:24,611 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-11 09:09:24,651 - BackendLogger - INFO - Found 5 similar chunks.
2025-04-11 09:09:27,036 - BackendLogger - INFO - Received find_similar_chunks request: query='radiology resident schedule coverage staffing busy...', k=5, threshold=None
2025-04-11 09:09:27,547 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-11 09:09:27,556 - BackendLogger - INFO - Found 5 similar chunks.
2025-04-11 09:09:29,938 - BackendLogger - INFO - Received find_similar_chunks request: query='radiology resident duty hours schedule rotation co...', k=5, threshold=None
2025-04-11 09:09:30,620 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-11 09:09:30,629 - BackendLogger - INFO - Found 5 similar chunks.
2025-04-11 09:09:33,400 - BackendLogger - INFO - Received find_similar_chunks request: query='radiology resident on call emergency coverage high...', k=5, threshold=None
2025-04-11 09:09:34,251 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-11 09:09:34,259 - BackendLogger - INFO - Found 5 similar chunks.
2025-04-11 09:09:37,315 - BackendLogger - INFO - Received find_similar_chunks request: query='radiology resident duty hours work hours ACGME...', k=5, threshold=None
2025-04-11 09:09:37,992 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-11 09:09:38,002 - BackendLogger - INFO - Found 5 similar chunks.
2025-04-11 09:09:43,217 - BackendLogger - INFO - Received find_similar_chunks request: query='YDR radiology resident workload call schedule poli...', k=5, threshold=None
2025-04-11 09:09:43,610 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-11 09:09:43,621 - BackendLogger - INFO - Found 5 similar chunks.
2025-04-11 09:09:46,800 - BackendLogger - INFO - Received get_policy_from_ID request for policy_id: 12
2025-04-11 09:09:49,669 - BackendLogger - INFO - Received get_policy_from_ID request for policy_id: 2
2025-04-11 09:09:53,989 - BackendLogger - INFO - Received find_similar_chunks request: query='radiology resident schedule shifts overlap during ...', k=5, threshold=None
2025-04-11 09:09:54,251 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-11 09:09:54,259 - BackendLogger - INFO - Found 5 similar chunks.
2025-04-11 09:11:13,659 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 09:11:13,661 - BackendLogger - INFO - Stdio transport selected. Disabling console logging for MCP process.
2025-04-11 09:11:13,661 - BackendLogger - INFO - Console (RichHandler) removed for this process.
2025-04-11 09:11:13,661 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio...
2025-04-11 09:11:13,982 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio transport...
2025-04-11 09:11:13,983 - BackendLogger - INFO - Running MCP server with stdio transport.
2025-04-11 09:11:18,530 - BackendLogger - INFO - MCP server process finished.
2025-04-11 09:11:18,536 - BackendLogger - INFO - MCP Server finished.
2025-04-11 09:11:21,512 - BackendLogger - INFO - Backend logging initialized. Log file: data/logs/backend.log
2025-04-11 09:11:21,514 - BackendLogger - INFO - Stdio transport selected. Disabling console logging for MCP process.
2025-04-11 09:11:21,515 - BackendLogger - INFO - Console (RichHandler) removed for this process.
2025-04-11 09:11:21,515 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio...
2025-04-11 09:11:21,865 - BackendLogger - INFO - Attempting to start MCP server on 0.0.0.0:8001 via stdio transport...
2025-04-11 09:11:21,866 - BackendLogger - INFO - Running MCP server with stdio transport.
2025-04-11 09:11:49,806 - BackendLogger - INFO - Received find_similar_chunks request: query='radiology residents shifts high volume hours sched...', k=5, threshold=None
2025-04-11 09:11:50,178 - BackendLogger - INFO - Creating new database engine
2025-04-11 09:11:50,198 - BackendLogger - INFO - Database engine created successfully
2025-04-11 09:11:50,199 - BackendLogger - INFO - Performing vector-only search with limit=5, threshold=0.2
2025-04-11 09:11:50,240 - BackendLogger - INFO - Found 5 similar chunks.
2025-04-11 09:11:54,684 - BackendLogger - INFO - Received get_policy_from_ID request for policy_id: 2
2025-04-11 09:11:58,072 - BackendLogger - INFO - Received find_similar_chunks request: query='radiology residents high volume hours shift schedu...', k=3, threshold=None
2025-04-11 09:11:58,894 - BackendLogger - INFO - Performing vector-only search with limit=3, threshold=0.2
2025-04-11 09:11:58,904 - BackendLogger - INFO - Found 3 similar chunks.
2025-04-12 14:30:45,702 - BackendLogger - INFO - MCP server process finished.
2025-04-12 14:30:45,703 - BackendLogger - INFO - MCP Server finished.
